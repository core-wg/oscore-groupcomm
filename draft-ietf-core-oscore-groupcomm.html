<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Group Object Security for Constrained RESTful Environments (Group OSCORE)</title>
<meta content="Marco Tiloca" name="author">
<meta content="Göran Selander" name="author">
<meta content="Francesca Palombini" name="author">
<meta content="John Preuß Mattsson" name="author">
<meta content="Rikard Höglund" name="author">
<meta content="
       This document defines the security protocol Group Object Security for Constrained RESTful Environments (Group OSCORE), providing end-to-end security of CoAP messages exchanged between members of a group, e.g., sent over IP multicast. In particular, the described protocol defines how OSCORE is used in a group communication setting to provide source authentication for CoAP group requests, sent by a client to multiple servers, and for protection of the corresponding CoAP responses. Group OSCORE also defines a pairwise mode where each member of the group can efficiently derive a symmetric pairwise key with any other member of the group for pairwise OSCORE communication. Group OSCORE can be used between endpoints communicating with CoAP or CoAP-mappable HTTP. 
    " name="description">
<meta content="xml2rfc 3.23.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-core-oscore-groupcomm-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.23.0
    Python 3.12.3
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 4.9.4
    platformdirs 4.2.2
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-core-oscore-groupcomm.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Group OSCORE</td>
<td class="right">August 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tiloca, et al.</td>
<td class="center">Expires 1 March 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">CoRE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-core-oscore-groupcomm-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-08-28" class="published">28 August 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-03-01">1 March 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Tiloca</div>
<div class="org">RISE AB</div>
</div>
<div class="author">
      <div class="author-name">G. Selander</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">F. Palombini</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">J. Mattsson</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">R. Höglund</div>
<div class="org">RISE AB</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Group Object Security for Constrained RESTful Environments (Group OSCORE)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines the security protocol Group Object Security for Constrained RESTful Environments (Group OSCORE), providing end-to-end security of CoAP messages exchanged between members of a group, e.g., sent over IP multicast. In particular, the described protocol defines how OSCORE is used in a group communication setting to provide source authentication for CoAP group requests, sent by a client to multiple servers, and for protection of the corresponding CoAP responses. Group OSCORE also defines a pairwise mode where each member of the group can efficiently derive a symmetric pairwise key with any other member of the group for pairwise OSCORE communication. Group OSCORE can be used between endpoints communicating with CoAP or CoAP-mappable HTTP.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-core-oscore-groupcomm/">https://datatracker.ietf.org/doc/draft-ietf-core-oscore-groupcomm/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Constrained RESTful Environments (core) Working Group mailing list (<span><a href="mailto:core@ietf.org">mailto:core@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/core/">https://mailarchive.ietf.org/arch/browse/core/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/core/">https://www.ietf.org/mailman/listinfo/core/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/core-wg/oscore-groupcomm">https://github.com/core-wg/oscore-groupcomm</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 1 March 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-security-context" class="internal xref">Security Context</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-common-context" class="internal xref">Common Context</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1" class="keepWithNext"><a href="#section-2.1.1" class="auto internal xref">2.1.1</a>.  <a href="#name-aead-algorithm" class="internal xref">AEAD Algorithm</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.2">
                    <p id="section-toc.1-1.2.2.1.2.2.1"><a href="#section-2.1.2" class="auto internal xref">2.1.2</a>.  <a href="#name-id-context" class="internal xref">ID Context</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.3">
                    <p id="section-toc.1-1.2.2.1.2.3.1"><a href="#section-2.1.3" class="auto internal xref">2.1.3</a>.  <a href="#name-common-iv" class="internal xref">Common IV</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.4">
                    <p id="section-toc.1-1.2.2.1.2.4.1"><a href="#section-2.1.4" class="auto internal xref">2.1.4</a>.  <a href="#name-authentication-credential-f" class="internal xref">Authentication Credential Format</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.5">
                    <p id="section-toc.1-1.2.2.1.2.5.1"><a href="#section-2.1.5" class="auto internal xref">2.1.5</a>.  <a href="#name-group-manager-authenticatio" class="internal xref">Group Manager Authentication Credential</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.6">
                    <p id="section-toc.1-1.2.2.1.2.6.1"><a href="#section-2.1.6" class="auto internal xref">2.1.6</a>.  <a href="#name-group-encryption-algorithm" class="internal xref">Group Encryption Algorithm</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.7">
                    <p id="section-toc.1-1.2.2.1.2.7.1"><a href="#section-2.1.7" class="auto internal xref">2.1.7</a>.  <a href="#name-signature-algorithm" class="internal xref">Signature Algorithm</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.8">
                    <p id="section-toc.1-1.2.2.1.2.8.1"><a href="#section-2.1.8" class="auto internal xref">2.1.8</a>.  <a href="#name-signature-encryption-key" class="internal xref">Signature Encryption Key</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.9">
                    <p id="section-toc.1-1.2.2.1.2.9.1"><a href="#section-2.1.9" class="auto internal xref">2.1.9</a>.  <a href="#name-pairwise-key-agreement-algo" class="internal xref">Pairwise Key Agreement Algorithm</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-sender-context-and-recipien" class="internal xref">Sender Context and Recipient Context</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-establishment-of-security-c" class="internal xref">Establishment of Security Context Parameters</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-authentication-credentials" class="internal xref">Authentication Credentials</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="auto internal xref">2.5</a>.  <a href="#name-pairwise-keys" class="internal xref">Pairwise Keys</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5.2.1">
                    <p id="section-toc.1-1.2.2.5.2.1.1"><a href="#section-2.5.1" class="auto internal xref">2.5.1</a>.  <a href="#name-derivation-of-pairwise-keys" class="internal xref">Derivation of Pairwise Keys</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5.2.2">
                    <p id="section-toc.1-1.2.2.5.2.2.1"><a href="#section-2.5.2" class="auto internal xref">2.5.2</a>.  <a href="#name-ecdh-with-montgomery-coordi" class="internal xref">ECDH with Montgomery Coordinates</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5.2.3">
                    <p id="section-toc.1-1.2.2.5.2.3.1"><a href="#section-2.5.3" class="auto internal xref">2.5.3</a>.  <a href="#name-usage-of-sequence-numbers" class="internal xref">Usage of Sequence Numbers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5.2.4">
                    <p id="section-toc.1-1.2.2.5.2.4.1"><a href="#section-2.5.4" class="auto internal xref">2.5.4</a>.  <a href="#name-security-context-for-pairwi" class="internal xref">Security Context for Pairwise Mode</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="auto internal xref">2.6</a>.  <a href="#name-update-of-security-context" class="internal xref">Update of Security Context</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6.2.1">
                    <p id="section-toc.1-1.2.2.6.2.1.1"><a href="#section-2.6.1" class="auto internal xref">2.6.1</a>.  <a href="#name-loss-of-mutable-security-co" class="internal xref">Loss of Mutable Security Context</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6.2.2">
                    <p id="section-toc.1-1.2.2.6.2.2.1"><a href="#section-2.6.2" class="auto internal xref">2.6.2</a>.  <a href="#name-exhaustion-of-sender-sequen" class="internal xref">Exhaustion of Sender Sequence Number Space</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6.2.3">
                    <p id="section-toc.1-1.2.2.6.2.3.1"><a href="#section-2.6.3" class="auto internal xref">2.6.3</a>.  <a href="#name-retrieving-new-security-con" class="internal xref">Retrieving New Security Context Parameters</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-the-group-manager" class="internal xref">The Group Manager</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-set-up-of-new-endpoints" class="internal xref">Set-up of New Endpoints</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-management-of-group-keying-" class="internal xref">Management of Group Keying Material</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="auto internal xref">3.2.1</a>.  <a href="#name-recycling-of-identifiers" class="internal xref">Recycling of Identifiers</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-support-for-signature-check" class="internal xref">Support for Signature Checkers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-responsibilities-of-the-gro" class="internal xref">Responsibilities of the Group Manager</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-the-cose-object" class="internal xref">The COSE Object</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-countersignature" class="internal xref">Countersignature</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-clarifications-on-using-a-c" class="internal xref">Clarifications on Using a Countersignature</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-the-kid-and-kid-context-par" class="internal xref">The 'kid' and 'kid context' parameters</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-aead-nonce" class="internal xref">AEAD Nonce</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-external_aad" class="internal xref">external_aad</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-oscore-header-compression" class="internal xref">OSCORE Header Compression</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-keystream-derivation-for-co" class="internal xref">Keystream Derivation for Countersignature Encryption</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-examples-of-compressed-cose" class="internal xref">Examples of Compressed COSE Objects</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-examples-in-group-mode" class="internal xref">Examples in Group Mode</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.  <a href="#name-examples-in-pairwise-mode" class="internal xref">Examples in Pairwise Mode</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-message-binding-sequence-nu" class="internal xref">Message Binding, Sequence Numbers, Freshness, and Replay Protection</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-supporting-multiple-respons" class="internal xref">Supporting Multiple Responses in Long Exchanges</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-freshness" class="internal xref">Freshness</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-replay-protection" class="internal xref">Replay Protection</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.1">
                    <p id="section-toc.1-1.6.2.3.2.1.1"><a href="#section-6.3.1" class="auto internal xref">6.3.1</a>.  <a href="#name-replay-protection-of-respon" class="internal xref">Replay Protection of Responses</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-message-reception" class="internal xref">Message Reception</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-message-processing-in-group" class="internal xref">Message Processing in Group Mode</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-protecting-the-request" class="internal xref">Protecting the Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-verifying-the-request" class="internal xref">Verifying the Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-protecting-the-response" class="internal xref">Protecting the Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-verifying-the-response" class="internal xref">Verifying the Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="auto internal xref">8.5</a>.  <a href="#name-external-signature-checkers" class="internal xref">External Signature Checkers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-message-processing-in-pairw" class="internal xref">Message Processing in Pairwise Mode</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-pre-conditions" class="internal xref">Pre-Conditions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-main-differences-from-oscor" class="internal xref">Main Differences from OSCORE</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-protecting-the-request-2" class="internal xref">Protecting the Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-verifying-the-request-2" class="internal xref">Verifying the Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="auto internal xref">9.5</a>.  <a href="#name-protecting-the-response-2" class="internal xref">Protecting the Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6">
                <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="auto internal xref">9.6</a>.  <a href="#name-verifying-the-response-2" class="internal xref">Verifying the Response</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-challenge-response-based-fr" class="internal xref">Challenge-Response Based Freshness and Replay Window Recovery</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-implementation-compliance" class="internal xref">Implementation Compliance</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-web-linking" class="internal xref">Web Linking</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="auto internal xref">13.1</a>.  <a href="#name-security-of-the-group-mode" class="internal xref">Security of the Group Mode</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="auto internal xref">13.2</a>.  <a href="#name-security-of-the-pairwise-mo" class="internal xref">Security of the Pairwise Mode</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#section-13.3" class="auto internal xref">13.3</a>.  <a href="#name-uniqueness-of-key-nonce" class="internal xref">Uniqueness of (key, nonce)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.4">
                <p id="section-toc.1-1.13.2.4.1"><a href="#section-13.4" class="auto internal xref">13.4</a>.  <a href="#name-management-of-group-keying-m" class="internal xref">Management of Group Keying Material</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.5">
                <p id="section-toc.1-1.13.2.5.1"><a href="#section-13.5" class="auto internal xref">13.5</a>.  <a href="#name-update-of-security-context-" class="internal xref">Update of Security Context and Key Rotation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.5.2.1">
                    <p id="section-toc.1-1.13.2.5.2.1.1"><a href="#section-13.5.1" class="auto internal xref">13.5.1</a>.  <a href="#name-late-update-on-the-sender" class="internal xref">Late Update on the Sender</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.5.2.2">
                    <p id="section-toc.1-1.13.2.5.2.2.1"><a href="#section-13.5.2" class="auto internal xref">13.5.2</a>.  <a href="#name-late-update-on-the-recipien" class="internal xref">Late Update on the Recipient</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.6">
                <p id="section-toc.1-1.13.2.6.1"><a href="#section-13.6" class="auto internal xref">13.6</a>.  <a href="#name-collision-of-group-identifi" class="internal xref">Collision of Group Identifiers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.7">
                <p id="section-toc.1-1.13.2.7.1"><a href="#section-13.7" class="auto internal xref">13.7</a>.  <a href="#name-cross-group-message-injecti" class="internal xref">Cross-group Message Injection</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.7.2.1">
                    <p id="section-toc.1-1.13.2.7.2.1.1"><a href="#section-13.7.1" class="auto internal xref">13.7.1</a>.  <a href="#name-attack-description" class="internal xref">Attack Description</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.7.2.2">
                    <p id="section-toc.1-1.13.2.7.2.2.1"><a href="#section-13.7.2" class="auto internal xref">13.7.2</a>.  <a href="#name-attack-prevention-in-group-" class="internal xref">Attack Prevention in Group Mode</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.8">
                <p id="section-toc.1-1.13.2.8.1"><a href="#section-13.8" class="auto internal xref">13.8</a>.  <a href="#name-prevention-of-group-cloning" class="internal xref">Prevention of Group Cloning Attack</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.9">
                <p id="section-toc.1-1.13.2.9.1"><a href="#section-13.9" class="auto internal xref">13.9</a>.  <a href="#name-group-oscore-for-unicast-re" class="internal xref">Group OSCORE for Unicast Requests</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.10">
                <p id="section-toc.1-1.13.2.10.1"><a href="#section-13.10" class="auto internal xref">13.10</a>. <a href="#name-end-to-end-protection" class="internal xref">End-to-end Protection</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.11">
                <p id="section-toc.1-1.13.2.11.1"><a href="#section-13.11" class="auto internal xref">13.11</a>. <a href="#name-master-secret" class="internal xref">Master Secret</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.12">
                <p id="section-toc.1-1.13.2.12.1"><a href="#section-13.12" class="auto internal xref">13.12</a>. <a href="#name-replay-protection-2" class="internal xref">Replay Protection</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.13">
                <p id="section-toc.1-1.13.2.13.1"><a href="#section-13.13" class="auto internal xref">13.13</a>. <a href="#name-message-ordering" class="internal xref">Message Ordering</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.14">
                <p id="section-toc.1-1.13.2.14.1"><a href="#section-13.14" class="auto internal xref">13.14</a>. <a href="#name-message-freshness" class="internal xref">Message Freshness</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.15">
                <p id="section-toc.1-1.13.2.15.1"><a href="#section-13.15" class="auto internal xref">13.15</a>. <a href="#name-client-aliveness" class="internal xref">Client Aliveness</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.16">
                <p id="section-toc.1-1.13.2.16.1"><a href="#section-13.16" class="auto internal xref">13.16</a>. <a href="#name-cryptographic-consideration" class="internal xref">Cryptographic Considerations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.17">
                <p id="section-toc.1-1.13.2.17.1"><a href="#section-13.17" class="auto internal xref">13.17</a>. <a href="#name-message-segmentation" class="internal xref">Message Segmentation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.18">
                <p id="section-toc.1-1.13.2.18.1"><a href="#section-13.18" class="auto internal xref">13.18</a>. <a href="#name-privacy-considerations" class="internal xref">Privacy Considerations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="auto internal xref">14</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#section-14.1" class="auto internal xref">14.1</a>.  <a href="#name-oscore-flag-bits-registry" class="internal xref">OSCORE Flag Bits Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#section-14.2" class="auto internal xref">14.2</a>.  <a href="#name-coap-option-numbers-registr" class="internal xref">CoAP Option Numbers Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#section-14.3" class="auto internal xref">14.3</a>.  <a href="#name-target-attributes-registry" class="internal xref">Target Attributes Registry</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="auto internal xref">15</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#section-15.1" class="auto internal xref">15.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#section-15.2" class="auto internal xref">15.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-assumptions-and-security-ob" class="internal xref">Assumptions and Security Objectives</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-assumptions" class="internal xref">Assumptions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-security-objectives" class="internal xref">Security Objectives</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-list-of-use-cases" class="internal xref">List of Use Cases</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-example-of-group-identifier" class="internal xref">Example of Group Identifier Format</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#appendix-D" class="auto internal xref">Appendix D</a>.  <a href="#name-document-updates" class="internal xref">Document Updates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.1">
                <p id="section-toc.1-1.19.2.1.1"><a href="#appendix-D.1" class="auto internal xref">D.1</a>.  <a href="#name-version-21-to-22" class="internal xref">Version -21 to -22</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.2">
                <p id="section-toc.1-1.19.2.2.1"><a href="#appendix-D.2" class="auto internal xref">D.2</a>.  <a href="#name-version-20-to-21" class="internal xref">Version -20 to -21</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.3">
                <p id="section-toc.1-1.19.2.3.1"><a href="#appendix-D.3" class="auto internal xref">D.3</a>.  <a href="#name-version-19-to-20" class="internal xref">Version -19 to -20</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.4">
                <p id="section-toc.1-1.19.2.4.1"><a href="#appendix-D.4" class="auto internal xref">D.4</a>.  <a href="#name-version-18-to-19" class="internal xref">Version -18 to -19</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.5">
                <p id="section-toc.1-1.19.2.5.1"><a href="#appendix-D.5" class="auto internal xref">D.5</a>.  <a href="#name-version-17-to-18" class="internal xref">Version -17 to -18</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.6">
                <p id="section-toc.1-1.19.2.6.1"><a href="#appendix-D.6" class="auto internal xref">D.6</a>.  <a href="#name-version-16-to-17" class="internal xref">Version -16 to -17</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.7">
                <p id="section-toc.1-1.19.2.7.1"><a href="#appendix-D.7" class="auto internal xref">D.7</a>.  <a href="#name-version-15-to-16" class="internal xref">Version -15 to -16</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.8">
                <p id="section-toc.1-1.19.2.8.1"><a href="#appendix-D.8" class="auto internal xref">D.8</a>.  <a href="#name-version-14-to-15" class="internal xref">Version -14 to -15</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.9">
                <p id="section-toc.1-1.19.2.9.1"><a href="#appendix-D.9" class="auto internal xref">D.9</a>.  <a href="#name-version-13-to-14" class="internal xref">Version -13 to -14</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.10">
                <p id="section-toc.1-1.19.2.10.1"><a href="#appendix-D.10" class="auto internal xref">D.10</a>. <a href="#name-version-12-to-13" class="internal xref">Version -12 to -13</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.11">
                <p id="section-toc.1-1.19.2.11.1"><a href="#appendix-D.11" class="auto internal xref">D.11</a>. <a href="#name-version-11-to-12" class="internal xref">Version -11 to -12</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.12">
                <p id="section-toc.1-1.19.2.12.1"><a href="#appendix-D.12" class="auto internal xref">D.12</a>. <a href="#name-version-10-to-11" class="internal xref">Version -10 to -11</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.13">
                <p id="section-toc.1-1.19.2.13.1"><a href="#appendix-D.13" class="auto internal xref">D.13</a>. <a href="#name-version-09-to-10" class="internal xref">Version -09 to -10</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.14">
                <p id="section-toc.1-1.19.2.14.1"><a href="#appendix-D.14" class="auto internal xref">D.14</a>. <a href="#name-version-08-to-09" class="internal xref">Version -08 to -09</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.15">
                <p id="section-toc.1-1.19.2.15.1"><a href="#appendix-D.15" class="auto internal xref">D.15</a>. <a href="#name-version-07-to-08" class="internal xref">Version -07 to -08</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.16">
                <p id="section-toc.1-1.19.2.16.1"><a href="#appendix-D.16" class="auto internal xref">D.16</a>. <a href="#name-version-06-to-07" class="internal xref">Version -06 to -07</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.17">
                <p id="section-toc.1-1.19.2.17.1"><a href="#appendix-D.17" class="auto internal xref">D.17</a>. <a href="#name-version-05-to-06" class="internal xref">Version -05 to -06</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.18">
                <p id="section-toc.1-1.19.2.18.1"><a href="#appendix-D.18" class="auto internal xref">D.18</a>. <a href="#name-version-04-to-05" class="internal xref">Version -04 to -05</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.19">
                <p id="section-toc.1-1.19.2.19.1"><a href="#appendix-D.19" class="auto internal xref">D.19</a>. <a href="#name-version-03-to-04" class="internal xref">Version -03 to -04</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.20">
                <p id="section-toc.1-1.19.2.20.1"><a href="#appendix-D.20" class="auto internal xref">D.20</a>. <a href="#name-version-02-to-03" class="internal xref">Version -02 to -03</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.21">
                <p id="section-toc.1-1.19.2.21.1"><a href="#appendix-D.21" class="auto internal xref">D.21</a>. <a href="#name-version-01-to-02" class="internal xref">Version -01 to -02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.22">
                <p id="section-toc.1-1.19.2.22.1"><a href="#appendix-D.22" class="auto internal xref">D.22</a>. <a href="#name-version-00-to-01" class="internal xref">Version -00 to -01</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.21">
            <p id="section-toc.1-1.21.1"><a href="#appendix-F" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> is a web transfer protocol specifically designed for constrained devices and networks <span>[<a href="#RFC7228" class="cite xref">RFC7228</a>]</span>. Group communication for CoAP <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span> addresses use cases where deployed devices benefit from a group communication model, for example to reduce latencies, improve performance, and reduce bandwidth utilization. Use cases include lighting control, integrated building control, software and firmware updates, parameter and configuration updates, commissioning of constrained networks, and emergency multicast (see <a href="#sec-use-cases" class="auto internal xref">Appendix B</a>). Group communication for CoAP <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span> mainly uses UDP/IP multicast as the underlying data transport.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Object Security for Constrained RESTful Environments (OSCORE) <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> describes a security protocol based on the exchange of protected CoAP messages. OSCORE builds on CBOR Object Signing and Encryption (COSE) <span>[<a href="#RFC9052" class="cite xref">RFC9052</a>]</span><span>[<a href="#RFC9053" class="cite xref">RFC9053</a>]</span> and provides end-to-end encryption, integrity, replay protection, and binding of response to request between a sender and a recipient, independent of the transport layer also in the presence of intermediaries.
To this end, a CoAP message is protected by including its payload (if any), certain options, and header fields into a COSE object, which is conveyed within the CoAP payload and the CoAP OSCORE Option of the protected message, thereby replacing those message fields with an authenticated and encrypted object.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document defines Group OSCORE, a security protocol for group communication with CoAP <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span> and for CoAP-mappable HTTP requests and responses, providing the same end-to-end security properties as OSCORE also in the case where requests have multiple recipients. In particular, the described protocol defines how OSCORE is used in a group communication setting to provide source authentication for group requests sent by a client to multiple servers, and for protection of the corresponding responses. Group OSCORE also defines a pairwise mode where each member of the group can efficiently derive a symmetric pairwise key with any other member of the group for pairwise-protected OSCORE communication. Just like OSCORE, Group OSCORE is independent of the transport layer and works wherever CoAP does.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">As with OSCORE, it is possible to combine Group OSCORE with communication security on other layers. One example is the use of transport layer security, such as DTLS <span>[<a href="#RFC9147" class="cite xref">RFC9147</a>]</span>, between one client and one proxy (and vice versa), or between one proxy and one server (and vice versa). This prevents observers from accessing addressing information conveyed in CoAP options that would not be protected by Group OSCORE, but would be protected by DTLS. These options include Uri-Host, Uri-Port, and Proxy-Uri. Note that DTLS does not define how to secure messages sent over IP multicast.
Group OSCORE is also intended to work with OSCORE-capable proxies <span>[<a href="#I-D.ietf-core-oscore-capable-proxies" class="cite xref">I-D.ietf-core-oscore-capable-proxies</a>]</span> thereby enabling, for example, nested OSCORE operations with OSCORE-protected communication between a CoAP client and a proxy, carrying messages that are additionally protected with Group OSCORE between the CoAP client and the target CoAP servers.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">Group OSCORE defines two modes of operation, that can be used independently or together:<a href="#section-1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-6.1">
          <p id="section-1-6.1.1">In the group mode, Group OSCORE requests and responses are digitally signed with the private key of the sender and the signature is embedded in the protected CoAP message. The group mode supports all COSE signature algorithms as well as signature verification by intermediaries. This mode is defined in <a href="#mess-processing" class="auto internal xref">Section 8</a>.<a href="#section-1-6.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-6.2">
          <p id="section-1-6.2.1">In the pairwise mode, two group members exchange OSCORE requests and responses (typically) over unicast, and the messages are protected with symmetric keys. These symmetric keys are derived from Diffie-Hellman shared secrets, calculated with the asymmetric keys of the sender and recipient, allowing for shorter integrity tags and therefore lower message overhead. This mode is defined in <a href="#sec-pairwise-protection" class="auto internal xref">Section 9</a>.<a href="#section-1-6.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-7">Both modes provide source authentication of CoAP messages. The application decides what mode to use, potentially on a per-message basis. Such decisions can be based, for instance, on pre-configured policies or dynamic assessing of the target recipient and/or resource, among other things. One important case is when requests are protected in group mode, and responses in pairwise mode. Since such responses convey shorter integrity tags instead of bigger, full-fledged signatures, this significantly reduces the message overhead in case of many responses to one request.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">A special deployment of Group OSCORE consists in using the pairwise mode only. For example, consider the case of a constrained-node network <span>[<a href="#RFC7228" class="cite xref">RFC7228</a>]</span> with a large number of CoAP endpoints and the objective to establish secure communication between any pair of endpoints with a small provisioning effort and message overhead. Since the total number of security associations that needs to be established grows with the square of the number of endpoints, it is desirable to restrict the amount of secret keying material provided to each endpoint. Moreover, a key establishment protocol would need to be executed for each security association. One solution to this issue is to deploy Group OSCORE, with the endpoints being part of a group, and to use the pairwise mode. This solution has the benefit of providing a single shared secret, while distributing only the public keys of group members or a subset of those. After that, a CoAP endpoint can locally derive the OSCORE Security Context for the other endpoint in the group, and protect CoAP communications with very low overhead <span>[<a href="#I-D.ietf-iotops-security-protocol-comparison" class="cite xref">I-D.ietf-iotops-security-protocol-comparison</a>]</span>.<a href="#section-1-8" class="pilcrow">¶</a></p>
<p id="section-1-9">In some circumstances, Group OSCORE messages may be transported in HTTP, e.g., when they are protected with the pairwise mode and target a single recipient, or when they are protected with the group mode and target multiple CoAP recipients through cross-protocol translators such as HTTP-to-CoAP proxies <span>[<a href="#RFC8075" class="cite xref">RFC8075</a>]</span><span>[<a href="#I-D.ietf-core-groupcomm-proxy" class="cite xref">I-D.ietf-core-groupcomm-proxy</a>]</span>. The use of Group OSCORE with HTTP is as defined for OSCORE in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-11" class="relref">Section 11</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-1-9" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Readers are expected to be familiar with the terms and concepts described in CoAP <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, including "endpoint", "client", "server", "sender", and "recipient"; group communication for CoAP <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>; Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>; CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>; COSE <span>[<a href="#RFC9052" class="cite xref">RFC9052</a>]</span><span>[<a href="#RFC9053" class="cite xref">RFC9053</a>]</span> and related countersignatures  <span>[<a href="#RFC9338" class="cite xref">RFC9338</a>]</span>.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">Readers are also expected to be familiar with the terms and concepts for protection and processing of CoAP messages through OSCORE, such as "Security Context" and "Master Secret", defined in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">Terminology for constrained environments, such as "constrained device" and "constrained-node network", is defined in <span>[<a href="#RFC7228" class="cite xref">RFC7228</a>]</span>.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">This document refers also to the following terminology.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-6.1">
            <p id="section-1.1-6.1.1">Keying material: data that is necessary to establish and maintain secure communication among endpoints. This includes, for instance, keys and IVs <span>[<a href="#RFC4949" class="cite xref">RFC4949</a>]</span>.<a href="#section-1.1-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.2">
            <p id="section-1.1-6.2.1">Authentication credential: information associated with an entity, including that entity's public key and parameters associated with the public key. Examples of authentication credentials are CBOR Web Tokens (CWTs) and CWT Claims Sets (CCSs) <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span>, X.509 certificates <span>[<a href="#RFC5280" class="cite xref">RFC5280</a>]</span> and C509 certificates <span>[<a href="#I-D.ietf-cose-cbor-encoded-cert" class="cite xref">I-D.ietf-cose-cbor-encoded-cert</a>]</span>. Further details about authentication credentials are provided in <a href="#sec-pub-key-format" class="auto internal xref">Section 2.4</a>.<a href="#section-1.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.3">
            <p id="section-1.1-6.3.1">Group: a set of endpoints that share group keying material and security parameters (Common Context, see <a href="#sec-context" class="auto internal xref">Section 2</a>). That is, unless otherwise specified, the term group used in this document refers to a "security group" (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-2.1" class="relref">Section 2.1</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>), not to be confused with "CoAP group" or "application group".<a href="#section-1.1-6.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.4">
            <p id="section-1.1-6.4.1">Group Manager: an entity responsible for a group, neither required to be an actual group member nor to take part in the group communication. The responsibilities of the Group Manager are listed in <a href="#sec-group-manager" class="auto internal xref">Section 3.4</a>.<a href="#section-1.1-6.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.5">
            <p id="section-1.1-6.5.1">Silent server: a member of a group that performs only group mode processing on incoming requests and never sends responses protected with Group OSCORE. For CoAP group communications, requests are normally sent without necessarily expecting a response. A silent server may send unprotected responses, as error responses reporting a Group OSCORE error.<a href="#section-1.1-6.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.6">
            <p id="section-1.1-6.6.1">Group Identifier (Gid): identifier assigned to the group, unique within the set of groups of a given Group Manager.<a href="#section-1.1-6.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.7">
            <p id="section-1.1-6.7.1">Birth Gid: with respect to a group member, the Gid obtained by that group member upon (re-)joining the group.<a href="#section-1.1-6.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.8">
            <p id="section-1.1-6.8.1">Key Generation Number: an integer value identifying the current version of the keying material used in a group.<a href="#section-1.1-6.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.9">
            <p id="section-1.1-6.9.1">Source authentication: evidence that a received message in the group originated from a specific identified group member. This also provides assurance that the message was not tampered with by anyone, be it a different legitimate group member or an endpoint which is not a group member.<a href="#section-1.1-6.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.10">
            <p id="section-1.1-6.10.1">Group request: a CoAP request message sent by a client in the group to servers in that group.<a href="#section-1.1-6.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-6.11">
            <p id="section-1.1-6.11.1">Long exchange: an exchange of messages associated with a request that is a group request and/or an Observe request <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>.<a href="#section-1.1-6.11.1" class="pilcrow">¶</a></p>
<p id="section-1.1-6.11.2">
In either case, multiple responses can follow from the same server to the request associated with the long exchange. The client terminates a long exchange when freeing up the CoAP Token value used for the associated request, for which no further responses will be accepted afterwards.<a href="#section-1.1-6.11.2" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-context">
<section id="section-2">
      <h2 id="name-security-context">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-security-context" class="section-name selfRef">Security Context</a>
      </h2>
<p id="section-2-1">This document refers to a group as a set of endpoints sharing keying material and security parameters for executing the Group OSCORE protocol, see <a href="#terminology" class="auto internal xref">Section 1.1</a>. All members of a group maintain a Security Context as defined in this section.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">How the Security Context is established by the group members is out of scope for this document, but if there is more than one Security Context applicable to a message, then the endpoints <span class="bcp14">MUST</span> be able to tell which Security Context was latest established. How to manage information about the group is described in terms of a Group Manager (see <a href="#group-manager" class="auto internal xref">Section 3</a>).<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">An endpoint of the group may use the group mode (see <a href="#mess-processing" class="auto internal xref">Section 8</a>), the pairwise mode (see <a href="#sec-pairwise-protection" class="auto internal xref">Section 9</a>), or both, depending on the modes it supports and on the parameters of the Security Context.
The Security Context of Group OSCORE extends the OSCORE Security Context defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3" class="relref">Section 3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> as follows (see <a href="#fig-additional-context-information" class="auto internal xref">Figure 1</a>).<a href="#section-2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-4.1">
          <p id="section-2-4.1.1">One Common Context, shared by all the endpoints in the group and extended as defined below.<a href="#section-2-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-4.1.2.1">
              <p id="section-2-4.1.2.1.1">The new parameter Authentication Credential Format, specifying the format of authentication credentials used in the group (see <a href="#ssec-common-context-authcred-format" class="auto internal xref">Section 2.1.4</a>).<a href="#section-2-4.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2-4.1.2.2">
              <p id="section-2-4.1.2.2.1">The new parameter Group Manager Authentication Credential, specifying the authentication credential of the Group Manager responsible for the group (see <a href="#ssec-common-context-gm-pub-key" class="auto internal xref">Section 2.1.5</a>).<a href="#section-2-4.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2-4.1.2.3">
              <p id="section-2-4.1.2.3.1">For the group mode, the Common Context is extended with the following new parameters.<a href="#section-2-4.1.2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-4.1.2.3.2.1">
                  <p id="section-2-4.1.2.3.2.1.1">Group Encryption Algorithm, used for encrypting and decrypting messages protected in group mode (see <a href="#ssec-common-context-cs-enc-alg" class="auto internal xref">Section 2.1.6</a>).<a href="#section-2-4.1.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2-4.1.2.3.2.2">
                  <p id="section-2-4.1.2.3.2.2.1">Signature Algorithm, used for computing and verifying the countersignature of messages protected in group mode (see <a href="#ssec-common-context-cs-alg" class="auto internal xref">Section 2.1.7</a>).<a href="#section-2-4.1.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2-4.1.2.3.2.3">
                  <p id="section-2-4.1.2.3.2.3.1">Signature Encryption Key, used for encrypting and decrypting the countersignature of messages protected in group mode (see <a href="#ssec-common-context-group-enc-key" class="auto internal xref">Section 2.1.8</a>).<a href="#section-2-4.1.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-2-4.1.2.4">
              <p id="section-2-4.1.2.4.1">For the pairwise mode, the Common Context is extended with a Pairwise Key Agreement Algorithm (see <a href="#ssec-common-context-dh-alg" class="auto internal xref">Section 2.1.9</a>) used for the agreement on a static-static Diffie-Hellman shared secret, from which pairwise keys are derived (see <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a>).<a href="#section-2-4.1.2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li class="normal" id="section-2-4.2">
          <p id="section-2-4.2.1">One Sender Context, extended with the following new parameters.<a href="#section-2-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-4.2.2.1">
              <p id="section-2-4.2.2.1.1">The endpoint's own private key used to sign messages protected in group mode (see <a href="#mess-processing" class="auto internal xref">Section 8</a>), or for deriving pairwise keys used with the pairwise mode (see <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a>).<a href="#section-2-4.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2-4.2.2.2">
              <p id="section-2-4.2.2.2.1">The endpoint's own authentication credential containing its public key (see <a href="#sec-pub-key-format" class="auto internal xref">Section 2.4</a>).<a href="#section-2-4.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2-4.2.2.3">
              <p id="section-2-4.2.2.3.1">For the pairwise mode, the Sender Context is extended with the Pairwise Sender Keys associated with the other endpoints (see <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a>).<a href="#section-2-4.2.2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2-4.2.3">
If the endpoint is configured exclusively as silent server (see <a href="#terminology" class="auto internal xref">Section 1.1</a>), then the Sender Context is omitted.<a href="#section-2-4.2.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-4.3">
          <p id="section-2-4.3.1">One Recipient Context for each other endpoint from which messages are received. It is not necessary to maintain Recipient Contexts associated with endpoints from which messages are not (expected to be) received.<a href="#section-2-4.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-4.3.2.1">
              <p id="section-2-4.3.2.1.1">Each Recipient Context is extended with the authentication credential of the other endpoint, used to verify the signature of messages protected in group mode, or for deriving the pairwise keys used with the pairwise mode (see <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a>).<a href="#section-2-4.3.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2-4.3.2.2">
              <p id="section-2-4.3.2.2.1">For the pairwise mode, each Recipient Context is extended with the Pairwise Recipient Key associated with the other endpoint (see <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a>).<a href="#section-2-4.3.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ul>
<span id="name-additions-to-the-oscore-sec"></span><div id="fig-additional-context-information">
<figure id="figure-1">
        <div class="alignCenter art-text artwork" id="section-2-5.1">
<pre>
+-------------------+-------------------------------------------------+
| Context Component | New Information Elements                        |
+-------------------+-------------------------------------------------+
| Common Context    |   Authentication Credential Format              |
|                   |   Group Manager Authentication Credential       |
|                   | * Group Encryption Algorithm                    |
|                   | * Signature Algorithm                           |
|                   | * Signature Encryption Key                      |
|                   | ^ Pairwise Key Agreement Algorithm              |
+-------------------+-------------------------------------------------+
| Sender Context    |   Endpoint's own private key                    |
|                   |   Endpoint's own authentication credential      |
|                   | ^ Pairwise Sender Keys for the other endpoints  |
+-------------------+-------------------------------------------------+
| Each              |   Other endpoint's authentication credential    |
| Recipient Context | ^ Pairwise Recipient Key for the other endpoint |
+-------------------+-------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-additions-to-the-oscore-sec" class="selfRef">Additions to the OSCORE Security Context. The elements labeled with * and with ^ are relevant only for the group mode and only for the pairwise mode, respectively.</a>
        </figcaption></figure>
</div>
<div id="ssec-common-context">
<section id="section-2.1">
        <h3 id="name-common-context">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-common-context" class="section-name selfRef">Common Context</a>
        </h3>
<p id="section-2.1-1">The following sections specify how the Common Context is used and extended compared to <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. All algorithms (AEAD, Group Encryption, Signature, Pairwise Key Agreement) are immutable once the Common Context is established.
The Common Context may be acquired from the Group Manager (see <a href="#group-manager" class="auto internal xref">Section 3</a>).<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<div id="ssec-common-context-aead-alg">
<section id="section-2.1.1">
          <h4 id="name-aead-algorithm">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-aead-algorithm" class="section-name selfRef">AEAD Algorithm</a>
          </h4>
<p id="section-2.1.1-1">The AEAD Algorithm (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>) <span class="bcp14">SHALL</span> identify the COSE AEAD algorithm to use for encryption and decryption when messages are protected using the pairwise mode (see <a href="#sec-pairwise-protection" class="auto internal xref">Section 9</a>). This algorithm <span class="bcp14">MUST</span> provide integrity protection. If this parameter is not set, the pairwise mode is not used in the group.<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-common-context-id-context">
<section id="section-2.1.2">
          <h4 id="name-id-context">
<a href="#section-2.1.2" class="section-number selfRef">2.1.2. </a><a href="#name-id-context" class="section-name selfRef">ID Context</a>
          </h4>
<p id="section-2.1.2-1">The ID Context parameter (see Sections <a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">3.1</a> and <a href="https://rfc-editor.org/rfc/rfc8613#section-3.3" class="relref">3.3</a> of <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>) <span class="bcp14">SHALL</span> contain the Group Identifier (Gid) of the group. The choice of the Gid format is application specific. An example of specific formatting of the Gid is given in <a href="#gid-ex" class="auto internal xref">Appendix C</a>. The application needs to specify how to handle potential collisions between Gids (see <a href="#ssec-gid-collision" class="auto internal xref">Section 13.6</a>).<a href="#section-2.1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-common-common-iv">
<section id="section-2.1.3">
          <h4 id="name-common-iv">
<a href="#section-2.1.3" class="section-number selfRef">2.1.3. </a><a href="#name-common-iv" class="section-name selfRef">Common IV</a>
          </h4>
<p id="section-2.1.3-1">The Common IV parameter (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>) <span class="bcp14">SHALL</span> identify the Common IV used in the group. Differently from OSCORE, the length of the Common IV is determined as follows.<a href="#section-2.1.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1.3-2.1">
              <p id="section-2.1.3-2.1.1">If only one among the AEAD Algorithm and the Group Encryption Algorithm is set (see <a href="#ssec-common-context-aead-alg" class="auto internal xref">Section 2.1.1</a> and <a href="#ssec-common-context-cs-enc-alg" class="auto internal xref">Section 2.1.6</a>), the length of the Common IV is the AEAD nonce length for the set algorithm.<a href="#section-2.1.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.3-2.2">
              <p id="section-2.1.3-2.2.1">If both the AEAD Algorithm and the Group Encryption Algorithm are set, the length of the Common IV is the greatest AEAD nonce length among those of the two algorithms.<a href="#section-2.1.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="ssec-common-context-authcred-format">
<section id="section-2.1.4">
          <h4 id="name-authentication-credential-f">
<a href="#section-2.1.4" class="section-number selfRef">2.1.4. </a><a href="#name-authentication-credential-f" class="section-name selfRef">Authentication Credential Format</a>
          </h4>
<p id="section-2.1.4-1">The new parameter Authentication Credential Format specifies the format of authentication credentials used in the group. Further details on authentication credentials are compiled in <a href="#sec-pub-key-format" class="auto internal xref">Section 2.4</a>.<a href="#section-2.1.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-common-context-gm-pub-key">
<section id="section-2.1.5">
          <h4 id="name-group-manager-authenticatio">
<a href="#section-2.1.5" class="section-number selfRef">2.1.5. </a><a href="#name-group-manager-authenticatio" class="section-name selfRef">Group Manager Authentication Credential</a>
          </h4>
<p id="section-2.1.5-1">The new parameter Group Manager Authentication Credential specifies the authentication credential of the Group Manager, including the Group Manager's public key. The endpoint <span class="bcp14">MUST</span> achieve proof-of-possession of the corresponding private key. Further details on the provisioning of the Group Manager's authentication credential to the group members are out of the scope of this document.<a href="#section-2.1.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-common-context-cs-enc-alg">
<section id="section-2.1.6">
          <h4 id="name-group-encryption-algorithm">
<a href="#section-2.1.6" class="section-number selfRef">2.1.6. </a><a href="#name-group-encryption-algorithm" class="section-name selfRef">Group Encryption Algorithm</a>
          </h4>
<p id="section-2.1.6-1">The new parameter Group Encryption Algorithm identifies the algorithm to use for encryption and decryption, when messages are protected in group mode (see <a href="#mess-processing" class="auto internal xref">Section 8</a>). This algorithm <span class="bcp14">MAY</span> provide integrity protection. If this parameter is not set, the group mode is not used in the group.<a href="#section-2.1.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-common-context-cs-alg">
<section id="section-2.1.7">
          <h4 id="name-signature-algorithm">
<a href="#section-2.1.7" class="section-number selfRef">2.1.7. </a><a href="#name-signature-algorithm" class="section-name selfRef">Signature Algorithm</a>
          </h4>
<p id="section-2.1.7-1">The new parameter Signature Algorithm identifies the digital signature algorithm used for computing and verifying the countersignature on the COSE object (see Sections <a href="https://rfc-editor.org/rfc/rfc9338#section-3.2" class="relref">3.2</a> and <a href="https://rfc-editor.org/rfc/rfc9338#section-3.3" class="relref">3.3</a> of <span>[<a href="#RFC9338" class="cite xref">RFC9338</a>]</span>), when messages are protected in group mode (see <a href="#mess-processing" class="auto internal xref">Section 8</a>). If this parameter is not set, the group mode is not used in the group.<a href="#section-2.1.7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-common-context-group-enc-key">
<section id="section-2.1.8">
          <h4 id="name-signature-encryption-key">
<a href="#section-2.1.8" class="section-number selfRef">2.1.8. </a><a href="#name-signature-encryption-key" class="section-name selfRef">Signature Encryption Key</a>
          </h4>
<p id="section-2.1.8-1">The new parameter Signature Encryption Key specifies the encryption key for deriving a keystream to encrypt/decrypt a countersignature, when a message is protected in group mode (see <a href="#mess-processing" class="auto internal xref">Section 8</a>).<a href="#section-2.1.8-1" class="pilcrow">¶</a></p>
<p id="section-2.1.8-2">The Signature Encryption Key is derived as defined for Sender/Recipient Keys in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the following differences.<a href="#section-2.1.8-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1.8-3.1">
              <p id="section-2.1.8-3.1.1">The 'id' element of the 'info' array is the empty byte string.<a href="#section-2.1.8-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.8-3.2">
              <p id="section-2.1.8-3.2.1">The 'alg_aead' element of the 'info' array specifies the Group Encryption Algorithm from the Common Context (see <a href="#ssec-common-context-cs-enc-alg" class="auto internal xref">Section 2.1.6</a>), encoded as a CBOR integer or text string, consistently with the "Value" field in the "COSE Algorithms" Registry for this algorithm.<a href="#section-2.1.8-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.8-3.3">
              <p id="section-2.1.8-3.3.1">The 'type' element of the 'info' array is "SEKey". The label is an ASCII string and does not include a trailing NUL byte.<a href="#section-2.1.8-3.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.8-3.4">
              <p id="section-2.1.8-3.4.1">L and the 'L' element of the 'info' array are the size of the key for the Group Encryption Algorithm specified in the Common Context (see <a href="#ssec-common-context-cs-enc-alg" class="auto internal xref">Section 2.1.6</a>), in bytes. While the obtained Signature Encryption Key is never used with the Group Encryption Algorithm, its length was chosen to obtain a matching level of security.<a href="#section-2.1.8-3.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="ssec-common-context-dh-alg">
<section id="section-2.1.9">
          <h4 id="name-pairwise-key-agreement-algo">
<a href="#section-2.1.9" class="section-number selfRef">2.1.9. </a><a href="#name-pairwise-key-agreement-algo" class="section-name selfRef">Pairwise Key Agreement Algorithm</a>
          </h4>
<p id="section-2.1.9-1">The new parameter Pairwise Key Agreement Algorithm identifies the elliptic curve Diffie-Hellman algorithm used to derive a static-static Diffie-Hellman shared secret, from which pairwise keys are derived (see <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a>) to protect messages with the pairwise mode (see <a href="#sec-pairwise-protection" class="auto internal xref">Section 9</a>). If this parameter is not set, the pairwise mode is not used in the group.<a href="#section-2.1.9-1" class="pilcrow">¶</a></p>
<p id="section-2.1.9-2">If the HKDF Algorithm specified in the Common Context is "HKDF SHA-256" (identified as "HMAC 256/256"), then the Pairwise Key Agreement Algorithm is "ECDH-SS + HKDF-256" (COSE algorithm encoding: -27).<a href="#section-2.1.9-2" class="pilcrow">¶</a></p>
<p id="section-2.1.9-3">If the HKDF Algorithm specified in the Common Context is "HKDF SHA-512" (identified as "HMAC 512/512"), then the Pairwise Key Agreement Algorithm is "ECDH-SS + HKDF-512" (COSE algorithm encoding: -28).<a href="#section-2.1.9-3" class="pilcrow">¶</a></p>
<p id="section-2.1.9-4">Note that the HKDF Algorithm in the Common Context is denoted by the corresponding COSE HMAC Algorithm. For example, the HKDF Algorithm "HKDF SHA-256" is specified as the HMAC Algorithm "HMAC 256/256".<a href="#section-2.1.9-4" class="pilcrow">¶</a></p>
<p id="section-2.1.9-5">More generally, if Pairwise Key Agreement Algorithm is set, it <span class="bcp14">MUST</span> identify a COSE algorithm such that: i) it performs a direct ECDH Static-Static key agreement; and ii) it indicates the use of the same HKDF Algorithm used in the group as specified in the Common Context.<a href="#section-2.1.9-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssec-sender-recipient-context">
<section id="section-2.2">
        <h3 id="name-sender-context-and-recipien">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-sender-context-and-recipien" class="section-name selfRef">Sender Context and Recipient Context</a>
        </h3>
<p id="section-2.2-1">The Sender ID <span class="bcp14">SHALL</span> be unique for each endpoint in a group with a certain triplet (Master Secret, Master Salt, Group Identifier), see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.3" class="relref">Section 3.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">The maximum length of a Sender ID in bytes equals L minus 6, where L is determined as follows.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-3.1">
            <p id="section-2.2-3.1.1">If only one among the AEAD Algorithm and the Group Encryption Algorithm is set (see <a href="#ssec-common-context-aead-alg" class="auto internal xref">Section 2.1.1</a> and <a href="#ssec-common-context-cs-enc-alg" class="auto internal xref">Section 2.1.6</a>), then L is the AEAD nonce length for the set algorithm.<a href="#section-2.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-3.2">
            <p id="section-2.2-3.2.1">If both the AEAD Algorithm and the Group Encryption Algorithm are set, then L is the smallest AEAD nonce length among those of the two algorithms.<a href="#section-2.2-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.2-4">With the exception of the authentication credential of the sender endpoint, a receiver endpoint can derive a complete Security Context from a received Group OSCORE message and the Common Context (see <a href="#ssec-establishment-context-parameters" class="auto internal xref">Section 2.3</a>).<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5">The authentication credentials in the Recipient Contexts can be retrieved from the Group Manager (see <a href="#group-manager" class="auto internal xref">Section 3</a>) upon joining the group. An authentication credential can alternatively be acquired from the Group Manager at a later time, for example the first time a message is received from a particular endpoint in the group (see <a href="#ssec-verify-request" class="auto internal xref">Section 8.2</a> and <a href="#ssec-verify-response" class="auto internal xref">Section 8.4</a>).<a href="#section-2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.2-6">For severely constrained devices, it may be infeasible to simultaneously handle the ongoing processing of a recently received message in parallel with the retrieval of the sender endpoint's authentication credential. Such devices can be configured to drop a received message for which there is no (complete) Recipient Context, and retrieve the sender endpoint's authentication credential in order to have it available to verify subsequent messages from that endpoint.<a href="#section-2.2-6" class="pilcrow">¶</a></p>
<p id="section-2.2-7">An endpoint may admit a maximum number of Recipient Contexts for a same Security Context, e.g., due to memory limitations. After reaching that limit, the endpoint has to delete a current Recipient Context to install a new one (see <a href="#ssec-loss-mutable-context-overflow" class="auto internal xref">Section 2.6.1.2</a>). It is up to the application to define policies for Recipient Contexts to delete.<a href="#section-2.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-establishment-context-parameters">
<section id="section-2.3">
        <h3 id="name-establishment-of-security-c">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-establishment-of-security-c" class="section-name selfRef">Establishment of Security Context Parameters</a>
        </h3>
<p id="section-2.3-1">OSCORE defines the derivation of Sender Context and Recipient Context (specifically, of Sender/Recipient Keys) and of the Common IV, from a set of input parameters (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>).<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">The derivation of Sender/Recipient Keys and of the Common IV defined in OSCORE applies also to Group OSCORE, with the following modifications compared to <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3-3.1">
            <p id="section-2.3-3.1.1">If Group Encryption Algorithm in the Common Context is set (see <a href="#ssec-common-context-cs-enc-alg" class="auto internal xref">Section 2.1.6</a>), then the 'alg_aead' element of the 'info' array <span class="bcp14">MUST</span> specify Group Encryption Algorithm from the Common Context as a CBOR integer or text string, consistently with the "Value" field in the "COSE Algorithms" Registry for this algorithm.<a href="#section-2.3-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.3-3.2">
            <p id="section-2.3-3.2.1">If Group Encryption Algorithm in the Common Context is not set, then the 'alg_aead' element of the 'info' array <span class="bcp14">MUST</span> specify AEAD Algorithm from the Common Context (see <a href="#ssec-common-context-aead-alg" class="auto internal xref">Section 2.1.1</a>), as per <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">Section 5.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-2.3-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.3-3.3">
            <p id="section-2.3-3.3.1">When deriving the Common IV, the 'L' element of the 'info' array <span class="bcp14">MUST</span> specify the length of the Common IV in bytes, which is determined as defined in <a href="#ssec-common-common-iv" class="auto internal xref">Section 2.1.3</a>.<a href="#section-2.3-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-pub-key-format">
<section id="section-2.4">
        <h3 id="name-authentication-credentials">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-authentication-credentials" class="section-name selfRef">Authentication Credentials</a>
        </h3>
<p id="section-2.4-1">The authentication credentials of the endpoints in a group <span class="bcp14">MUST</span> be encoded according to the format used in the group, as indicated by the Authentication Credential Format parameter in the Common Context (see <a href="#ssec-common-context-authcred-format" class="auto internal xref">Section 2.1.4</a>). The authentication credential of the Group Manager <span class="bcp14">SHOULD</span> be encoded according to that same format. The format of authentication credentials <span class="bcp14">MUST</span> provide the public key and a comprehensive set of information related to the public key algorithm, including, e.g., the used elliptic curve (when applicable).<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">If Group Encryption Algorithm in the Common Context is not set (see <a href="#ssec-common-context-cs-enc-alg" class="auto internal xref">Section 2.1.6</a>), then the public key algorithm is the Pairwise Key Agreement Algorithm used in the group (see <a href="#ssec-common-context-dh-alg" class="auto internal xref">Section 2.1.9</a>), else the Signature Algorithm used in the group (see <a href="#ssec-common-context-cs-alg" class="auto internal xref">Section 2.1.7</a>).<a href="#section-2.4-2" class="pilcrow">¶</a></p>
<p id="section-2.4-3">If the authentication credentials are X.509 certificates <span>[<a href="#RFC5280" class="cite xref">RFC5280</a>]</span> or C509 certificates <span>[<a href="#I-D.ietf-cose-cbor-encoded-cert" class="cite xref">I-D.ietf-cose-cbor-encoded-cert</a>]</span>, the public key algorithm is fully described by the "algorithm" field of the "SubjectPublicKeyInfo" structure, and by the "subjectPublicKeyAlgorithm" element, respectively.<a href="#section-2.4-3" class="pilcrow">¶</a></p>
<p id="section-2.4-4">If authentication credentials are CBOR Web Tokens (CWTs) or CWT Claims Sets (CCSs) <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span>, the public key algorithm is fully described by a COSE key type and its "kty" and "crv" parameters.<a href="#section-2.4-4" class="pilcrow">¶</a></p>
<p id="section-2.4-5">Authentication credentials are used to derive pairwise keys (see <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a>) and are included in the external additional authenticated data when processing messages (see <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a>). In both these cases, an endpoint in a group <span class="bcp14">MUST</span> treat authentication credentials as opaque data, i.e., by considering the same binary representation made available to other endpoints in the group, possibly through a designated trusted source (e.g., the Group Manager).<a href="#section-2.4-5" class="pilcrow">¶</a></p>
<p id="section-2.4-6">For example, an X.509 certificate is provided as its direct binary serialization. If C509 certificates or CWTs are used as authentication credentials, each is provided as the binary serialization of a (possibly tagged) CBOR array. If CCSs are used as authentication credentials, each is provided as the binary serialization of a CBOR map.<a href="#section-2.4-6" class="pilcrow">¶</a></p>
<p id="section-2.4-7">If authentication credentials are CWTs, then the untagged CWT associated with an entity is stored in the Security Context and used as authentication credential for that entity.<a href="#section-2.4-7" class="pilcrow">¶</a></p>
<p id="section-2.4-8">If authentication credentials are X.509 / C509 certificates or CWTs, and the authentication credential associated with an entity is provided within a chain or a bag, then only the end-entity certificate or end-entity untagged CWT is stored in the Security Context and used as authentication credential for that entity.<a href="#section-2.4-8" class="pilcrow">¶</a></p>
<p id="section-2.4-9">Storing whole authentication credentials rather than only a subset of those may result in a non-negligible storage overhead. On the other hand, it also ensures that authentication credentials are correctly used in a simple, flexible and non-error-prone way, also taking into account future credential formats as entirely new or extending existing ones. In particular, it is ensured that:<a href="#section-2.4-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.4-10.1">
            <p id="section-2.4-10.1.1">When used to derive pairwise keys and when included in the external additional authenticated data, authentication credentials can also specify possible metadata and parameters related to the included public key. Besides the public key algorithm, these comprise other relevant pieces of information such as key usage, expiration time, issuer, and subject.<a href="#section-2.4-10.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.4-10.2">
            <p id="section-2.4-10.2.1">All endpoints using another endpoint's authentication credential use exactly the same binary serialization, as obtained and distributed by the credential provider (e.g., the Group Manager), and as originally crafted by the credential issuer. In turn, this does not require to define and maintain canonical subsets of authentication credentials and their corresponding encoding, and spares endpoints from error-prone re-encoding operations.<a href="#section-2.4-10.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.4-11">Depending on the particular deployment and the intended group size, limiting the storage overhead of endpoints in a group can be an incentive for system/network administrators to prefer using a compact format of authentication credentials in the first place.<a href="#section-2.4-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-derivation-pairwise">
<section id="section-2.5">
        <h3 id="name-pairwise-keys">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-pairwise-keys" class="section-name selfRef">Pairwise Keys</a>
        </h3>
<p id="section-2.5-1">Certain signature schemes, such as EdDSA and ECDSA, support a secure combined signature and encryption scheme. This section specifies the derivation of "pairwise keys", for use in the pairwise mode defined in <a href="#sec-pairwise-protection" class="auto internal xref">Section 9</a>.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.5-2">Group OSCORE keys used for both signature and encryption <span class="bcp14">MUST</span> be used only for purposes related to Group OSCORE. These include the processing of messages with Group OSCORE, as well as performing proof-of-possession of private keys, e.g., upon joining a group through the Group Manager (see <a href="#group-manager" class="auto internal xref">Section 3</a>).<a href="#section-2.5-2" class="pilcrow">¶</a></p>
<div id="key-derivation-pairwise">
<section id="section-2.5.1">
          <h4 id="name-derivation-of-pairwise-keys">
<a href="#section-2.5.1" class="section-number selfRef">2.5.1. </a><a href="#name-derivation-of-pairwise-keys" class="section-name selfRef">Derivation of Pairwise Keys</a>
          </h4>
<p id="section-2.5.1-1">Using the Group OSCORE Security Context (see <a href="#sec-context" class="auto internal xref">Section 2</a>), a group member can derive AEAD keys, to protect point-to-point communication between itself and any other endpoint X in the group by means of the AEAD Algorithm from the Common Context (see <a href="#ssec-common-context-aead-alg" class="auto internal xref">Section 2.1.1</a>). The key derivation of these so-called pairwise keys follows the same construction as in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>:<a href="#section-2.5.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.5.1-2">
<pre>
Pairwise Sender Key    = HKDF(Sender Key, IKM-Sender, info, L)
Pairwise Recipient Key = HKDF(Recipient Key, IKM-Recipient, info, L)

with

IKM-Sender    = Sender Auth Cred | Recipient Auth Cred | Shared Secret
IKM-Recipient = Recipient Auth Cred | Sender Auth Cred | Shared Secret
</pre><a href="#section-2.5.1-2" class="pilcrow">¶</a>
</div>
<p id="section-2.5.1-3">where:<a href="#section-2.5.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.5.1-4.1">
              <p id="section-2.5.1-4.1.1">The Pairwise Sender Key is the AEAD key for processing outgoing messages addressed to endpoint X.<a href="#section-2.5.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.5.1-4.2">
              <p id="section-2.5.1-4.2.1">The Pairwise Recipient Key is the AEAD key for processing incoming messages from endpoint X.<a href="#section-2.5.1-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.5.1-4.3">
              <p id="section-2.5.1-4.3.1">HKDF is the OSCORE HKDF algorithm <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> from the Common Context.<a href="#section-2.5.1-4.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.5.1-4.4">
              <p id="section-2.5.1-4.4.1">The Sender Key from the Sender Context is used as salt in the HKDF, when deriving the Pairwise Sender Key.<a href="#section-2.5.1-4.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.5.1-4.5">
              <p id="section-2.5.1-4.5.1">The Recipient Key from the Recipient Context associated with endpoint X is used as salt in the HKDF, when deriving the Pairwise Recipient Key.<a href="#section-2.5.1-4.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.5.1-4.6">
              <p id="section-2.5.1-4.6.1">Sender Auth Cred is the endpoint's own authentication credential from the Sender Context.<a href="#section-2.5.1-4.6.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.5.1-4.7">
              <p id="section-2.5.1-4.7.1">Recipient Auth Cred is the endpoint X's authentication credential from the Recipient Context associated with the endpoint X.<a href="#section-2.5.1-4.7.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.5.1-4.8">
              <p id="section-2.5.1-4.8.1">The Shared Secret is computed as a cofactor Diffie-Hellman shared secret, see Section 5.7.1.2 of <span>[<a href="#NIST-800-56A" class="cite xref">NIST-800-56A</a>]</span>, using the Pairwise Key Agreement Algorithm. The endpoint uses its private key from the Sender Context and the other endpoint's public key included in Recipient Auth Cred. Note the requirement of validation of public keys in <a href="#ssec-crypto-considerations" class="auto internal xref">Section 13.16</a>.<a href="#section-2.5.1-4.8.1" class="pilcrow">¶</a></p>
<p id="section-2.5.1-4.8.2">
In case the other endpoint's public key has COSE Key Type "EC2" (e.g., for the curves P-256, P-384, and P-512), then the public key is used as is. In case the other endpoint's public key has COSE Key Type "OKP", the procedure is described in <span><a href="https://rfc-editor.org/rfc/rfc7748#section-5" class="relref">Section 5</a> of [<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>. In particular, if the public key is for X25519 or X448, it is used as is. Otherwise, if the public key is for the curve Ed25519 or Ed448, it is first mapped to Montgomery coordinates (see <a href="#montgomery" class="auto internal xref">Section 2.5.2</a>).<a href="#section-2.5.1-4.8.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.5.1-4.9">
              <p id="section-2.5.1-4.9.1">IKM-Sender is the Input Keying Material (IKM) used in the HKDF for the derivation of the Pairwise Sender Key. IKM-Sender is the byte string concatenation of Sender Auth Cred, Recipient Auth Cred, and the Shared Secret. The authentication credentials Sender Auth Cred and Recipient Auth Cred are binary encoded as defined in <a href="#sec-pub-key-format" class="auto internal xref">Section 2.4</a>.<a href="#section-2.5.1-4.9.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.5.1-4.10">
              <p id="section-2.5.1-4.10.1">IKM-Recipient is the Input Keying Material (IKM) used in the HKDF for the derivation of the Pairwise Recipient Key. IKM-Recipient is the byte string concatenation of Recipient Auth Cred, Sender Auth Cred, and the Shared Secret. The authentication credentials Recipient Auth Cred and Sender Auth Cred are binary encoded as defined in <a href="#sec-pub-key-format" class="auto internal xref">Section 2.4</a>.<a href="#section-2.5.1-4.10.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.5.1-4.11">
              <p id="section-2.5.1-4.11.1">info and L are as defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. That is:<a href="#section-2.5.1-4.11.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.5.1-4.11.2.1">
                  <p id="section-2.5.1-4.11.2.1.1">The 'alg_aead' element of the 'info' array takes the value of AEAD Algorithm from the Common Context (see <a href="#ssec-common-context-aead-alg" class="auto internal xref">Section 2.1.1</a>).<a href="#section-2.5.1-4.11.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.5.1-4.11.2.2">
                  <p id="section-2.5.1-4.11.2.2.1">L  and the 'L' element of the 'info' array are the size of the key for the AEAD Algorithm from the Common Context (see <a href="#ssec-common-context-aead-alg" class="auto internal xref">Section 2.1.1</a>), in bytes.<a href="#section-2.5.1-4.11.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
<p id="section-2.5.1-5">If EdDSA asymmetric keys are used, the Edward coordinates are mapped to Montgomery coordinates using the maps defined in Sections <a href="https://rfc-editor.org/rfc/rfc7748#section-4.1" class="relref">4.1</a> and <a href="https://rfc-editor.org/rfc/rfc7748#section-4.2" class="relref">4.2</a> of <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>, before using the X25519 or X448 function defined in <span><a href="https://rfc-editor.org/rfc/rfc7748#section-5" class="relref">Section 5</a> of [<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>. For further details, see <a href="#montgomery" class="auto internal xref">Section 2.5.2</a>. ECC asymmetric keys in Montgomery or Weierstrass form are used directly in the key agreement algorithm, without coordinate mapping.<a href="#section-2.5.1-5" class="pilcrow">¶</a></p>
<p id="section-2.5.1-6">After establishing a partially or completely new Security Context (see <a href="#ssec-sec-context-persistence" class="auto internal xref">Section 2.6</a> and <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>), the old pairwise keys <span class="bcp14">MUST</span> be deleted. Since new Sender/Recipient Keys are derived from the new group keying material (see <a href="#ssec-sender-recipient-context" class="auto internal xref">Section 2.2</a>), every group member <span class="bcp14">MUST</span> use the new Sender/Recipient Keys when deriving new pairwise keys.<a href="#section-2.5.1-6" class="pilcrow">¶</a></p>
<p id="section-2.5.1-7">As long as any two group members preserve the same asymmetric keys, their Diffie-Hellman shared secret does not change across updates of the group keying material.<a href="#section-2.5.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="montgomery">
<section id="section-2.5.2">
          <h4 id="name-ecdh-with-montgomery-coordi">
<a href="#section-2.5.2" class="section-number selfRef">2.5.2. </a><a href="#name-ecdh-with-montgomery-coordi" class="section-name selfRef">ECDH with Montgomery Coordinates</a>
          </h4>
<div id="curve25519">
<section id="section-2.5.2.1">
            <h5 id="name-curve25519">
<a href="#section-2.5.2.1" class="section-number selfRef">2.5.2.1. </a><a href="#name-curve25519" class="section-name selfRef">Curve25519</a>
            </h5>
<p id="section-2.5.2.1-1">The y-coordinate of the other endpoint's Ed25519 public key is decoded as specified in <span><a href="https://rfc-editor.org/rfc/rfc8032#section-5.1.3" class="relref">Section 5.1.3</a> of [<a href="#RFC8032" class="cite xref">RFC8032</a>]</span>. The Curve25519 u-coordinate is recovered as u = (1 + y) / (1 - y) (mod p) following the map in <span><a href="https://rfc-editor.org/rfc/rfc7748#section-4.1" class="relref">Section 4.1</a> of [<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>. Note that the mapping is not defined for y = 1, and that y = -1 maps to u = 0 which corresponds to the neutral group element and thus will result in a degenerate shared secret. Therefore, implementations <span class="bcp14">MUST</span> abort if the y-coordinate of the other endpoint's Ed25519 public key is 1 or -1 (mod p).<a href="#section-2.5.2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.5.2.1-2">The private signing key byte strings (i.e., the lower 32 bytes used for generating the public key, see step 1 of <span><a href="https://rfc-editor.org/rfc/rfc8032#section-5.1.5" class="relref">Section 5.1.5</a> of [<a href="#RFC8032" class="cite xref">RFC8032</a>]</span>) are decoded the same way for signing in Ed25519 and scalar multiplication in X25519. Hence, in order to compute the shared secret, the endpoint applies the X25519 function to the Ed25519 private signing key byte string and the encoded u-coordinate byte string as specified in <span><a href="https://rfc-editor.org/rfc/rfc7748#section-5" class="relref">Section 5</a> of [<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>.<a href="#section-2.5.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="curve448">
<section id="section-2.5.2.2">
            <h5 id="name-curve448">
<a href="#section-2.5.2.2" class="section-number selfRef">2.5.2.2. </a><a href="#name-curve448" class="section-name selfRef">Curve448</a>
            </h5>
<p id="section-2.5.2.2-1">The y-coordinate of the other endpoint's Ed448 public key is decoded as specified in <span><a href="https://rfc-editor.org/rfc/rfc8032#section-5.2.3." class="relref">Section 5.2.3.</a> of [<a href="#RFC8032" class="cite xref">RFC8032</a>]</span>. The Curve448 u-coordinate is recovered as u = y^2 * (d * y^2 - 1) / (y^2 - 1) (mod p) following the map from "edwards448" in <span><a href="https://rfc-editor.org/rfc/rfc7748#section-4.2" class="relref">Section 4.2</a> of [<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>, and also using the relation x^2 = (y^2 - 1)/(d * y^2 - 1) from the curve equation. Note that the mapping is not defined for y = 1 or -1. Therefore, implementations <span class="bcp14">MUST</span> abort if the y-coordinate of the peer endpoint's Ed448 public key is 1 or -1 (mod p).<a href="#section-2.5.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.5.2.2-2">The private signing key byte strings (i.e., the lower 57 bytes used for generating the public key, see step 1 of <span><a href="https://rfc-editor.org/rfc/rfc8032#section-5.2.5" class="relref">Section 5.2.5</a> of [<a href="#RFC8032" class="cite xref">RFC8032</a>]</span>) are decoded the same way for signing in Ed448 and scalar multiplication in X448. Hence, in order to compute the shared secret, the endpoint applies the X448 function to the Ed448 private signing key byte string and the encoded u-coordinate byte string as specified in <span><a href="https://rfc-editor.org/rfc/rfc7748#section-5" class="relref">Section 5</a> of [<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>.<a href="#section-2.5.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="pairwise-seqno">
<section id="section-2.5.3">
          <h4 id="name-usage-of-sequence-numbers">
<a href="#section-2.5.3" class="section-number selfRef">2.5.3. </a><a href="#name-usage-of-sequence-numbers" class="section-name selfRef">Usage of Sequence Numbers</a>
          </h4>
<p id="section-2.5.3-1">When using any of its Pairwise Sender Keys, a sender endpoint including the 'Partial IV' parameter in the protected message <span class="bcp14">MUST</span> use the current fresh value of the Sender Sequence Number from its Sender Context (see <a href="#ssec-sender-recipient-context" class="auto internal xref">Section 2.2</a>). That is, the same Sender Sequence Number space is used for all outgoing messages protected with Group OSCORE, thus limiting both storage and complexity.<a href="#section-2.5.3-1" class="pilcrow">¶</a></p>
<p id="section-2.5.3-2">On the other hand, when combining communications with the group mode and the pairwise mode, this may result in the Partial IV values moving forward more often. This can happen when a client engages in frequent or long sequences of one-to-one exchanges with servers in the group, by sending requests over unicast. In turn, this contributes to a sooner exhaustion of the Sender Sequence Number space of the client, which would then require to take actions for deriving a new Sender Context before resuming communications in the group (see <a href="#ssec-wrap-around-partial-iv" class="auto internal xref">Section 2.6.2</a>).<a href="#section-2.5.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pairwise-implementation">
<section id="section-2.5.4">
          <h4 id="name-security-context-for-pairwi">
<a href="#section-2.5.4" class="section-number selfRef">2.5.4. </a><a href="#name-security-context-for-pairwi" class="section-name selfRef">Security Context for Pairwise Mode</a>
          </h4>
<p id="section-2.5.4-1">If the pairwise mode is supported, the Security Context additionally includes the Pairwise Key Agreement Algorithm and the pairwise keys, as described at the beginning of <a href="#sec-context" class="auto internal xref">Section 2</a>.<a href="#section-2.5.4-1" class="pilcrow">¶</a></p>
<p id="section-2.5.4-2">The pairwise keys as well as the shared secrets used in their derivation (see <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a>) may be stored in memory or recomputed every time they are needed. The shared secret changes only when a public/private key pair used for its derivation changes, which results in the pairwise keys also changing. Additionally, the pairwise keys change if the Sender ID changes or if a new Security Context is established for the group (see <a href="#sec-group-re-join" class="auto internal xref">Section 2.6.3</a>). In order to optimize protocol performance, an endpoint may store the derived pairwise keys for easy retrieval.<a href="#section-2.5.4-2" class="pilcrow">¶</a></p>
<p id="section-2.5.4-3">In the pairwise mode, the Sender Context includes the Pairwise Sender Keys to use with the other endpoints (see <a href="#fig-additional-context-information" class="auto internal xref">Figure 1</a>). In order to identify the right key to use, the Pairwise Sender Key for endpoint X may be associated with the Recipient ID of endpoint X, as defined in the Recipient Context (i.e., the Sender ID from the point of view of endpoint X). In this way, the Recipient ID can be used to lookup for the right Pairwise Sender Key. This association may be implemented in different ways, e.g., by storing the pair (Recipient ID, Pairwise Sender Key) or linking a Pairwise Sender Key to a Recipient Context.<a href="#section-2.5.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssec-sec-context-persistence">
<section id="section-2.6">
        <h3 id="name-update-of-security-context">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-update-of-security-context" class="section-name selfRef">Update of Security Context</a>
        </h3>
<p id="section-2.6-1">It is <span class="bcp14">RECOMMENDED</span> that the immutable part of the Security Context is stored in non-volatile memory, or that it can otherwise be reliably accessed throughout the operation of the group, e.g., after device reboots. However, also immutable parts of the Security Context may need to be updated, for example due to scheduled key renewal, new or re-joining members in the group, or the fact that the endpoint changes Sender ID (see <a href="#sec-group-re-join" class="auto internal xref">Section 2.6.3</a>).<a href="#section-2.6-1" class="pilcrow">¶</a></p>
<p id="section-2.6-2">The mutable parts of the Security Context are updated by the endpoint when executing the security protocol, but may be lost (see <a href="#ssec-loss-mutable-context" class="auto internal xref">Section 2.6.1</a>) or become outdated by exhaustion of Sender Sequence Numbers (see <a href="#ssec-wrap-around-partial-iv" class="auto internal xref">Section 2.6.2</a>).<a href="#section-2.6-2" class="pilcrow">¶</a></p>
<div id="ssec-loss-mutable-context">
<section id="section-2.6.1">
          <h4 id="name-loss-of-mutable-security-co">
<a href="#section-2.6.1" class="section-number selfRef">2.6.1. </a><a href="#name-loss-of-mutable-security-co" class="section-name selfRef">Loss of Mutable Security Context</a>
          </h4>
<p id="section-2.6.1-1">An endpoint may lose its mutable Security Context, e.g., due to a reboot occurred in an unprepared way (see <a href="#ssec-loss-mutable-context-total" class="auto internal xref">Section 2.6.1.1</a>) or due to a deleted Recipient Context (see <a href="#ssec-loss-mutable-context-overflow" class="auto internal xref">Section 2.6.1.2</a>).<a href="#section-2.6.1-1" class="pilcrow">¶</a></p>
<p id="section-2.6.1-2">If it is not feasible or practically possible to store and maintain up-to-date the mutable part in non-volatile memory (e.g., due to limited number of write operations), the endpoint <span class="bcp14">MUST</span> be able to detect a loss of the mutable Security Context, to prevent the re-use of a nonce with the same AEAD key, and to handle incoming replayed messages.<a href="#section-2.6.1-2" class="pilcrow">¶</a></p>
<div id="ssec-loss-mutable-context-total">
<section id="section-2.6.1.1">
            <h5 id="name-total-loss">
<a href="#section-2.6.1.1" class="section-number selfRef">2.6.1.1. </a><a href="#name-total-loss" class="section-name selfRef">Total Loss</a>
            </h5>
<p id="section-2.6.1.1-1">In case a loss of the Sender Context and/or of the Recipient Contexts is detected (e.g., following a reboot occurred in an unprepared way), the endpoint <span class="bcp14">MUST NOT</span> protect further messages using this Security Context, to avoid reusing an AEAD nonce with the same AEAD key.<a href="#section-2.6.1.1-1" class="pilcrow">¶</a></p>
<p id="section-2.6.1.1-2">Before resuming its operations in the group, the endpoint <span class="bcp14">MUST</span> retrieve new Security Context parameters from the Group Manager (see <a href="#sec-group-re-join" class="auto internal xref">Section 2.6.3</a>) and use them to derive a new Sender Context and Recipient Contexts (see <a href="#ssec-sender-recipient-context" class="auto internal xref">Section 2.2</a>). Since the new Sender Context includes newly derived encryption keys, an endpoint will not reuse the same pair (key, nonce), even when it is a server using the Partial IV of (old re-injected) requests to build the AEAD nonce for protecting the responses.<a href="#section-2.6.1.1-2" class="pilcrow">¶</a></p>
<p id="section-2.6.1.1-3">From then on, the endpoint <span class="bcp14">MUST</span> use the latest installed Sender Context to protect outgoing messages. Newly derived Recipient Contexts will have a Replay Window which is initialized as valid.<a href="#section-2.6.1.1-3" class="pilcrow">¶</a></p>
<p id="section-2.6.1.1-4">If an endpoint is not configured as silent server and is not able to establish an updated Sender Context, e.g., because of lack of connectivity with the Group Manager, then the endpoint <span class="bcp14">MUST NOT</span> protect further messages using the current Security Context and <span class="bcp14">MUST NOT</span> accept incoming messages from other group members, as currently unable to detect possible replays.<a href="#section-2.6.1.1-4" class="pilcrow">¶</a></p>
<p id="section-2.6.1.1-5">If an endpoint is configured as silent server and is not able to establish an updated Security Context, e.g., because of lack of connectivity with the Group Manager, then the endpoint <span class="bcp14">MUST NOT</span> accept incoming messages from other group members, as currently unable to detect possible replays.<a href="#section-2.6.1.1-5" class="pilcrow">¶</a></p>
<p id="section-2.6.1.1-6">An adversary may leverage the above to perform a Denial of Service attack and prevent some group members from communicating altogether. That is, the adversary can first block the communication path between the Group Manager and some individual group members. This can be achieved, for instance, by injecting fake responses to DNS queries for the Group Manager hostname, or by removing a network link used for routing traffic towards the Group Manager. Then, the adversary can induce an unprepared reboot for some endpoints in the group, e.g., by triggering a short power outage. After that, such endpoints that have lost their Sender Context and/or Recipient Contexts following the reboot would not be able to obtain new Security Context parameters from the Group Manager, as specified above. Thus, they would not be able to further communicate in the group until connectivity with the Group Manager is restored.<a href="#section-2.6.1.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-loss-mutable-context-overflow">
<section id="section-2.6.1.2">
            <h5 id="name-deleted-recipient-contexts">
<a href="#section-2.6.1.2" class="section-number selfRef">2.6.1.2. </a><a href="#name-deleted-recipient-contexts" class="section-name selfRef">Deleted Recipient Contexts</a>
            </h5>
<p id="section-2.6.1.2-1">The Security Context may contain a large and variable number of Recipient Contexts. A Recipient Context may need to be deleted, because the maximum number of Recipient Contexts has been reached (see <a href="#ssec-sender-recipient-context" class="auto internal xref">Section 2.2</a>), or due to some other reason.<a href="#section-2.6.1.2-1" class="pilcrow">¶</a></p>
<p id="section-2.6.1.2-2">When a Recipient Context is deleted, this does not only result in losing information about previously received messages from the corresponding other endpoint. It also results in the inability to be aware of the Security Contexts from which information has been lost.<a href="#section-2.6.1.2-2" class="pilcrow">¶</a></p>
<p id="section-2.6.1.2-3">Therefore, if the Recipient Context is derived again from the same Security Context, there is a risk that a replayed message is not detected. If one Recipient Context has been deleted from the current Security Context, then the Replay Window of any new Recipient Context in this Security Context <span class="bcp14">MUST</span> be initialized as invalid. Messages associated with a Recipient Context that has an invalid Replay Window <span class="bcp14">MUST NOT</span> be delivered to the application.<a href="#section-2.6.1.2-3" class="pilcrow">¶</a></p>
<p id="section-2.6.1.2-4">If the endpoint receives a request to process with the new Recipient Context and the endpoint supports the CoAP Echo Option <span>[<a href="#RFC9175" class="cite xref">RFC9175</a>]</span>, then it is <span class="bcp14">RECOMMENDED</span> to follow the procedure specified in <a href="#sec-synch-challenge-response" class="auto internal xref">Section 10</a> which establishes a valid Replay Window. In particular, the endpoint <span class="bcp14">MUST</span> use its Partial IV when generating the AEAD nonce and <span class="bcp14">MUST</span> include the Partial IV in the response message conveying the Echo Option.<a href="#section-2.6.1.2-4" class="pilcrow">¶</a></p>
<p id="section-2.6.1.2-5">Alternatively, the endpoint <span class="bcp14">MAY</span> retrieve or wait for new Security Context parameters from the Group Manager and derive new Sender and Recipient Contexts, as defined in <a href="#ssec-loss-mutable-context-total" class="auto internal xref">Section 2.6.1.1</a>. In this case the Replay Windows of all Recipient Contexts become valid if they are not already.<a href="#section-2.6.1.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssec-wrap-around-partial-iv">
<section id="section-2.6.2">
          <h4 id="name-exhaustion-of-sender-sequen">
<a href="#section-2.6.2" class="section-number selfRef">2.6.2. </a><a href="#name-exhaustion-of-sender-sequen" class="section-name selfRef">Exhaustion of Sender Sequence Number Space</a>
          </h4>
<p id="section-2.6.2-1">Since an endpoint increments its Sender Sequence Number for each new outgoing message including a Partial IV, an endpoint can eventually exhaust the Sender Sequence Number space.<a href="#section-2.6.2-1" class="pilcrow">¶</a></p>
<p id="section-2.6.2-2">Implementations <span class="bcp14">MUST</span> be able to detect an exhaustion of Sender Sequence Number space, after the endpoint has consumed the largest usable value. This may be influenced by additional limitations besides the mere 40-bit size limit of the Partial IV. If an implementation's integers support wrapping addition, the implementation <span class="bcp14">MUST</span> treat the Sender Sequence Number as exhausted when a wrap-around is detected.<a href="#section-2.6.2-2" class="pilcrow">¶</a></p>
<p id="section-2.6.2-3">Upon exhausting the Sender Sequence Number space, the endpoint <span class="bcp14">MUST NOT</span> use this Security Context to protect further messages including a Partial IV.<a href="#section-2.6.2-3" class="pilcrow">¶</a></p>
<p id="section-2.6.2-4">The endpoint <span class="bcp14">SHOULD</span> inform the Group Manager, retrieve new Security Context parameters from the Group Manager (see <a href="#sec-group-re-join" class="auto internal xref">Section 2.6.3</a>), and use them to derive a new Sender Context (see <a href="#ssec-sender-recipient-context" class="auto internal xref">Section 2.2</a>).<a href="#section-2.6.2-4" class="pilcrow">¶</a></p>
<p id="section-2.6.2-5">From then on, the endpoint <span class="bcp14">MUST</span> use its latest installed Sender Context to protect outgoing messages.<a href="#section-2.6.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-group-re-join">
<section id="section-2.6.3">
          <h4 id="name-retrieving-new-security-con">
<a href="#section-2.6.3" class="section-number selfRef">2.6.3. </a><a href="#name-retrieving-new-security-con" class="section-name selfRef">Retrieving New Security Context Parameters</a>
          </h4>
<p id="section-2.6.3-1">The Group Manager can assist an endpoint with an incomplete Sender Context to retrieve missing data of the Security Context and thereby become fully operational in the group again. The two main options for the Group Manager are described in this section: i) assignment of a new Sender ID to the endpoint (see <a href="#new-sender-id" class="auto internal xref">Section 2.6.3.1</a>); and ii) establishment of a new Security Context for the group (see <a href="#new-sec-context" class="auto internal xref">Section 2.6.3.2</a>). The update of the Replay Window in each of the Recipient Contexts is discussed in <a href="#ssec-loss-mutable-context" class="auto internal xref">Section 2.6.1</a>.<a href="#section-2.6.3-1" class="pilcrow">¶</a></p>
<p id="section-2.6.3-2">As group membership changes, or as group members get new Sender IDs (see <a href="#new-sender-id" class="auto internal xref">Section 2.6.3.1</a>), so do the relevant Recipient IDs that the other endpoints need to keep track of. As a consequence, group members may end up retaining stale Recipient Contexts, that are no longer useful to verify incoming secure messages.<a href="#section-2.6.3-2" class="pilcrow">¶</a></p>
<p id="section-2.6.3-3">The Recipient ID ('kid') <span class="bcp14">SHOULD NOT</span> be considered as a persistent and reliable identifier of a group member. Such an indication can be achieved only by using that member's public key, when verifying countersignatures of received messages (in group mode), or when verifying messages integrity-protected with pairwise keying material derived from authentication credentials and associated asymmetric keys (in pairwise mode).<a href="#section-2.6.3-3" class="pilcrow">¶</a></p>
<p id="section-2.6.3-4">Furthermore, applications <span class="bcp14">MAY</span> define policies to: i) delete (long-)unused Recipient Contexts and reduce the impact on storage space; as well as ii) check with the Group Manager that an authentication credential with the public key included therein is currently the one associated with a 'kid' value, after a number of consecutive failed verifications.<a href="#section-2.6.3-4" class="pilcrow">¶</a></p>
<div id="new-sender-id">
<section id="section-2.6.3.1">
            <h5 id="name-new-sender-id-for-the-endpo">
<a href="#section-2.6.3.1" class="section-number selfRef">2.6.3.1. </a><a href="#name-new-sender-id-for-the-endpo" class="section-name selfRef">New Sender ID for the Endpoint</a>
            </h5>
<p id="section-2.6.3.1-1">The Group Manager may assign a new Sender ID to an endpoint, while leaving the Gid, Master Secret and Master Salt unchanged in the group. In this case, the Group Manager <span class="bcp14">MUST</span> assign a Sender ID that has not been used in the group since the latest time when the current Gid value was assigned to the group (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#section-2.6.3.1-1" class="pilcrow">¶</a></p>
<p id="section-2.6.3.1-2">Having retrieved the new Sender ID, and potentially other missing data of the immutable Security Context, the endpoint can derive a new Sender Context (see <a href="#ssec-sender-recipient-context" class="auto internal xref">Section 2.2</a>). When doing so, the endpoint resets the Sender Sequence Number in its Sender Context to 0, and derives a new Sender Key. This is in turn used to possibly derive new Pairwise Sender Keys.<a href="#section-2.6.3.1-2" class="pilcrow">¶</a></p>
<p id="section-2.6.3.1-3">From then on, the endpoint <span class="bcp14">MUST</span> use its latest installed Sender Context to protect outgoing messages.<a href="#section-2.6.3.1-3" class="pilcrow">¶</a></p>
<p id="section-2.6.3.1-4">The assignment of a new Sender ID may be the result of different processes. The endpoint may request a new Sender ID, e.g., because of the exhaustion of the Sender Sequence Number space (see <a href="#ssec-wrap-around-partial-iv" class="auto internal xref">Section 2.6.2</a>). An endpoint may request to re-join the group, e.g., because of losing its mutable Security Context (see <a href="#ssec-loss-mutable-context" class="auto internal xref">Section 2.6.1</a>), and is provided with a new Sender ID together with the latest immutable Security Context.<a href="#section-2.6.3.1-4" class="pilcrow">¶</a></p>
<p id="section-2.6.3.1-5">For the other group members, the Recipient Context corresponding to the old Sender ID becomes stale (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#section-2.6.3.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="new-sec-context">
<section id="section-2.6.3.2">
            <h5 id="name-new-security-context-for-th">
<a href="#section-2.6.3.2" class="section-number selfRef">2.6.3.2. </a><a href="#name-new-security-context-for-th" class="section-name selfRef">New Security Context for the Group</a>
            </h5>
<p id="section-2.6.3.2-1">The Group Manager may establish a new Security Context for the group (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>). The Group Manager does not necessarily establish a new Security Context for the group if one member has an outdated Security Context (see <a href="#new-sender-id" class="auto internal xref">Section 2.6.3.1</a>), unless that was already planned or required for other reasons.<a href="#section-2.6.3.2-1" class="pilcrow">¶</a></p>
<p id="section-2.6.3.2-2">All the group members need to acquire new Security Context parameters from the Group Manager. Once having acquired new Security Context parameters, each group member performs the following actions.<a href="#section-2.6.3.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.6.3.2-3.1">
                <p id="section-2.6.3.2-3.1.1">From then on, it <span class="bcp14">MUST NOT</span> use the current Security Context to start processing new messages for the considered group.<a href="#section-2.6.3.2-3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.6.3.2-3.2">
                <p id="section-2.6.3.2-3.2.1">It completes any ongoing message processing for the considered group.<a href="#section-2.6.3.2-3.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.6.3.2-3.3">
                <p id="section-2.6.3.2-3.3.1">It derives and installs a new Security Context. In particular:<a href="#section-2.6.3.2-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.6.3.2-3.3.2.1">
                    <p id="section-2.6.3.2-3.3.2.1.1">It re-derives the keying material stored in its Sender Context and Recipient Contexts (see <a href="#ssec-sender-recipient-context" class="auto internal xref">Section 2.2</a>). The Master Salt used for the re-derivations is the updated Master Salt parameter if provided by the Group Manager, or the empty byte string otherwise.<a href="#section-2.6.3.2-3.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-2.6.3.2-3.3.2.2">
                    <p id="section-2.6.3.2-3.3.2.2.1">It resets its Sender Sequence Number in its Sender Context to 0.<a href="#section-2.6.3.2-3.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-2.6.3.2-3.3.2.3">
                    <p id="section-2.6.3.2-3.3.2.3.1">It re-initializes the Replay Window of each Recipient Context as valid and with 0 as its current lower limit.<a href="#section-2.6.3.2-3.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-2.6.3.2-3.3.2.4">
                    <p id="section-2.6.3.2-3.3.2.4.1">For each long exchange where it is a client and that it wants to keep active, it sets the Response Number of each associated server as not initialized (see <a href="#sec-long-exchanges" class="auto internal xref">Section 6.1</a>).<a href="#section-2.6.3.2-3.3.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
<p id="section-2.6.3.2-4">From then on, it can resume processing new messages for the considered group. In particular:<a href="#section-2.6.3.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.6.3.2-5.1">
                <p id="section-2.6.3.2-5.1.1">It <span class="bcp14">MUST</span> use its latest installed Sender Context to protect outgoing messages.<a href="#section-2.6.3.2-5.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.6.3.2-5.2">
                <p id="section-2.6.3.2-5.2.1">It <span class="bcp14">SHOULD</span> use only its latest installed Recipient Contexts to process incoming messages, unless application policies admit to temporarily retain and use the old, recent, Security Context (see <a href="#ssec-key-rotation-late-sender" class="auto internal xref">Section 13.5.1</a>).<a href="#section-2.6.3.2-5.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.6.3.2-6">The distribution of a new Gid and Master Secret may result in temporarily misaligned Security Contexts among group members. In particular, this may result in a group member not being able to process messages received right after a new Gid and Master Secret have been distributed. A discussion on practical consequences and possible ways to address them, as well as on how to handle the old Security Context, is provided in <a href="#ssec-key-rotation" class="auto internal xref">Section 13.5</a>.<a href="#section-2.6.3.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="group-manager">
<section id="section-3">
      <h2 id="name-the-group-manager">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-the-group-manager" class="section-name selfRef">The Group Manager</a>
      </h2>
<p id="section-3-1">As with OSCORE, endpoints communicating with Group OSCORE need to establish the relevant Security Context. Group OSCORE endpoints need to acquire OSCORE input parameters, information about the group(s) and about other endpoints in the group(s). This document is based on the existence of an entity called Group Manager that is responsible for the group, but it does not mandate how the Group Manager interacts with the group members. The list of responsibilities of the Group Manager is compiled in <a href="#sec-group-manager" class="auto internal xref">Section 3.4</a>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">The Group Manager assigns unique Group Identifiers (Gids) to the groups under its control. Within each of such groups, the Group Manager assigns unique Sender IDs (and thus Recipient IDs) to the respective group members. The maximum length of Sender IDs depends on the length of the AEAD nonce for the algorithms used in the group (see <a href="#ssec-sender-recipient-context" class="auto internal xref">Section 2.2</a>).<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">According to a hierarchical approach, the Gid value assigned to a group is associated with a dedicated space for the values of Sender ID and Recipient ID of the members of that group. When an endpoint (re-)joins a group, it is provided with the current Gid to use in the group. The Group Manager also assigns an integer Key Generation Number counter to each of its groups, identifying the current version of the keying material used in that group. Further details about identifiers and keys are provided in <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">The Group Manager maintains records of the authentication credentials of endpoints in a group, and provides information about the group and its members to other group members (see <a href="#setup" class="auto internal xref">Section 3.1</a>), and to external entities with a specific role (see <a href="#sec-additional-entities" class="auto internal xref">Section 3.3</a>).<a href="#section-3-4" class="pilcrow">¶</a></p>
<div id="setup">
<section id="section-3.1">
        <h3 id="name-set-up-of-new-endpoints">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-set-up-of-new-endpoints" class="section-name selfRef">Set-up of New Endpoints</a>
        </h3>
<p id="section-3.1-1">From the Group Manager, an endpoint acquires group data such as the Gid and OSCORE input parameters including its own Sender ID, with which it can derive the Sender Context.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">When joining the group or later on as a group member, an endpoint can also retrieve from the Group Manager the authentication credential of the Group Manager as well as the authentication credential and other information associated with other members of the group, with which it can derive the corresponding Recipient Context. An application can configure a group member to asynchronously retrieve information about Recipient Contexts, e.g., by Observing <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span> a resource at the Group Manager to get updates on the group membership.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">Upon endpoints' joining, the Group Manager collects their authentication credentials and <span class="bcp14">MUST</span> verify proof-of-possession of the respective private key. Together with the requested authentication credentials of other group members, the Group Manager <span class="bcp14">MUST</span> provide the joining endpoints with the Sender ID of the associated group members and the current Key Generation Number in the group (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">An endpoint may join a group, for example, by explicitly interacting with the responsible Group Manager, or by being configured with some tool performing the tasks of the Group Manager. When becoming members of a group, endpoints are not required to know how many and what endpoints are in the same group.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5">Communications that the Group Manager has with joining endpoints and group members <span class="bcp14">MUST</span> be secured. Specific details on how to secure such communications are out of the scope of this document.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">The Group Manager <span class="bcp14">MUST</span> verify that the joining endpoint is authorized to join the group. To this end, the Group Manager can directly authorize the joining endpoint, or expect it to provide authorization evidence previously obtained from a trusted entity. Further details about the authorization of joining endpoints are out of the scope of this document.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1-7">In case of successful authorization check, the Group Manager provides the joining endpoint with the keying material to initialize the Security Context. The actual provisioning of keying material and parameters to the joining endpoint is out of the scope of this document.<a href="#section-3.1-7" class="pilcrow">¶</a></p>
<p id="section-3.1-8">One realization of a Group Manager is specified in <span>[<a href="#I-D.ietf-ace-key-groupcomm-oscore" class="cite xref">I-D.ietf-ace-key-groupcomm-oscore</a>]</span>, where the join process is based on the ACE framework for authentication and authorization in constrained environments <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.<a href="#section-3.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-group-key-management">
<section id="section-3.2">
        <h3 id="name-management-of-group-keying-">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-management-of-group-keying-" class="section-name selfRef">Management of Group Keying Material</a>
        </h3>
<p id="section-3.2-1">In order to establish a new Security Context for a group, the Group Manager <span class="bcp14">MUST</span> generate and assign to the group a new Group Identifier (Gid) and a new value for the Master Secret parameter. When doing so, a new value for the Master Salt parameter <span class="bcp14">MAY</span> also be generated and assigned to the group. When establishing the new Security Context, the Group Manager should preserve the current value of the Sender ID of each group member.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">The specific group key management scheme used to distribute new keying material is out of the scope of this document. A simple group key management scheme is defined in <span>[<a href="#I-D.ietf-ace-key-groupcomm-oscore" class="cite xref">I-D.ietf-ace-key-groupcomm-oscore</a>]</span>. When possible, the delivery of rekeying messages should use a reliable transport, in order to reduce chances of group members missing a rekeying instance.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">The set of group members should not be assumed as fixed, i.e., the group membership is subject to changes, possibly on a frequent basis.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2-4">The Group Manager <span class="bcp14">MUST</span> rekey the group without undue delay in case one or more endpoints leave the group. An endpoint may leave the group at own initiative, or may be evicted from the group by the Group Manager, e.g., in case an endpoint is compromised, or is suspected to be compromised. In either case, rekeying the group excludes such endpoints from future communications in the group, and thus preserves forward security. If a network node is compromised or suspected to be compromised, the Group Manager <span class="bcp14">MUST</span> evict from the group all the endpoints hosted by that node that are member of the group and rekey the group accordingly.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5">If required by the application, the Group Manager <span class="bcp14">MUST</span> rekey the group also before one or more new joining endpoints are added to the group, thus preserving backward security.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">Separately for each group, the value of the Key Generation Number increases by one each time the Group Manager distributes new keying material to that group (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#section-3.2-6" class="pilcrow">¶</a></p>
<p id="section-3.2-7">The establishment of the new Security Context for the group takes the following steps.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.2-8">
<li id="section-3.2-8.1">
            <p id="section-3.2-8.1.1">The Group Manager <span class="bcp14">MUST</span> increment the Key Generation Number for the group by 1. It is up to the Group Manager what actions to take when a wrap-around of the Key Generation Number is detected.<a href="#section-3.2-8.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.2-8.2">
            <p id="section-3.2-8.2.1">The Group Manager <span class="bcp14">MUST</span> build a set of stale Sender IDs including:<a href="#section-3.2-8.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-8.2.2.1">
                <p id="section-3.2-8.2.2.1.1">The Sender IDs that, during the current Gid, were both assigned to an endpoint and subsequently relinquished (see <a href="#new-sender-id" class="auto internal xref">Section 2.6.3.1</a>).<a href="#section-3.2-8.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.2-8.2.2.2">
                <p id="section-3.2-8.2.2.2.1">The current Sender IDs of the group members that the upcoming group rekeying aims to exclude from future group communications, if any.<a href="#section-3.2-8.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-3.2-8.3">
            <p id="section-3.2-8.3.1">The Group Manager rekeys the group, by distributing:<a href="#section-3.2-8.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-8.3.2.1">
                <p id="section-3.2-8.3.2.1.1">The new keying material, i.e., the new Master Secret, the new Gid and (optionally) the new Master Salt.<a href="#section-3.2-8.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.2-8.3.2.2">
                <p id="section-3.2-8.3.2.2.1">The new Key Generation Number from step 1.<a href="#section-3.2-8.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.2-8.3.2.3">
                <p id="section-3.2-8.3.2.3.1">The set of stale Sender IDs from step 2.<a href="#section-3.2-8.3.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-3.2-8.3.3">
Further information may be distributed, depending on the specific group key management scheme used in the group.<a href="#section-3.2-8.3.3" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-3.2-9">When receiving the new group keying material, a group member considers the received stale Sender IDs and performs the following actions.<a href="#section-3.2-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-10.1">
            <p id="section-3.2-10.1.1">The group member <span class="bcp14">MUST</span> remove every authentication credential associated with a stale Sender ID from its list of group members' authentication credentials used in the group.<a href="#section-3.2-10.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-10.2">
            <p id="section-3.2-10.2.1">The group member <span class="bcp14">MUST</span> delete each of its Recipient Contexts used in the group whose corresponding Recipient ID is a stale Sender ID.<a href="#section-3.2-10.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.2-11">After that, the group member installs the new keying material and derives the corresponding new Security Context.<a href="#section-3.2-11" class="pilcrow">¶</a></p>
<p id="section-3.2-12">A group member might miss one or more consecutive instances of group rekeying. As a result, the group member will retain old group keying material with Key Generation Number GEN_OLD. Eventually, the group member can notice the discrepancy, e.g., by repeatedly failing to verify incoming messages, or by explicitly querying the Group Manager for the current Key Generation Number. Once the group member gains knowledge of having missed a group rekeying, it <span class="bcp14">MUST</span> delete the old keying material it stores.<a href="#section-3.2-12" class="pilcrow">¶</a></p>
<p id="section-3.2-13">Then, the group member proceeds according to the following steps.<a href="#section-3.2-13" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.2-14">
<li id="section-3.2-14.1">
            <p id="section-3.2-14.1.1">The group member retrieves from the Group Manager the current group keying material, together with the current Key Generation Number GEN_NEW. The group member <span class="bcp14">MUST NOT</span> install the obtained group keying material yet.<a href="#section-3.2-14.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.2-14.2">
            <p id="section-3.2-14.2.1">The group member asks the Group Manager for the set of stale Sender IDs.<a href="#section-3.2-14.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.2-14.3">
            <p id="section-3.2-14.3.1">If no exact indication can be obtained from the Group Manager, the group member <span class="bcp14">MUST</span> remove all the authentication credentials from its list of group members' authentication credentials used in the group and <span class="bcp14">MUST</span> delete all its Recipient Contexts used in the group.<a href="#section-3.2-14.3.1" class="pilcrow">¶</a></p>
<p id="section-3.2-14.3.2">
Otherwise, the group member <span class="bcp14">MUST</span> remove every authentication credential associated with a stale Sender ID from its list of group members' authentication credentials used in the group, and <span class="bcp14">MUST</span> delete each of its Recipient Contexts used in the group whose corresponding Recipient ID is a stale Sender ID.<a href="#section-3.2-14.3.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.2-14.4">
            <p id="section-3.2-14.4.1">The group member installs the current group keying material, and derives the corresponding new Security Context.<a href="#section-3.2-14.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-3.2-15">Alternatively, the group member can re-join the group. In such a case, the group member <span class="bcp14">MUST</span> take one of the following two actions.<a href="#section-3.2-15" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-16.1">
            <p id="section-3.2-16.1.1">First, the group member performs steps 2 and 3 above. Then, the group member re-joins the group.<a href="#section-3.2-16.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-16.2">
            <p id="section-3.2-16.2.1">The group member re-joins the group with the same roles it currently has in the group, and, during the re-joining process, it asks the Group Manager for the authentication credentials of all the current group members.<a href="#section-3.2-16.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2-16.2.2">
Then, given Z, the set of authentication credentials received from the Group Manager, the group member removes every authentication credential which is not in Z from its list of group members' authentication credentials used in the group, and deletes each of its Recipient Contexts used in the group that does not include any of the authentication credentials in Z.<a href="#section-3.2-16.2.2" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.2-17">By removing authentication credentials and deleting Recipient Contexts associated with stale Sender IDs, it is ensured that a recipient endpoint storing the latest group keying material does not store the authentication credentials of sender endpoints that are not current group members. This in turn allows group members to rely on stored authentication credentials to confidently assert the group membership of sender endpoints, when receiving incoming messages protected in group mode (see <a href="#mess-processing" class="auto internal xref">Section 8</a>).<a href="#section-3.2-17" class="pilcrow">¶</a></p>
<p id="section-3.2-18">Such a strictness in managing the authentication credentials and Recipient Contexts associated with other group members is required for two reasons. First, as further discussed in <a href="#ssec-group-mode-security" class="auto internal xref">Section 13.1</a>, it ensures that the group mode can be used securely, even in a group where the Group Encryption Algorithm does not provide integrity protection (see <a href="#ssec-common-context-cs-enc-alg" class="auto internal xref">Section 2.1.6</a>) and external signature checkers are used (see <a href="#sec-processing-signature-checker" class="auto internal xref">Section 8.5</a>). Second, it ensures that the wrong (old) authentication credential associated with a group member A is never used with a sender ID that used to be associated with A and has been later issued to a different group member B (see <a href="#sec-sid-recycling" class="auto internal xref">Section 3.2.1.2</a>), thus preventing the need to recover from an identity mix-up.<a href="#section-3.2-18" class="pilcrow">¶</a></p>
<div id="recycling-of-identifiers">
<section id="section-3.2.1">
          <h4 id="name-recycling-of-identifiers">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-recycling-of-identifiers" class="section-name selfRef">Recycling of Identifiers</a>
          </h4>
<p id="section-3.2.1-1">This section specifies how the Group Manager handles and possibly reassigns Gid values and Sender ID values in a group.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<div id="sec-gid-recycling">
<section id="section-3.2.1.1">
            <h5 id="name-recycling-of-group-identifi">
<a href="#section-3.2.1.1" class="section-number selfRef">3.2.1.1. </a><a href="#name-recycling-of-group-identifi" class="section-name selfRef">Recycling of Group Identifiers</a>
            </h5>
<p id="section-3.2.1.1-1">Since the Gid value changes every time a group is rekeyed, it can happen that, after several rekeying instances, the whole space of Gid values has been used for the group in question. When this happens, the Group Manager has no available Gid values to use that have never been assigned to the group during the group's lifetime.<a href="#section-3.2.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.1.1-2">The occurrence of such an event and how long it would take to occur depend on the format and encoding of Gid values used in the group (see, e.g., <a href="#gid-ex" class="auto internal xref">Appendix C</a>), as well as on the frequency of rekeying instances yielding a change of Gid value. Independently for each group under its control, the Group Manager can take one of the two following approaches.<a href="#section-3.2.1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2.1.1-3.1">
                <p id="section-3.2.1.1-3.1.1">The Group Manager does not reassign Gid values. That is, once the whole space of Gid values has been used for a group, the Group Manager terminates the group and may re-establish a new group.<a href="#section-3.2.1.1-3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.2.1.1-3.2">
                <p id="section-3.2.1.1-3.2.1">While the Gid value changes every time a group is rekeyed, the Group Manager can reassign Gid values previously used during a group's lifetime. By doing so, the group can continue to exist even once the whole space of Gid values has been used.<a href="#section-3.2.1.1-3.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2.1.1-3.2.2">
The Group Manager <span class="bcp14">MAY</span> support and use this approach. In such a case, the Group Manager <span class="bcp14">MUST</span> take additional actions when handling Gid values and rekeying the group, as specified below.<a href="#section-3.2.1.1-3.2.2" class="pilcrow">¶</a></p>
<p id="section-3.2.1.1-3.2.3">
When a node (re-)joins the group and it is provided with the current Gid to use in the group, the Group Manager considers such a Gid as the Birth Gid of that endpoint for that group. For each group member, the Group Manager <span class="bcp14">MUST</span> store the latest corresponding Birth Gid until that member leaves the group. In case the endpoint has in fact re-joined the group, the newly determined Birth Gid overwrites the one currently stored.<a href="#section-3.2.1.1-3.2.3" class="pilcrow">¶</a></p>
<p id="section-3.2.1.1-3.2.4">
When establishing a new Security Context for the group, the Group Manager takes the additional following step between steps 1 and 2 of <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>.<a href="#section-3.2.1.1-3.2.4" class="pilcrow">¶</a></p>
<p id="section-3.2.1.1-3.2.5">
A. The Group Manager <span class="bcp14">MUST</span> check if the new Gid to be distributed is equal to the Birth Gid of any of the current group members. If any of such "elder members" is found in the group, then:<a href="#section-3.2.1.1-3.2.5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2.1.1-3.2.6.1">
                    <p id="section-3.2.1.1-3.2.6.1.1">The Group Manager <span class="bcp14">MUST</span> evict the elder members from the group. That is, the Group Manager <span class="bcp14">MUST</span> terminate their membership and, in the following steps, it <span class="bcp14">MUST</span> rekey the group in such a way that the new keying material is not provided to those evicted elder members.<a href="#section-3.2.1.1-3.2.6.1.1" class="pilcrow">¶</a></p>
<p id="section-3.2.1.1-3.2.6.1.2">
This ensures that any response from the same server to the request of a long exchange can never successfully match against the request of two different long exchanges.<a href="#section-3.2.1.1-3.2.6.1.2" class="pilcrow">¶</a></p>
<p id="section-3.2.1.1-3.2.6.1.3">
In fact, the excluded elder members could eventually re-join the group, thus terminating any of their ongoing long exchanges (see <a href="#sec-long-exchanges" class="auto internal xref">Section 6.1</a>).<a href="#section-3.2.1.1-3.2.6.1.3" class="pilcrow">¶</a></p>
<p id="section-3.2.1.1-3.2.6.1.4">
Therefore, it is ensured by construction that no client can have with the same server two ongoing long exchanges, such that the two respective requests were protected using the same Partial IV, Gid, and Sender ID.<a href="#section-3.2.1.1-3.2.6.1.4" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</section>
</div>
<div id="sec-sid-recycling">
<section id="section-3.2.1.2">
            <h5 id="name-recycling-of-sender-ids">
<a href="#section-3.2.1.2" class="section-number selfRef">3.2.1.2. </a><a href="#name-recycling-of-sender-ids" class="section-name selfRef">Recycling of Sender IDs</a>
            </h5>
<p id="section-3.2.1.2-1">From the moment when a Gid is assigned to a group until the moment a new Gid is assigned to that same group, the Group Manager <span class="bcp14">MUST NOT</span> reassign a Sender ID within the group. This prevents to reuse a Sender ID ('kid') with the same triple (Gid, Master Secret, Master Salt). Within this restriction, the Group Manager can assign a Sender ID used under an old Gid value (including under a same, recycled Gid value), thus avoiding Sender ID values to irrecoverably grow in size.<a href="#section-3.2.1.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2.1.2-2">Even when an endpoint joining a group is recognized as a current member of that group, e.g., through the ongoing secure communication association, the Group Manager <span class="bcp14">MUST</span> assign a new Sender ID different than the one currently used by the endpoint in the group, unless the group is rekeyed first and a new Gid value is established.<a href="#section-3.2.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="relation-between-identifiers-and-keying-material">
<section id="section-3.2.1.3">
            <h5 id="name-relation-between-identifier">
<a href="#section-3.2.1.3" class="section-number selfRef">3.2.1.3. </a><a href="#name-relation-between-identifier" class="section-name selfRef">Relation between Identifiers and Keying Material</a>
            </h5>
<p id="section-3.2.1.3-1"><a href="#fig-key-material-diagram" class="auto internal xref">Figure 2</a> overviews the different identifiers and keying material components, considering their relation and possible reuse across group rekeying.<a href="#section-3.2.1.3-1" class="pilcrow">¶</a></p>
<span id="name-relations-among-keying-mate"></span><div id="fig-key-material-diagram">
<figure id="figure-2">
              <div class="alignCenter art-text artwork" id="section-3.2.1.3-2.1">
<pre>
Components changed in lockstep
    upon a group rekeying
+----------------------------+            * Changing a kid does not
|                            |              need changing the Group ID
| Master               Group |&lt;--&gt; kid1
| Secret &lt;---&gt; o &lt;---&gt;  ID   |            * A kid is not reassigned
|              ^             |&lt;--&gt; kid2     under the ongoing usage of
|              |             |              the current Group ID
|              |             |&lt;--&gt; kid3
|              v             |            * Upon changing the Group ID,
|         Master Salt        | ... ...      every current kid should
|         (optional)         |              be preserved for efficient
|                            |              key rollover
| The Key Generation Number  |
| is incremented by 1        |            * After changing Group ID, an
|                            |              unused kid can be assigned,
+----------------------------+              even if it was used before
                                            the Group ID change
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-relations-among-keying-mate" class="selfRef">Relations among keying material components.</a>
              </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-additional-entities">
<section id="section-3.3">
        <h3 id="name-support-for-signature-check">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-support-for-signature-check" class="section-name selfRef">Support for Signature Checkers</a>
        </h3>
<p id="section-3.3-1">The Group Manager may serve signature checkers, e.g., intermediary gateways, which verify  countersignatures of messages protected in group mode (see <a href="#sec-processing-signature-checker" class="auto internal xref">Section 8.5</a>). These entities do not join a group as members, but can retrieve authentication credentials of group members and other selected group data from the Group Manager.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">In order to verify countersignatures of messages in a group, a signature checker needs to retrieve the following information about the group:<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-3.1">
            <p id="section-3.3-3.1.1">The current ID Context (Gid) used in the group.<a href="#section-3.3-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.3-3.2">
            <p id="section-3.3-3.2.1">The authentication credentials of the group members and of the Group Manager.<a href="#section-3.3-3.2.1" class="pilcrow">¶</a></p>
<p id="section-3.3-3.2.2">
If the signature checker is provided with a CWT for a given entity, then the authentication credential associated with that entity is the untagged CWT.<a href="#section-3.3-3.2.2" class="pilcrow">¶</a></p>
<p id="section-3.3-3.2.3">
If the signature checker is provided with a chain or a bag of X.509 / C509 certificates or of CWTs for a given entity, then the authentication credential associated with that entity is the end-entity certificate or end-entity untagged CWT.<a href="#section-3.3-3.2.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.3-3.3">
            <p id="section-3.3-3.3.1">The current Signature Encryption Key (see <a href="#ssec-common-context-group-enc-key" class="auto internal xref">Section 2.1.8</a>).<a href="#section-3.3-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.3-3.4">
            <p id="section-3.3-3.4.1">The identifiers of the algorithms used in the group (see <a href="#sec-context" class="auto internal xref">Section 2</a>), i.e.: i) Group Encryption Algorithm and Signature Algorithm; and ii) AEAD Algorithm and Pairwise Key Agreement Algorithm, if such parameters are set in the Common Context (see <a href="#ssec-common-context-aead-alg" class="auto internal xref">Section 2.1.1</a> and <a href="#ssec-common-context-dh-alg" class="auto internal xref">Section 2.1.9</a>).<a href="#section-3.3-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.3-4">A signature checker <span class="bcp14">MUST</span> be authorized before it can retrieve such information, for example with the use of <span>[<a href="#I-D.ietf-ace-key-groupcomm-oscore" class="cite xref">I-D.ietf-ace-key-groupcomm-oscore</a>]</span>.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-group-manager">
<section id="section-3.4">
        <h3 id="name-responsibilities-of-the-gro">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-responsibilities-of-the-gro" class="section-name selfRef">Responsibilities of the Group Manager</a>
        </h3>
<p id="section-3.4-1">The Group Manager is responsible for performing the following tasks:<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.4-2">
<li id="section-3.4-2.1">
            <p id="section-3.4-2.1.1">Creating and managing OSCORE groups. This includes the assignment of a Gid to every newly created group, ensuring uniqueness of Gids within the set of its OSCORE groups and, optionally, the secure recycling of Gids.<a href="#section-3.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.4-2.2">
            <p id="section-3.4-2.2.1">Defining policies for authorizing the joining of its OSCORE groups.<a href="#section-3.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.4-2.3">
            <p id="section-3.4-2.3.1">Handling the join process to add new endpoints as group members.<a href="#section-3.4-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.4-2.4">
            <p id="section-3.4-2.4.1">Establishing the Common Context part of the Security Context, and providing it to authorized group members during the join process, together with the corresponding Sender Context.<a href="#section-3.4-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.4-2.5">
            <p id="section-3.4-2.5.1">Updating the Key Generation Number and the Gid of its OSCORE groups, upon renewing the respective Security Context.<a href="#section-3.4-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.4-2.6">
            <p id="section-3.4-2.6.1">Generating and managing Sender IDs within its OSCORE groups, as well as assigning and providing them to new endpoints during the join process, or to current group members upon request of renewal or re-joining. This includes ensuring that:<a href="#section-3.4-2.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4-2.6.2.1">
                <p id="section-3.4-2.6.2.1.1">Each Sender ID is unique within each of the OSCORE groups;<a href="#section-3.4-2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.4-2.6.2.2">
                <p id="section-3.4-2.6.2.2.1">Each Sender ID is not reassigned within the same group since the latest time when the current Gid value was assigned to the group. That is, the Sender ID is not reassigned even to a current group member re-joining the same group, without a rekeying happening first.<a href="#section-3.4-2.6.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-3.4-2.7">
            <p id="section-3.4-2.7.1">Defining communication policies for each of its OSCORE groups, and signaling them to new endpoints during the join process.<a href="#section-3.4-2.7.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.4-2.8">
            <p id="section-3.4-2.8.1">Renewing the Security Context of an OSCORE group upon membership change, by revoking and renewing common security parameters and keying material (rekeying).<a href="#section-3.4-2.8.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.4-2.9">
            <p id="section-3.4-2.9.1">Providing the management keying material that a new endpoint requires to participate in the rekeying process, consistently with the key management scheme used in the group joined by the new endpoint.<a href="#section-3.4-2.9.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.4-2.10">
            <p id="section-3.4-2.10.1">Assisting a group member that has missed a group rekeying instance to understand which authentication credentials and Recipient Contexts to delete, as associated with former group members.<a href="#section-3.4-2.10.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.4-2.11">
            <p id="section-3.4-2.11.1">Acting as key repository, in order to handle the authentication credentials of the members of its OSCORE groups, and providing such authentication credentials to other members of the same group upon request. The actual storage of authentication credentials may be entrusted to a separate secure storage device or service.<a href="#section-3.4-2.11.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.4-2.12">
            <p id="section-3.4-2.12.1">Validating that the format and parameters of authentication credentials of group members are consistent with the public key algorithm and related parameters used in the respective OSCORE group.<a href="#section-3.4-2.12.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-3.4-3">The Group Manager specified in <span>[<a href="#I-D.ietf-ace-key-groupcomm-oscore" class="cite xref">I-D.ietf-ace-key-groupcomm-oscore</a>]</span> provides this functionality.<a href="#section-3.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-cose-object">
<section id="section-4">
      <h2 id="name-the-cose-object">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-the-cose-object" class="section-name selfRef">The COSE Object</a>
      </h2>
<p id="section-4-1">Building on <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5" class="relref">Section 5</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, this section defines how to use COSE <span>[<a href="#RFC9052" class="cite xref">RFC9052</a>]</span> to wrap and protect data in the original message. Like OSCORE, Group OSCORE uses the untagged COSE_Encrypt0 structure with an Authenticated Encryption with Associated Data (AEAD) algorithm. Unless otherwise specified, the following modifications to what is defined for OSCORE apply, for both the group mode and the pairwise mode of Group OSCORE.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="sec-cose-object-unprotected-field">
<section id="section-4.1">
        <h3 id="name-countersignature">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-countersignature" class="section-name selfRef">Countersignature</a>
        </h3>
<p id="section-4.1-1">When protecting a message in group mode, the 'unprotected' field <span class="bcp14">MUST</span> additionally include the following parameter:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">
            <p id="section-4.1-2.1.1">Countersignature0 version 2: its value is set to the countersignature of the COSE object.<a href="#section-4.1-2.1.1" class="pilcrow">¶</a></p>
<p id="section-4.1-2.1.2">
The countersignature is computed by the sender as described in Sections <a href="https://rfc-editor.org/rfc/rfc9338#section-3.2" class="relref">3.2</a> and <a href="https://rfc-editor.org/rfc/rfc9338#section-3.3" class="relref">3.3</a> of <span>[<a href="#RFC9338" class="cite xref">RFC9338</a>]</span>, by using its private key and according to the Signature Algorithm in the Security Context.<a href="#section-4.1-2.1.2" class="pilcrow">¶</a></p>
<p id="section-4.1-2.1.3">
In particular, the Countersign_structure contains the context text string "CounterSignature0", the external_aad as defined in <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a> of this document, and the ciphertext of the COSE object as payload.<a href="#section-4.1-2.1.3" class="pilcrow">¶</a></p>
</li>
        </ul>
<div id="clarifications-on-using-a-countersignature">
<section id="section-4.1.1">
          <h4 id="name-clarifications-on-using-a-c">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-clarifications-on-using-a-c" class="section-name selfRef">Clarifications on Using a Countersignature</a>
          </h4>
<p id="section-4.1.1-1">The literature commonly refers to a countersignature as a signature computed by an entity A over a document already protected by a different entity B.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2">However, the COSE_Countersignature0 structure belongs to the set of abbreviated countersignatures defined in Sections <a href="https://rfc-editor.org/rfc/rfc9338#section-3.2" class="relref">3.2</a> and <a href="https://rfc-editor.org/rfc/rfc9338#section-3.3" class="relref">3.3</a> of <span>[<a href="#RFC9338" class="cite xref">RFC9338</a>]</span>, which were designed primarily to deal with the problem of encrypted group messaging, but where it is required to know who originated the message.<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1.1-3">Since the parameters for computing or verifying the abbreviated countersignature generated by A are provided by the same context used to describe the security processing performed by B and to be countersigned, these structures are applicable also when the two entities A and B are actually the same one, like the sender of a Group OSCORE message protected in group mode.<a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-cose-object-kid">
<section id="section-4.2">
        <h3 id="name-the-kid-and-kid-context-par">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-the-kid-and-kid-context-par" class="section-name selfRef">The 'kid' and 'kid context' parameters</a>
        </h3>
<p id="section-4.2-1">The value of the 'kid' parameter in the 'unprotected' field of response messages <span class="bcp14">MUST</span> be set to the Sender ID of the endpoint transmitting the message, if the request was protected in group mode. That is, unlike in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, the 'kid' parameter is always present in responses to a request that was protected in group mode.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">The value of the 'kid context' parameter in the 'unprotected' field of request messages <span class="bcp14">MUST</span> be set to the ID Context, i.e., the Group Identifier value (Gid) of the group. That is, unlike in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, the 'kid context' parameter is always present in requests.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-cose-object-aead-nonce">
<section id="section-4.3">
        <h3 id="name-aead-nonce">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-aead-nonce" class="section-name selfRef">AEAD Nonce</a>
        </h3>
<p id="section-4.3-1">The AEAD nonce is constructed like in OSCORE, with the difference that step 4 in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.2" class="relref">Section 5.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> is replaced with:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">A. and then XOR with the X least significant bits of the Common IV, where X is the length in bits of the AEAD nonce.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-cose-object-ext-aad">
<section id="section-4.4">
        <h3 id="name-external_aad">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-external_aad" class="section-name selfRef">external_aad</a>
        </h3>
<p id="section-4.4-1">The external_aad of the Additional Authenticated Data (AAD) is different compared to OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, and is defined in this section.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">The same external_aad structure is used in group mode and pairwise mode for encryption/decryption (see <span><a href="https://rfc-editor.org/rfc/rfc9052#section-5.3" class="relref">Section 5.3</a> of [<a href="#RFC9052" class="cite xref">RFC9052</a>]</span>), as well as in group mode for computing and verifying the countersignature (see Sections <a href="https://rfc-editor.org/rfc/rfc9338#section-3.2" class="relref">3.2</a> and <a href="https://rfc-editor.org/rfc/rfc9338#section-3.3" class="relref">3.3</a> of <span>[<a href="#RFC9338" class="cite xref">RFC9338</a>]</span>).<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">In particular, the external_aad includes also the Signature Algorithm, the Group Encryption Algorithm, the Pairwise Key Agreement Algorithm, the value of the 'kid context' in the COSE object of the request, the OSCORE Option of the protected message, the sender's authentication credential, and the Group Manager's authentication credential.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">The external_aad <span class="bcp14">SHALL</span> be a CBOR array wrapped in a bstr object as defined below, following the notation of <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span>:<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<span id="name-external_aad-2"></span><div id="fig-ext-aad">
<figure id="figure-3">
          <div class="alignCenter art-CDDL art-text artwork" id="section-4.4-5.1">
<pre>
external_aad = bstr .cbor aad_array

aad_array = [
   oscore_version : uint,
   algorithms : [alg_aead : int / tstr / null,
                 alg_group_enc : int / tstr / null,
                 alg_signature : int / tstr / null,
                 alg_pairwise_key_agreement : int / tstr / null],
   request_kid : bstr,
   request_piv : bstr,
   options : bstr,
   request_kid_context : bstr,
   OSCORE_option : bstr,
   sender_cred : bstr,
   gm_cred : bstr
]
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-external_aad-2" class="selfRef">external_aad</a>
          </figcaption></figure>
</div>
<p id="section-4.4-6">Compared with <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">Section 5.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, the aad_array has the following differences.<a href="#section-4.4-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-7.1">
            <p id="section-4.4-7.1.1">The 'algorithms' array is extended as follows.<a href="#section-4.4-7.1.1" class="pilcrow">¶</a></p>
<p id="section-4.4-7.1.2">
The parameter 'alg_aead' <span class="bcp14">MUST</span> be set to the CBOR simple value <code>null</code> (0xf6) if the parameter AEAD Algorithm in the Security Context is not set (see <a href="#sec-context" class="auto internal xref">Section 2</a>). Otherwise, regardless of whether the endpoint supports the pairwise mode or not, this parameter <span class="bcp14">MUST</span> specify AEAD Algorithm from the Common Context (see <a href="#ssec-common-context-aead-alg" class="auto internal xref">Section 2.1.1</a>) as per <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">Section 5.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-4.4-7.1.2" class="pilcrow">¶</a></p>
<p id="section-4.4-7.1.3">
Furthermore, the 'algorithms' array additionally includes:<a href="#section-4.4-7.1.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-7.1.4.1">
                <p id="section-4.4-7.1.4.1.1">'alg_group_enc', which specifies Group Encryption Algorithm from the Common Context (see <a href="#ssec-common-context-cs-enc-alg" class="auto internal xref">Section 2.1.6</a>). This parameter <span class="bcp14">MUST</span> be set to the CBOR simple value <code>null</code> (0xf6) if the parameter Group Encryption Algorithm in the Common Context is not set. Otherwise, regardless of whether the endpoint supports the group mode or not, this parameter <span class="bcp14">MUST</span> specify Group Encryption Algorithm as a CBOR integer or text string, consistently with the "Value" field in the "COSE Algorithms" Registry for this algorithm.<a href="#section-4.4-7.1.4.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.4-7.1.4.2">
                <p id="section-4.4-7.1.4.2.1">'alg_signature', which specifies Signature Algorithm from the Common Context (see <a href="#ssec-common-context-cs-alg" class="auto internal xref">Section 2.1.7</a>). This parameter <span class="bcp14">MUST</span> be set to the CBOR simple value <code>null</code> (0xf6) if the parameter Signature Algorithm in the Common Context is not set. Otherwise, regardless of whether the endpoint supports the group mode or not, this parameter <span class="bcp14">MUST</span> specify Signature Algorithm as a CBOR integer or text string, consistently with the "Value" field in the "COSE Algorithms" Registry for this algorithm.<a href="#section-4.4-7.1.4.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.4-7.1.4.3">
                <p id="section-4.4-7.1.4.3.1">'alg_pairwise_key_agreement', which specifies Pairwise Key Agreement Algorithm from the Common Context (see <a href="#ssec-common-context-dh-alg" class="auto internal xref">Section 2.1.9</a>). This parameter <span class="bcp14">MUST</span> be set to the CBOR simple value <code>null</code> (0xf6) if Pairwise Key Agreement Algorithm in the Common Context is not set. Otherwise, regardless of whether the endpoint supports the pairwise mode or not, this parameter <span class="bcp14">MUST</span> specify Pairwise Key Agreement Algorithm as a CBOR integer or text string, consistently with the "Value" field in the "COSE Algorithms" Registry for this algorithm.<a href="#section-4.4-7.1.4.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-4.4-7.2">
            <p id="section-4.4-7.2.1">The new element 'request_kid_context' contains the value of the 'kid context' in the COSE object of the request (see <a href="#sec-cose-object-kid" class="auto internal xref">Section 4.2</a>).<a href="#section-4.4-7.2.1" class="pilcrow">¶</a></p>
<p id="section-4.4-7.2.2">
This enables endpoints to safely keep a long exchange active beyond a possible change of Gid (i.e., of ID Context), following a group rekeying (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>). In fact, it ensures that every response within a long exchange cryptographically matches with only one request (i.e., the request associated with that long exchange), rather than with multiple requests that were protected with different keying material but share the same 'request_kid' and 'request_piv' values.<a href="#section-4.4-7.2.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-7.3">
            <p id="section-4.4-7.3.1">The new element 'OSCORE_option', containing the value of the OSCORE Option present in the protected message, encoded as a binary string. This prevents the attack described in <a href="#ssec-cross-group-injection" class="auto internal xref">Section 13.7</a> when using the group mode, as further explained  in <a href="#sssec-cross-group-injection-group-mode" class="auto internal xref">Section 13.7.2</a>.<a href="#section-4.4-7.3.1" class="pilcrow">¶</a></p>
<p id="section-4.4-7.3.2">
Note for implementation: this construction requires the OSCORE Option of the message to be generated and finalized before computing the ciphertext of the COSE_Encrypt0 object (when using the group mode or the pairwise mode) and before calculating the countersignature (when using the group mode). Also, the aad_array needs to be large enough to contain the largest possible OSCORE Option.<a href="#section-4.4-7.3.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-7.4">
            <p id="section-4.4-7.4.1">The new element 'sender_cred', containing the sender's authentication credential. This parameter <span class="bcp14">MUST</span> be set to a CBOR byte string, which encodes the sender's authentication credential in its original binary representation made available to other endpoints in the group (see <a href="#sec-pub-key-format" class="auto internal xref">Section 2.4</a>).<a href="#section-4.4-7.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-7.5">
            <p id="section-4.4-7.5.1">The new element 'gm_cred', containing the Group Manager's authentication credential. This parameter <span class="bcp14">MUST</span> be set to a CBOR byte string, which encodes the Group Manager's authentication credential in its original binary representation made available to other endpoints in the group (see <a href="#sec-pub-key-format" class="auto internal xref">Section 2.4</a>). This prevents the attack described in <a href="#ssec-group-cloning" class="auto internal xref">Section 13.8</a>.<a href="#section-4.4-7.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="compression">
<section id="section-5">
      <h2 id="name-oscore-header-compression">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-oscore-header-compression" class="section-name selfRef">OSCORE Header Compression</a>
      </h2>
<p id="section-5-1">The OSCORE header compression defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-6" class="relref">Section 6</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> is used for compactly encoding the COSE_Encrypt0 object specified in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> of this document, with the following differences.<a href="#section-5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-2.1">
          <p id="section-5-2.1.1">When the Group OSCORE message is protected in group mode, the message payload <span class="bcp14">SHALL</span> encode the ciphertext of the COSE object, concatenated with the encrypted countersignature of the COSE object. That is:<a href="#section-5-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-2.1.2.1">
              <p id="section-5-2.1.2.1.1">The plain, original countersignature of the COSE object, namely SIGNATURE, is specified in the "Countersignature0 version 2" parameter within the 'unprotected' field of the COSE object (see <a href="#sec-cose-object-unprotected-field" class="auto internal xref">Section 4.1</a>).<a href="#section-5-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5-2.1.2.2">
              <p id="section-5-2.1.2.2.1">The encrypted countersignature, namely ENC_SIGNATURE, is computed as<a href="#section-5-2.1.2.2.1" class="pilcrow">¶</a></p>
<p id="section-5-2.1.2.2.2">
ENC_SIGNATURE = SIGNATURE XOR KEYSTREAM<a href="#section-5-2.1.2.2.2" class="pilcrow">¶</a></p>
<p id="section-5-2.1.2.2.3">
where KEYSTREAM is derived as per <a href="#sssec-encrypted-signature-keystream" class="auto internal xref">Section 5.1</a>.<a href="#section-5-2.1.2.2.3" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li class="normal" id="section-5-2.2">
          <p id="section-5-2.2.1">When the Group OSCORE message is protected in pairwise mode, the message payload <span class="bcp14">SHALL</span> encode the ciphertext of the COSE object.<a href="#section-5-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-2.3">
          <p id="section-5-2.3.1">This document defines the usage of the sixth least significant bit, called "Group Flag", in the first byte of the OSCORE Option containing the OSCORE flag bits. This flag bit is specified in <a href="#iana-cons-flag-bits" class="auto internal xref">Section 14.1</a>.<a href="#section-5-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-2.4">
          <p id="section-5-2.4.1">The Group Flag <span class="bcp14">MUST</span> be set to 1 if the Group OSCORE message is protected using the group mode (see <a href="#mess-processing" class="auto internal xref">Section 8</a>).<a href="#section-5-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-2.5">
          <p id="section-5-2.5.1">The Group Flag <span class="bcp14">MUST</span> be set to 0 if the Group OSCORE message is protected using the pairwise mode (see <a href="#sec-pairwise-protection" class="auto internal xref">Section 9</a>). The Group Flag <span class="bcp14">MUST</span> also be set to 0 for ordinary OSCORE messages processed according to <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-5-2.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="sssec-encrypted-signature-keystream">
<section id="section-5.1">
        <h3 id="name-keystream-derivation-for-co">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-keystream-derivation-for-co" class="section-name selfRef">Keystream Derivation for Countersignature Encryption</a>
        </h3>
<p id="section-5.1-1">The following defines how an endpoint derives the keystream KEYSTREAM, used to encrypt/decrypt the countersignature of an outgoing/incoming message M protected in group mode.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The keystream <span class="bcp14">SHALL</span> be derived as follows, by using the HKDF Algorithm from the Common Context (see Section 3.2 of <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>), which consists of composing the HKDF-Extract and HKDF-Expand steps <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">KEYSTREAM = HKDF(salt, IKM, info, L)<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">The input parameters of HKDF are as follows.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-5.1">
            <p id="section-5.1-5.1.1">salt takes as value the Partial IV (PIV) used to protect M. Note that, if M is a response, salt takes as value either: i) the fresh Partial IV generated by the server and included in the response; or ii) the same Partial IV of the request generated by the client and not included in the response.<a href="#section-5.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-5.2">
            <p id="section-5.1-5.2.1">IKM is the Signature Encryption Key from the Common Context (see <a href="#ssec-common-context-group-enc-key" class="auto internal xref">Section 2.1.8</a>).<a href="#section-5.1-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-5.3">
            <p id="section-5.1-5.3.1">info is the serialization of a CBOR array consisting of (the notation follows <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span>):<a href="#section-5.1-5.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div class="lang-CDDL sourcecode" id="section-5.1-6">
<pre>
   info = [
     id : bstr,
     id_context : bstr,
     type : bool,
     L : uint
   ]
</pre><a href="#section-5.1-6" class="pilcrow">¶</a>
</div>
<p id="section-5.1-7">where:<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-8.1">
            <p id="section-5.1-8.1.1">id is the Sender ID of the endpoint that generated PIV.<a href="#section-5.1-8.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-8.2">
            <p id="section-5.1-8.2.1">id_context is the ID Context (Gid) used when protecting M.<a href="#section-5.1-8.2.1" class="pilcrow">¶</a></p>
<p id="section-5.1-8.2.2">
Note that, in case of group rekeying, a server might use a different Gid when protecting a response, compared to the Gid that it used to verify (that the client used to protect) the request, see <a href="#ssec-protect-response" class="auto internal xref">Section 8.3</a>.<a href="#section-5.1-8.2.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-8.3">
            <p id="section-5.1-8.3.1">type is the CBOR simple value <code>true</code> (0xf5) if M is a request, or the CBOR simple value <code>false</code> (0xf4) otherwise.<a href="#section-5.1-8.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-8.4">
            <p id="section-5.1-8.4.1">L is the size of the countersignature, as per Signature Algorithm from the Common Context (see <a href="#ssec-common-context-cs-alg" class="auto internal xref">Section 2.1.7</a>), in bytes.<a href="#section-5.1-8.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="examples-of-compressed-cose-objects">
<section id="section-5.2">
        <h3 id="name-examples-of-compressed-cose">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-examples-of-compressed-cose" class="section-name selfRef">Examples of Compressed COSE Objects</a>
        </h3>
<p id="section-5.2-1">This section covers a list of OSCORE Header Compression examples of Group OSCORE used in group mode (see <a href="#sssec-example-cose-group" class="auto internal xref">Section 5.2.1</a>) or in pairwise mode (see <a href="#sssec-example-cose-pairwise" class="auto internal xref">Section 5.2.2</a>).<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">The examples assume that the COSE_Encrypt0 object is set (which means the CoAP message and cryptographic material is known). Note that the examples do not include the full CoAP unprotected message or the full Security Context, but only the input necessary to the compression mechanism, i.e., the COSE_Encrypt0 object. The output is the compressed COSE object as defined in <a href="#compression" class="auto internal xref">Section 5</a> and divided into two parts, since the object is transported in two CoAP fields: OSCORE Option and payload.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">The examples assume that the plaintext (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.3" class="relref">Section 5.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>) is 6 bytes long, and that the AEAD tag is 8 bytes long, hence resulting in a ciphertext which is 14 bytes long. When using the group mode, the COSE_Countersignature0 byte string as described in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> is assumed to be 64 bytes long.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<div id="sssec-example-cose-group">
<section id="section-5.2.1">
          <h4 id="name-examples-in-group-mode">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-examples-in-group-mode" class="section-name selfRef">Examples in Group Mode</a>
          </h4>
<p id="section-5.2.1-1">Request with ciphertext = 0xaea0155667924dff8a24e4cb35b9, kid = 0x25, Partial IV = 5 and kid context = 0x44616c.<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.1-2.1">
              <p id="section-5.2.1-2.1.1">Before compression (96 bytes):<a href="#section-5.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-5.2.1-3">
<pre>
   [
     / protected / h'',
     / unprotected / {
       / kid /                           4 : h'25',
       / Partial IV /                    6 : h'05',
       / kid context /                  10 : h'44616c',
       / Countersignature0 version 2 /  12 : h'66e6d9b0
       db009f3e105a673f8855611726caed57f530f8cae9d0b168
       513ab949fedc3e80a96ebe94ba08d3f8d3bf83487458e2ab
       4c2f936ff78b50e33c885e35'
     },
     / ciphertext / h'aea0155667924dff8a24e4cb35b9'
   ]
</pre><a href="#section-5.2.1-3" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-5.2.1-4.1">
              <p id="section-5.2.1-4.1.1">After compression (85 bytes):<a href="#section-5.2.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-5.2.1-5">
<pre>
   Flag byte: 0b00111001 = 0x39 (1 byte)

   Option Value: 0x39 05 03 44 61 6c 25 (7 bytes)

   Payload: 0xaea0155667924dff8a24e4cb35b9 de9e ... f1
   (14 bytes + size of the encrypted countersignature)
</pre><a href="#section-5.2.1-5" class="pilcrow">¶</a>
</div>
<p id="section-5.2.1-6"></p>
<p id="section-5.2.1-7">Response with ciphertext = 0x60b035059d9ef5667c5a0710823b, kid = 0x52 and no Partial IV.<a href="#section-5.2.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.1-8.1">
              <p id="section-5.2.1-8.1.1">Before compression (88 bytes):<a href="#section-5.2.1-8.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-5.2.1-9">
<pre>
   [
     / protected / h'',
     / unprotected / {
       / kid /                           4 : h'52',
       / Countersignature0 version 2 /  12 : h'f5b659b8
       24487eb349c5c5c8a3fe401784cade2892725438e8be0fab
       daa2867ee6d29f68edb0818e50ebf98c28b923d0205f5162
       e73662e27c1a3ec562a49b80'
     },
     / ciphertext / h'60b035059d9ef5667c5a0710823b'
   ]
</pre><a href="#section-5.2.1-9" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-5.2.1-10.1">
              <p id="section-5.2.1-10.1.1">After compression (80 bytes):<a href="#section-5.2.1-10.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-5.2.1-11">
<pre>
   Flag byte: 0b00101000 = 0x28 (1 byte)

   Option Value: 0x28 52 (2 bytes)

   Payload: 0x60b035059d9ef5667c5a0710823b ca1e ... b3
   (14 bytes + size of the encrypted countersignature)
</pre><a href="#section-5.2.1-11" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sssec-example-cose-pairwise">
<section id="section-5.2.2">
          <h4 id="name-examples-in-pairwise-mode">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-examples-in-pairwise-mode" class="section-name selfRef">Examples in Pairwise Mode</a>
          </h4>
<p id="section-5.2.2-1">Request with ciphertext = 0xaea0155667924dff8a24e4cb35b9, kid = 0x25, Partial IV = 5 and kid context = 0x44616c.<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.2-2.1">
              <p id="section-5.2.2-2.1.1">Before compression (29 bytes):<a href="#section-5.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-5.2.2-3">
<pre>
   [
     / protected / h'',
     / unprotected / {
       / kid /           4 : h'25',
       / Partial IV /    6 : h'05',
       / kid context /  10 : h'44616c'
     },
     / ciphertext / h'aea0155667924dff8a24e4cb35b9'
   ]
</pre><a href="#section-5.2.2-3" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-5.2.2-4.1">
              <p id="section-5.2.2-4.1.1">After compression (21 bytes):<a href="#section-5.2.2-4.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-5.2.2-5">
<pre>
   Flag byte: 0b00011001 = 0x19 (1 byte)

   Option Value: 0x19 05 03 44 61 6c 25 (7 bytes)

   Payload: 0xaea0155667924dff8a24e4cb35b9 (14 bytes)
</pre><a href="#section-5.2.2-5" class="pilcrow">¶</a>
</div>
<p id="section-5.2.2-6"></p>
<p id="section-5.2.2-7">Response with ciphertext = 0x60b035059d9ef5667c5a0710823b and no Partial IV.<a href="#section-5.2.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.2-8.1">
              <p id="section-5.2.2-8.1.1">Before compression (18 bytes):<a href="#section-5.2.2-8.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-5.2.2-9">
<pre>
   [
     / protected / h'',
     / unprotected / {},
     / ciphertext / h'60b035059d9ef5667c5a0710823b'
   ]
</pre><a href="#section-5.2.2-9" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-5.2.2-10.1">
              <p id="section-5.2.2-10.1.1">After compression (14 bytes):<a href="#section-5.2.2-10.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-5.2.2-11">
<pre>
   Flag byte: 0b00000000 = 0x00 (1 byte)

   Option Value: 0x (0 bytes)

   Payload: 0x60b035059d9ef5667c5a0710823b (14 bytes)
</pre><a href="#section-5.2.2-11" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="message-binding-sequence-numbers-freshness-and-replay-protection">
<section id="section-6">
      <h2 id="name-message-binding-sequence-nu">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-message-binding-sequence-nu" class="section-name selfRef">Message Binding, Sequence Numbers, Freshness, and Replay Protection</a>
      </h2>
<p id="section-6-1">Like OSCORE, Group OSCORE provides message binding of responses to requests, as well as uniqueness of AEAD (key, nonce) pair (see Sections <a href="https://rfc-editor.org/rfc/rfc8613#section-7.1" class="relref">7.1</a> and <a href="https://rfc-editor.org/rfc/rfc8613#section-7.2" class="relref">7.2</a> of <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, respectively).<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="sec-long-exchanges">
<section id="section-6.1">
        <h3 id="name-supporting-multiple-respons">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-supporting-multiple-respons" class="section-name selfRef">Supporting Multiple Responses in Long Exchanges</a>
        </h3>
<p id="section-6.1-1">For each of its ongoing long exchange, a client maintains one Response Number for each different server. Then, separately for each server, the client uses the associated Response Number to perform ordering and replay protection of responses received from that server within that long exchange (see <a href="#sec-replay-protection-responses" class="auto internal xref">Section 6.3.1</a>).<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">That is, the Response Number has the same purpose that the Notification Number has in OSCORE (see Section 4.1.3.5.2 of <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>), but a client uses it for handling any response from the associated server within a long exchange.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">Group OSCORE allows to preserve a long exchange active indefinitely, even in case the group is rekeyed, with consequent change of ID Context, or in case the client obtains a new Sender ID.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">As defined in <a href="#mess-processing" class="auto internal xref">Section 8</a>, this is achieved by the client and server(s) storing the 'kid' and 'kid context' used in the original request, throughout the whole duration of the long exchange.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">Upon leaving the group or before re-joining the group, a group member <span class="bcp14">MUST</span> terminate all the ongoing long exchanges that it has started in the group as a client, and hence frees up the CoAP Token associated with the corresponding request.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-freshness">
<section id="section-6.2">
        <h3 id="name-freshness">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-freshness" class="section-name selfRef">Freshness</a>
        </h3>
<p id="section-6.2-1">If the application requires freshness, e.g., according to time- or event-based policies (see <span><a href="https://rfc-editor.org/rfc/rfc9175#section-2.5.1" class="relref">Section 2.5.1</a> of [<a href="#RFC9175" class="cite xref">RFC9175</a>]</span>), a server can use the approach in <a href="#sec-synch-challenge-response" class="auto internal xref">Section 10</a> as a variant of the Challenge-Response procedure based on the Echo Option <span>[<a href="#RFC9175" class="cite xref">RFC9175</a>]</span>, before delivering request messages from a client to the application.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">Like in OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, assuming an honest server, the message binding guarantees that a response is not older than the request it replies to. Therefore, building on <span><a href="https://rfc-editor.org/rfc/rfc8613#section-7.3" class="relref">Section 7.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, the following properties hold for Group OSCORE.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-3.1">
            <p id="section-6.2-3.1.1">The freshness of a response can be assessed if it is received soon after the request.<a href="#section-6.2-3.1.1" class="pilcrow">¶</a></p>
<p id="section-6.2-3.1.2">
For responses within a long exchange, this assessment gets weaker with time. If such responses are Observe notifications <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, it is <span class="bcp14">RECOMMENDED</span> that the client regularly re-register the observation.<a href="#section-6.2-3.1.2" class="pilcrow">¶</a></p>
<p id="section-6.2-3.1.3">
If the request was neither a group request nor an Observe request, there is at most a single valid response and only from one, individually targeted server in the group. Thus, freshness can be assessed depending on when the request was sent.<a href="#section-6.2-3.1.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.2-3.2">
            <p id="section-6.2-3.2.1">It is not guaranteed that a misbehaving server did not create the response before receiving the request, i.e., Group OSCORE does not verify server aliveness.<a href="#section-6.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.2-3.3">
            <p id="section-6.2-3.3.1">For requests and responses, the received Partial IV allows a recipient to determine the relative order of requests or responses.<a href="#section-6.2-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-replay-protection">
<section id="section-6.3">
        <h3 id="name-replay-protection">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-replay-protection" class="section-name selfRef">Replay Protection</a>
        </h3>
<p id="section-6.3-1">Like in OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, the replay protection relies on the Partial IV of incoming messages. A server updates the Replay Window of its Recipient Contexts based on the Partial IV values in received request messages, which correspond to the Sender Sequence Numbers of the clients. Note that there can be large jumps in these Sender Sequence Number values, for example when a client exchanges unicast messages with other servers. The operation of validating the Partial IV and performing replay protection <span class="bcp14">MUST</span> be atomic. The update of Replay Windows is described in <a href="#ssec-loss-mutable-context" class="auto internal xref">Section 2.6.1</a>.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">The protection from replay of requests is performed as per <span><a href="https://rfc-editor.org/rfc/rfc8613#section-7.4" class="relref">Section 7.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, separately for each client and by leveraging the Replay Window in the corresponding Recipient Context. The protection from replay of responses in a long exchange is performed as defined in <a href="#sec-replay-protection-responses" class="auto internal xref">Section 6.3.1</a>.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<div id="sec-replay-protection-responses">
<section id="section-6.3.1">
          <h4 id="name-replay-protection-of-respon">
<a href="#section-6.3.1" class="section-number selfRef">6.3.1. </a><a href="#name-replay-protection-of-respon" class="section-name selfRef">Replay Protection of Responses</a>
          </h4>
<p id="section-6.3.1-1">A client uses the method defined in this section in order to check whether a received response is a replay.<a href="#section-6.3.1-1" class="pilcrow">¶</a></p>
<p id="section-6.3.1-2">This especially applies to responses received within a long exchange, during which multiple such responses can be received from the same server to the corresponding request. These include Observe notifications <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>; and non-notification responses as a reply to a group request, which the client can receive until the CoAP Token value associated with the group request is freed up (see Section 3.1.6 of <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>).<a href="#section-6.3.1-2" class="pilcrow">¶</a></p>
<p id="section-6.3.1-3">When sending a response (both successful and error), a server <span class="bcp14">MUST</span> include its Sender Sequence Number as Partial IV in the response, except when sending the first response to the corresponding request, in which case the Partial IV in the response <span class="bcp14">MAY</span> be omitted.<a href="#section-6.3.1-3" class="pilcrow">¶</a></p>
<p id="section-6.3.1-4">In order to protect against replay, the client <span class="bcp14">SHALL</span> maintain for each ongoing long exchange one Response Number for each different server. The Response Number is a non-negative integer containing the largest Partial IV of the responses received from that server during the long exchange, while using the same Security Context.<a href="#section-6.3.1-4" class="pilcrow">¶</a></p>
<p id="section-6.3.1-5">Then, separately for each server, the client uses the associated Response Number to perform ordering and replay protection of the responses from that server during the long exchange, by comparing their Partial IVs with one another and against the Response Number.<a href="#section-6.3.1-5" class="pilcrow">¶</a></p>
<p id="section-6.3.1-6">For every long exchange, the Response Number associated with a server is initialized to the Partial IV of the response from that server such that, within the long exchange, it is the first response from that server to include a Partial IV and to be successfully verified with the used Security Context. Note that, when a new Security Context is established in the group, the client sets the Response Number of each associated server as not initialized (see <a href="#new-sec-context" class="auto internal xref">Section 2.6.3.2</a>), hence later responses within the same long exchange and protected with the new Security Context will result in a new initialization of Response Numbers. Furthermore, for every long exchange, a client <span class="bcp14">MUST</span> only accept at most one response without Partial IV from each server, and treat it as the oldest response from that server within that long exchange.<a href="#section-6.3.1-6" class="pilcrow">¶</a></p>
<p id="section-6.3.1-7">During a long exchange, a client receiving a response containing a Partial IV <span class="bcp14">SHALL</span> compare the Partial IV with the Response Number associated with the replying server within that long exchange. The client <span class="bcp14">MUST</span> stop processing a response from a server, if that response has a Partial IV that has been previously received from that server during that long exchange, while using the same Security Context. Applications <span class="bcp14">MAY</span> decide that a client only processes responses within a long exchange if those have a greater Partial IV than the Response Number associated with the replying server within that long exchange.<a href="#section-6.3.1-7" class="pilcrow">¶</a></p>
<p id="section-6.3.1-8">If the verification of the response succeeds, and the received Partial IV (when included) was greater than the Response Number associated with the replying server, then the client <span class="bcp14">SHALL</span> overwrite that Response Number with the received Partial IV.<a href="#section-6.3.1-8" class="pilcrow">¶</a></p>
<p id="section-6.3.1-9">As long as a server uses the same Security Context to protect its responses to the same request, the client <span class="bcp14">MUST</span> consider the response with the highest Partial IV as the freshest response from that server among those protected with that Security Context, regardless of the order of arrival. Within a long exchange, implementations need to make sure that a response without Partial IV is considered the oldest response from the replying server within that long exchange.<a href="#section-6.3.1-9" class="pilcrow">¶</a></p>
<p id="section-6.3.1-10">The method defined in this section is not relevant for responses to requests that are neither group requests nor Observe requests. In fact, for each of such requests, there is at most one response and only from one, individually targeted server in the group.<a href="#section-6.3.1-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-message-reception">
<section id="section-7">
      <h2 id="name-message-reception">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-message-reception" class="section-name selfRef">Message Reception</a>
      </h2>
<p id="section-7-1">Upon receiving a protected message, a recipient endpoint retrieves a Security Context as in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. An endpoint <span class="bcp14">MUST</span> be able to distinguish between a Security Context to process OSCORE messages as in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> and a Group OSCORE Security Context to process Group OSCORE messages as defined in this document.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">To this end, an endpoint can take into account the different structure of the Security Context defined in <a href="#sec-context" class="auto internal xref">Section 2</a>, for example based on the presence of Signature Algorithm and Pairwise Key Agreement Algorithm in the Common Context. Alternatively, implementations can use an additional parameter in the Security Context, to explicitly mark that it is intended for processing Group OSCORE messages.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">If either of the following conditions holds, a recipient endpoint <span class="bcp14">MUST</span> discard the incoming protected message:<a href="#section-7-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-4.1">
          <p id="section-7-4.1.1">The Group Flag is set to 0 and the retrieved Security Context is associated with an OSCORE group, but the endpoint does not support the pairwise mode or any of the following algorithms is not set in the Security Context: the AEAD Algorithm and the Pairwise Key Agreement Algorithm.<a href="#section-7-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-4.2">
          <p id="section-7-4.2.1">The Group Flag is set to 1 and the retrieved Security Context is associated with an OSCORE group, but the endpoint does not support the group mode or any of the following algorithms is not set in the Security Context: the Group Encryption Algorithm and the Signature Algorithm.<a href="#section-7-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-4.3">
          <p id="section-7-4.3.1">The Group Flag is set to 1 but there is no Security Context associated with an OSCORE group.<a href="#section-7-4.3.1" class="pilcrow">¶</a></p>
<p id="section-7-4.3.2">
Future specifications may define how to process incoming messages protected with Security Contexts as in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, when the Group Flag bit is set to 1.<a href="#section-7-4.3.2" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-5">Otherwise, if a Security Context associated with an OSCORE group is retrieved, the recipient endpoint processes the message with Group OSCORE, using the group mode (see <a href="#mess-processing" class="auto internal xref">Section 8</a>) if the Group Flag is set to 1, or the pairwise mode (see <a href="#sec-pairwise-protection" class="auto internal xref">Section 9</a>) if the Group Flag is set to 0.<a href="#section-7-5" class="pilcrow">¶</a></p>
<p id="section-7-6">Note that, if the Group Flag is set to 0, and the recipient endpoint retrieves a Security Context which is valid to process the message but is not associated with an OSCORE group, then the message is processed according to <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-7-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mess-processing">
<section id="section-8">
      <h2 id="name-message-processing-in-group">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-message-processing-in-group" class="section-name selfRef">Message Processing in Group Mode</a>
      </h2>
<p id="section-8-1">When using the group mode, messages are protected and processed as specified in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the modifications described in this section. The security objectives of the group mode are discussed in <a href="#ssec-sec-objectives" class="auto internal xref">Appendix A.2</a>.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">The possible use of the group mode is indicated by the Group Manager as part of the group data provided to candidate group members when joining the group, according to which the parameters Group Encryption Algorithm and Signature Algorithm in the Security Context are set (see <a href="#sec-context" class="auto internal xref">Section 2</a>).<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">During all the steps of the message processing, an endpoint <span class="bcp14">MUST</span> use the same Security Context for the considered group. That is, an endpoint <span class="bcp14">MUST NOT</span> install a new Security Context for that group (see <a href="#new-sec-context" class="auto internal xref">Section 2.6.3.2</a>) until the message processing is completed.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">The group mode <span class="bcp14">SHOULD</span> be used to protect group requests intended for multiple recipients or for the whole group. For an example where this is not fulfilled, see <span>[<a href="#I-D.amsuess-core-cachable-oscore" class="cite xref">I-D.amsuess-core-cachable-oscore</a>]</span>. This applies to both requests directly addressed to multiple recipients, e.g., sent by the client over multicast, as well as requests sent by the client over unicast to a proxy, that forwards them to the intended recipients over multicast <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">As per <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span><span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, group requests sent over multicast <span class="bcp14">MUST</span> be Non-confirmable, and thus are not retransmitted by the CoAP messaging layer. Instead, applications should store such outgoing messages for a predefined, sufficient amount of time, in order to correctly perform potential retransmissions at the application layer. If performed, these retransmissions are repetitions of previous protected messages, which the sender endpoint does not protect again with Group OSCORE.<a href="#section-8-5" class="pilcrow">¶</a></p>
<p id="section-8-6">According to <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.2.3" class="relref">Section 5.2.3</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, responses to Non-confirmable group requests <span class="bcp14">SHOULD</span> also be Non-confirmable, but endpoints <span class="bcp14">MUST</span> be prepared to receive Confirmable responses in reply to a Non-confirmable group request. Confirmable group requests are acknowledged when sent over non-multicast transports, as specified in <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>.<a href="#section-8-6" class="pilcrow">¶</a></p>
<p id="section-8-7">Furthermore, endpoints in the group locally perform error handling and processing of invalid messages according to the same principles adopted in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. In addition, a recipient <span class="bcp14">MUST</span> stop processing and reject any message that is malformed and that does not follow the format specified in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> of this document, or that is not cryptographically validated in a successful way as per the processing defined in <a href="#ssec-verify-request" class="auto internal xref">Section 8.2</a> and <a href="#ssec-verify-response" class="auto internal xref">Section 8.4</a> of this document.<a href="#section-8-7" class="pilcrow">¶</a></p>
<p id="section-8-8">In either case, it is <span class="bcp14">RECOMMENDED</span> that a server does not send back any error message in reply to a received request, if any of the two following conditions holds:<a href="#section-8-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-9.1">
          <p id="section-8-9.1.1">The server is not able to identify the received request as a group request, i.e., as sent to all servers in the group.<a href="#section-8-9.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-9.2">
          <p id="section-8-9.2.1">The server identifies the received request as a group request.<a href="#section-8-9.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-8-10">This prevents servers from replying with multiple error messages to a client sending a group request, so avoiding the risk of flooding and possibly congesting the network.<a href="#section-8-10" class="pilcrow">¶</a></p>
<div id="ssec-protect-request">
<section id="section-8.1">
        <h3 id="name-protecting-the-request">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-protecting-the-request" class="section-name selfRef">Protecting the Request</a>
        </h3>
<p id="section-8.1-1">When using the group mode to protect a request, a client <span class="bcp14">SHALL</span> proceed as described in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.1" class="relref">Section 8.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the following modifications.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-2.1">
            <p id="section-8.1-2.1.1">In step 2, the Additional Authenticated Data is modified as described in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> of this document.<a href="#section-8.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.2">
            <p id="section-8.1-2.2.1">In step 4, the encryption of the COSE object is modified as described in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> of this document. The encoding of the compressed COSE object is modified as described in <a href="#compression" class="auto internal xref">Section 5</a> of this document. In particular, the Group Flag <span class="bcp14">MUST</span> be set to 1. The Group Encryption Algorithm from the Common Context <span class="bcp14">MUST</span> be used.<a href="#section-8.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.3">
            <p id="section-8.1-2.3.1">In step 5, the countersignature is computed and the format of the OSCORE message is modified as described in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> and <a href="#compression" class="auto internal xref">Section 5</a> of this document. In particular, the payload of the Group OSCORE message includes also the encrypted countersignature.<a href="#section-8.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.1-3">In addition, the following applies when sending a request that establishes a long exchange.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-4.1">
            <p id="section-8.1-4.1.1">If the client intends to keep the long exchange active beyond a possible change of Sender ID, the client <span class="bcp14">MUST</span> store the value of the 'kid' parameter from the request, and retain it until the long exchange is terminated. Even in case the client is individually rekeyed and receives a new Sender ID from the Group Manager (see <a href="#new-sender-id" class="auto internal xref">Section 2.6.3.1</a>), the client <span class="bcp14">MUST NOT</span> update the stored 'kid' parameter value associated with the long exchange and the corresponding request.<a href="#section-8.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-4.2">
            <p id="section-8.1-4.2.1">If the client intends to keep the long exchange active beyond a possible change of ID Context following a group rekeying (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>), then the following applies.<a href="#section-8.1-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-4.2.2.1">
                <p id="section-8.1-4.2.2.1.1">The client <span class="bcp14">MUST</span> store the value of the 'kid context' parameter from the request, and retain it until the long exchange is terminated. Upon establishing a new Security Context with a new Gid as ID Context (see <a href="#new-sec-context" class="auto internal xref">Section 2.6.3.2</a>), the client <span class="bcp14">MUST NOT</span> update the stored 'kid context' parameter value associated with the long exchange and the corresponding request.<a href="#section-8.1-4.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.1-4.2.2.2">
                <p id="section-8.1-4.2.2.2.1">The client <span class="bcp14">MUST</span> store an invariant identifier of the group, which is immutable even in case the Security Context of the group is re-established.  For example, this invariant identifier can be the "group name" in <span>[<a href="#I-D.ietf-ace-key-groupcomm-oscore" class="cite xref">I-D.ietf-ace-key-groupcomm-oscore</a>]</span>, where it is used for joining the group and retrieving the current group keying material from the Group Manager.<a href="#section-8.1-4.2.2.2.1" class="pilcrow">¶</a></p>
<p id="section-8.1-4.2.2.2.2">
After a group rekeying, such an invariant information makes it simpler for the client to retrieve the current group keying material from the Group Manager, in case the client has missed both the rekeying messages and the first response protected with the new Security Context (see <a href="#ssec-protect-response" class="auto internal xref">Section 8.3</a>).<a href="#section-8.1-4.2.2.2.2" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
<div id="ssec-verify-request">
<section id="section-8.2">
        <h3 id="name-verifying-the-request">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-verifying-the-request" class="section-name selfRef">Verifying the Request</a>
        </h3>
<p id="section-8.2-1">Upon receiving a protected request with the Group Flag set to 1, following the procedure in <a href="#sec-message-reception" class="auto internal xref">Section 7</a>, a server <span class="bcp14">SHALL</span> proceed as described in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.2" class="relref">Section 8.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the following modifications.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.1">
            <p id="section-8.2-2.1.1">In step 2, the decoding of the compressed COSE object follows <a href="#compression" class="auto internal xref">Section 5</a> of this document. In particular:<a href="#section-8.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.1.2.1">
                <p id="section-8.2-2.1.2.1.1">If the server discards the request due to not retrieving a Security Context associated with the OSCORE group, the server <span class="bcp14">MAY</span> respond with a 4.01 (Unauthorized) error message. When doing so, the server <span class="bcp14">MAY</span> set an Outer Max-Age Option with value zero, and <span class="bcp14">MAY</span> include a descriptive string as diagnostic payload.<a href="#section-8.2-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.2-2.1.2.2">
                <p id="section-8.2-2.1.2.2.1">If the received 'kid context' matches an existing ID Context (Gid) but the received 'kid' does not match any Recipient ID in this Security Context, then the server <span class="bcp14">MAY</span> create a new Recipient Context for this Recipient ID and initialize it according to <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3" class="relref">Section 3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, and also retrieve the authentication credential associated with the Recipient ID to be stored in the new Recipient Context. Such a configuration is application specific. If the application does not specify dynamic derivation of new Recipient Contexts, then the server <span class="bcp14">SHALL</span> stop processing the request.<a href="#section-8.2-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-8.2-2.2">
            <p id="section-8.2-2.2.1">In step 4, the Additional Authenticated Data is modified as described in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> of this document.<a href="#section-8.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-2.3">
            <p id="section-8.2-2.3.1">In step 6, the server also verifies the countersignature, by using the public key from the client's authentication credential stored in the associated Recipient Context. In particular:<a href="#section-8.2-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.3.2.1">
                <p id="section-8.2-2.3.2.1.1">If the server does not have the public key of the client yet, the server <span class="bcp14">MUST</span> stop processing the request and <span class="bcp14">MAY</span> respond with a 5.03 (Service Unavailable) response. The response <span class="bcp14">MAY</span> include a Max-Age Option, indicating to the client the number of seconds after which to retry. If the Max-Age Option is not present, a retry time of 60 seconds will be assumed by the client, as default value defined in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.10.5" class="relref">Section 5.10.5</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>.<a href="#section-8.2-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.2-2.3.2.2">
                <p id="section-8.2-2.3.2.2.1">The server <span class="bcp14">MUST</span> perform signature verification before decrypting the COSE object, as defined below. Implementations that cannot perform the two steps in this order <span class="bcp14">MUST</span> ensure that no access to the plaintext is possible before a successful signature verification and <span class="bcp14">MUST</span> prevent any possible leak of time-related information that can yield side-channel attacks.<a href="#section-8.2-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.2-2.3.2.3">
                <p id="section-8.2-2.3.2.3.1">The server retrieves the encrypted countersignature ENC_SIGNATURE from the message payload, and computes the original countersignature SIGNATURE as<a href="#section-8.2-2.3.2.3.1" class="pilcrow">¶</a></p>
<p id="section-8.2-2.3.2.3.2">
SIGNATURE = ENC_SIGNATURE XOR KEYSTREAM<a href="#section-8.2-2.3.2.3.2" class="pilcrow">¶</a></p>
<p id="section-8.2-2.3.2.3.3">
where KEYSTREAM is derived as per <a href="#sssec-encrypted-signature-keystream" class="auto internal xref">Section 5.1</a>.<a href="#section-8.2-2.3.2.3.3" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.2-2.3.2.4">
                <p id="section-8.2-2.3.2.4.1">The server verifies the original countersignature SIGNATURE as described in Sections <a href="https://rfc-editor.org/rfc/rfc9338#section-3.2" class="relref">3.2</a> and <a href="https://rfc-editor.org/rfc/rfc9338#section-3.3" class="relref">3.3</a> of <span>[<a href="#RFC9338" class="cite xref">RFC9338</a>]</span>, by using the client's public key and according to the Signature Algorithm in the Security Context.<a href="#section-8.2-2.3.2.4.1" class="pilcrow">¶</a></p>
<p id="section-8.2-2.3.2.4.2">
In particular, the Countersign_structure contains the context text string "CounterSignature0", the external_aad as defined in <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a> of this document, and the ciphertext of the COSE object as payload.<a href="#section-8.2-2.3.2.4.2" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.2-2.3.2.5">
                <p id="section-8.2-2.3.2.5.1">If the signature verification fails, the server <span class="bcp14">SHALL</span> stop processing the request, <span class="bcp14">SHALL NOT</span> update the Replay Window, and <span class="bcp14">MAY</span> respond with a 4.00 (Bad Request) response. Such a response <span class="bcp14">MAY</span> include an Outer Max-Age Option with value zero, and its diagnostic payload <span class="bcp14">MAY</span> contain a string, which, if present, <span class="bcp14">MUST</span> be "Decryption failed" as if the decryption of the COSE object had failed.<a href="#section-8.2-2.3.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.2-2.3.2.6">
                <p id="section-8.2-2.3.2.6.1">When decrypting the COSE object using the Recipient Key, the Group Encryption Algorithm from the Common Context <span class="bcp14">MUST</span> be used.<a href="#section-8.2-2.3.2.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-8.2-2.4">
            <p id="section-8.2-2.4.1">Additionally, if the used Recipient Context was created upon receiving this request and the message is not verified successfully, the server <span class="bcp14">MAY</span> delete that Recipient Context. Such a configuration, which is specified by the application, mitigates attacks that aim at overloading the server's storage.<a href="#section-8.2-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.2-3">A server <span class="bcp14">SHOULD NOT</span> process a request if the received Recipient ID ('kid') is equal to its own Sender ID in its own Sender Context. For an example where this is not fulfilled, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-observe-multicast-notifications-09#section-9.2.1" class="relref">Section 9.2.1</a> of [<a href="#I-D.ietf-core-observe-multicast-notifications" class="cite xref">I-D.ietf-core-observe-multicast-notifications</a>]</span>.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<p id="section-8.2-4">In addition, the following applies if the request establishes a long exchange and the server intends to reply with multiple responses.<a href="#section-8.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-5.1">
            <p id="section-8.2-5.1.1">The server <span class="bcp14">MUST</span> store the value of the 'kid' parameter from the request, and retain it until the last response has been sent. The server <span class="bcp14">MUST NOT</span> update the stored value of the 'kid' parameter associated with the request, even in case the client is individually rekeyed and starts using a new Sender ID received from the Group Manager (see <a href="#new-sender-id" class="auto internal xref">Section 2.6.3.1</a>).<a href="#section-8.2-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-5.2">
            <p id="section-8.2-5.2.1">The server <span class="bcp14">MUST</span> store the value of the 'kid context' parameter from the request, and retain it until the last response has been sent, i.e., beyond a possible change of ID Context following a group rekeying (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>). That is, upon establishing a new Security Context with a new Gid as ID Context (see <a href="#new-sec-context" class="auto internal xref">Section 2.6.3.2</a>), the server <span class="bcp14">MUST NOT</span> update the stored value of a 'kid context' parameter associated with the request.<a href="#section-8.2-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="ssec-protect-response">
<section id="section-8.3">
        <h3 id="name-protecting-the-response">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-protecting-the-response" class="section-name selfRef">Protecting the Response</a>
        </h3>
<p id="section-8.3-1">When using the group mode to protect a response, a server <span class="bcp14">SHALL</span> proceed as described in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.3" class="relref">Section 8.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the following modifications.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">Note that the server always protects a response with the Sender Context from its latest Security Context, and that establishing a new Security Context resets the Sender Sequence Number to 0 (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.3-3.1">
            <p id="section-8.3-3.1.1">In step 2, the Additional Authenticated Data is modified as described in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> of this document.<a href="#section-8.3-3.1.1" class="pilcrow">¶</a></p>
<p id="section-8.3-3.1.2">
In addition, the following applies if the server intends to reply with multiple responses, within the long exchange established by the corresponding request.<a href="#section-8.3-3.1.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.3-3.1.3.1">
                <p id="section-8.3-3.1.3.1.1">The server <span class="bcp14">MUST</span> use the stored value of the 'kid' parameter from the request (see <a href="#ssec-verify-request" class="auto internal xref">Section 8.2</a>), as value for the 'request_kid' parameter in the external_aad structure (see <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a>).<a href="#section-8.3-3.1.3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.3-3.1.3.2">
                <p id="section-8.3-3.1.3.2.1">The server <span class="bcp14">MUST</span> use the stored value of the 'kid context' parameter from the request (see <a href="#ssec-verify-request" class="auto internal xref">Section 8.2</a>), as value for the 'request_kid_context' parameter in the external_aad structure (see <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a>).<a href="#section-8.3-3.1.3.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-8.3-3.2">
            <p id="section-8.3-3.2.1">In step 3, if any of the following two conditions holds, the server <span class="bcp14">MUST</span> include its Sender Sequence Number as Partial IV in the response and use it to build the AEAD nonce to protect the response. This prevents the server from reusing the AEAD nonce from the request together with the same encryption key.<a href="#section-8.3-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.3-3.2.2.1">
                <p id="section-8.3-3.2.2.1.1">The response is not the first response that the server sends to the request.<a href="#section-8.3-3.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.3-3.2.2.2">
                <p id="section-8.3-3.2.2.2.1">The server is using a different Security Context for the response compared to what was used to verify the request (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#section-8.3-3.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-8.3-3.3">
            <p id="section-8.3-3.3.1">In step 4, the encryption of the COSE object is modified as described in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> of this document. The encoding of the compressed COSE object is modified as described in <a href="#compression" class="auto internal xref">Section 5</a> of this document. In particular, the Group Flag <span class="bcp14">MUST</span> be set to 1. The Group Encryption Algorithm from the Common Context <span class="bcp14">MUST</span> be used.<a href="#section-8.3-3.3.1" class="pilcrow">¶</a></p>
<p id="section-8.3-3.3.2">
In addition, the following applies.<a href="#section-8.3-3.3.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.3-3.3.3.1">
                <p id="section-8.3-3.3.3.1.1">If the server is using a different ID Context (Gid) for the response compared to what was used to verify the request (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>) and this is the first response from the server to that request, then the new ID Context <span class="bcp14">MUST</span> be included in the 'kid context' parameter of the response.<a href="#section-8.3-3.3.3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.3-3.3.3.2">
                <p id="section-8.3-3.3.3.2.1">The server may be replying to a request that was protected with an old Security Context. After completing the establishment of a new Security Context, the server <span class="bcp14">MUST</span> protect all the responses to that request with the Sender Context of the new Security Context.<a href="#section-8.3-3.3.3.2.1" class="pilcrow">¶</a></p>
<p id="section-8.3-3.3.3.2.2">
For each ongoing long exchange, the server can help the client to synchronize, by including also the 'kid context' parameter in responses following a group rekeying, with value set to the ID Context (Gid) of the new Security Context.<a href="#section-8.3-3.3.3.2.2" class="pilcrow">¶</a></p>
<p id="section-8.3-3.3.3.2.3">
If there is a known upper limit to the duration of a group rekeying, the server <span class="bcp14">SHOULD</span> include the 'kid context' parameter during that time. Otherwise, the server <span class="bcp14">SHOULD</span> include it until the Max-Age has expired for the last response sent before the installation of the new Security Context.<a href="#section-8.3-3.3.3.2.3" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.3-3.3.3.3">
                <p id="section-8.3-3.3.3.3.1">The server can obtain a new Sender ID from the Group Manager, when individually rekeyed (see <a href="#new-sender-id" class="auto internal xref">Section 2.6.3.1</a>) or when re-joining the group. In such a case, the server can help the client to synchronize, by including the 'kid' parameter in a response protected in group mode, even when the request was protected in pairwise mode (see <a href="#sec-pairwise-protection-req" class="auto internal xref">Section 9.3</a>).<a href="#section-8.3-3.3.3.3.1" class="pilcrow">¶</a></p>
<p id="section-8.3-3.3.3.3.2">
That is, when responding to a request protected in pairwise mode, the server <span class="bcp14">SHOULD</span> include the 'kid' parameter in a response protected in group mode, if it is replying to that client for the first time since the assignment of its new Sender ID.<a href="#section-8.3-3.3.3.3.2" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-8.3-3.4">
            <p id="section-8.3-3.4.1">In step 5, the countersignature is computed and the format of the OSCORE message is modified as described in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> and <a href="#compression" class="auto internal xref">Section 5</a> of this document. In particular the payload of the Group OSCORE message includes also the encrypted countersignature (see <a href="#compression" class="auto internal xref">Section 5</a>).<a href="#section-8.3-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="ssec-verify-response">
<section id="section-8.4">
        <h3 id="name-verifying-the-response">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-verifying-the-response" class="section-name selfRef">Verifying the Response</a>
        </h3>
<p id="section-8.4-1">Upon receiving a protected response with the Group Flag set to 1, following the procedure in <a href="#sec-message-reception" class="auto internal xref">Section 7</a>, a client <span class="bcp14">SHALL</span> proceed as described in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.4" class="relref">Section 8.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the modifications described in this section.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">Note that a client may receive a response protected with a Security Context different from the one used to protect the corresponding request, and that, upon the establishment of a new Security Context, the client re-initializes its Replay Windows in its Recipient Contexts (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#section-8.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.4-3.1">
            <p id="section-8.4-3.1.1">In step 2, the decoding of the compressed COSE object is modified as described in <a href="#compression" class="auto internal xref">Section 5</a> of this document. In particular, a 'kid' may not be present, if the response is a reply to a request protected in pairwise mode. In such a case, the client assumes the response 'kid' to be the Recipient ID for the server to which the request protected in pairwise mode was intended for.<a href="#section-8.4-3.1.1" class="pilcrow">¶</a></p>
<p id="section-8.4-3.1.2">
If the response 'kid context' matches an existing ID Context (Gid) but the received/assumed 'kid' does not match any Recipient ID in this Security Context, then the client <span class="bcp14">MAY</span> create a new Recipient Context for this Recipient ID and initialize it according to <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3" class="relref">Section 3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, and also retrieve the authentication credential associated with the Recipient ID to be stored in the new Recipient Context. If the application does not specify dynamic derivation of new Recipient Contexts, then the client <span class="bcp14">SHALL</span> stop processing the response.<a href="#section-8.4-3.1.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.4-3.2">
            <p id="section-8.4-3.2.1">In step 3, the Additional Authenticated Data is modified as described in <a href="#sec-cose-object" class="auto internal xref">Section 4</a> of this document.<a href="#section-8.4-3.2.1" class="pilcrow">¶</a></p>
<p id="section-8.4-3.2.2">
In addition, the following applies if the client processes a response to a request within a long exchange.<a href="#section-8.4-3.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.4-3.2.3.1">
                <p id="section-8.4-3.2.3.1.1">The client <span class="bcp14">MUST</span> use the stored value of the 'kid' parameter from the request (see <a href="#ssec-protect-request" class="auto internal xref">Section 8.1</a>), as value for the 'request_kid' parameter in the external_aad structure (see <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a>).<a href="#section-8.4-3.2.3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.4-3.2.3.2">
                <p id="section-8.4-3.2.3.2.1">The client <span class="bcp14">MUST</span> use the stored value of the 'kid context' parameter from the request (see <a href="#ssec-protect-request" class="auto internal xref">Section 8.1</a>), as value for the 'request_kid_context' parameter in the external_aad structure (see <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a>).<a href="#section-8.4-3.2.3.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-8.4-3.2.4">
This ensures that, throughout a long exchange, the client can correctly verify the received responses, even in case the client is individually rekeyed and starts using a new Sender ID received from the Group Manager (see <a href="#new-sender-id" class="auto internal xref">Section 2.6.3.1</a>), as well as when it installs a new Security Context with a new ID Context (Gid) following a group rekeying (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#section-8.4-3.2.4" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.4-3.3">
            <p id="section-8.4-3.3.1">In step 5, the client also verifies the countersignature, by using the public key from the server's authentication credential stored in the associated Recipient Context. In particular:<a href="#section-8.4-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.4-3.3.2.1">
                <p id="section-8.4-3.3.2.1.1">The client <span class="bcp14">MUST</span> perform signature verification as defined below, before decrypting the COSE object. Implementations that cannot perform the two steps in this order <span class="bcp14">MUST</span> ensure that no access to the plaintext is possible before a successful signature verification and <span class="bcp14">MUST</span> prevent any possible leak of time-related information that can yield side-channel attacks.<a href="#section-8.4-3.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.4-3.3.2.2">
                <p id="section-8.4-3.3.2.2.1">The client retrieves the encrypted countersignature ENC_SIGNATURE from the message payload, and computes the original countersignature SIGNATURE as<a href="#section-8.4-3.3.2.2.1" class="pilcrow">¶</a></p>
<p id="section-8.4-3.3.2.2.2">
SIGNATURE = ENC_SIGNATURE XOR KEYSTREAM<a href="#section-8.4-3.3.2.2.2" class="pilcrow">¶</a></p>
<p id="section-8.4-3.3.2.2.3">
where KEYSTREAM is derived as per <a href="#sssec-encrypted-signature-keystream" class="auto internal xref">Section 5.1</a>.<a href="#section-8.4-3.3.2.2.3" class="pilcrow">¶</a></p>
<p id="section-8.4-3.3.2.2.4">
The client verifies the original countersignature SIGNATURE.<a href="#section-8.4-3.3.2.2.4" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.4-3.3.2.3">
                <p id="section-8.4-3.3.2.3.1">If the verification of the countersignature fails, the client: i) <span class="bcp14">SHALL</span> stop processing the response; and ii) <span class="bcp14">SHALL NOT</span> update the Response Number associated with the server.<a href="#section-8.4-3.3.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.4-3.3.2.4">
                <p id="section-8.4-3.3.2.4.1">After a successful verification of the countersignature, the client performs also the following actions in case the request was protected in pairwise mode (see <a href="#sec-pairwise-protection-req" class="auto internal xref">Section 9.3</a>).<a href="#section-8.4-3.3.2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.4-3.3.2.4.2.1">
                    <p id="section-8.4-3.3.2.4.2.1.1">If the 'kid' parameter is present in the response, the client checks whether this received 'kid' is equal to the expected 'kid', i.e., the known Recipient ID for the server to which the request was intended for.<a href="#section-8.4-3.3.2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-8.4-3.3.2.4.2.2">
                    <p id="section-8.4-3.3.2.4.2.2.1">If the 'kid' parameter is not present in the response, the client checks whether the server that has sent the response is the same one to which the request was intended for. This can be done by checking that the public key used to verify the countersignature of the response is equal to the public key included in the authentication credential Recipient Auth Cred, which was taken as input to derive the Pairwise Sender Key used for protecting the request (see <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a>).<a href="#section-8.4-3.3.2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
<p id="section-8.4-3.3.2.4.3">
In either case, if the client determines that the response has come from a different server than the expected one, then the client: i) <span class="bcp14">SHALL</span> discard the response and <span class="bcp14">SHALL NOT</span> deliver it to the application; ii) <span class="bcp14">SHALL NOT</span> update the Response Number associated with the server.<a href="#section-8.4-3.3.2.4.3" class="pilcrow">¶</a></p>
<p id="section-8.4-3.3.2.4.4">
Otherwise, the client hereafter considers the received 'kid' as the current Recipient ID for the server.<a href="#section-8.4-3.3.2.4.4" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-8.4-3.4">
            <p id="section-8.4-3.4.1">In step 5, when decrypting the COSE object using the Recipient Key, the Group Encryption Algorithm from the Common Context <span class="bcp14">MUST</span> be used.<a href="#section-8.4-3.4.1" class="pilcrow">¶</a></p>
<p id="section-8.4-3.4.2">
In addition, the client performs the following actions if the response is received within a long exchange.<a href="#section-8.4-3.4.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.4-3.4.3.1">
                <p id="section-8.4-3.4.3.1.1">The ordering and the replay protection of responses received from the server during the long exchange are performed as per <a href="#sec-replay-protection-responses" class="auto internal xref">Section 6.3.1</a> of this document, by using the Response Number associated with that server within that long exchange. In case of unsuccessful decryption and verification of a response, the client <span class="bcp14">SHALL NOT</span> update the Response Number associated with the server.<a href="#section-8.4-3.4.3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.4-3.4.3.2">
                <p id="section-8.4-3.4.3.2.1">When receiving the first valid response from the server within the long exchange, the client <span class="bcp14">MUST</span> store the kid "kid1" of that server for that long exchange. If the 'kid' field is included in the OSCORE Option of the response, its value specifies "kid1". If the request was protected in pairwise mode (see <a href="#sec-pairwise-protection-req" class="auto internal xref">Section 9.3</a>), the 'kid' field may not be present in the OSCORE Option of the response (see <a href="#sec-cose-object-kid" class="auto internal xref">Section 4.2</a>). In this case, the client assumes "kid1" to be the Recipient ID for the server to which the request was intended for.<a href="#section-8.4-3.4.3.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-8.4-3.4.3.3">
                <p id="section-8.4-3.4.3.3.1">When receiving another valid response to the same request from the same server - which can be identified and recognized through the same public key used to verify the countersignature and included in the server's authentication credential - the client determines the kid "kid2" of the server as above for "kid1", and <span class="bcp14">MUST</span> check whether "kid2" is equal to the stored "kid1".<a href="#section-8.4-3.4.3.3.1" class="pilcrow">¶</a></p>
<p id="section-8.4-3.4.3.3.2">
If "kid1" and "kid2" are different, the client <span class="bcp14">SHOULD NOT</span> accept the response as valid to be delivered to the application, and <span class="bcp14">SHOULD NOT</span> update the Response Number associated with the server. Exceptions can apply as the client can retain the information required to order the responses, or if the client application does not require response ordering altogether. Servers <span class="bcp14">MUST NOT</span> rely on clients tolerating this, unless it was explicitly agreed on (e.g., as part of the group's setup).<a href="#section-8.4-3.4.3.3.2" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-8.4-3.4.4">
Note that, if "kid2" is different from "kid1" and the 'kid' field is omitted from the response - which is possible if the request was protected in pairwise mode - then the client will compute a wrong keystream to decrypt the countersignature (i.e., by using "kid1" rather than "kid2" in the 'id' field of the 'info' array in <a href="#sssec-encrypted-signature-keystream" class="auto internal xref">Section 5.1</a>), thus subsequently failing to verify the countersignature and discarding the response.<a href="#section-8.4-3.4.4" class="pilcrow">¶</a></p>
<p id="section-8.4-3.4.5">
This ensures that the client remains able to correctly perform the ordering and replay protection of responses within a long exchange, even in case the server legitimately starts using a new Sender ID, as received from the Group Manager when individually rekeyed (see <a href="#new-sender-id" class="auto internal xref">Section 2.6.3.1</a>) or when re-joining the group.<a href="#section-8.4-3.4.5" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.4-3.5">
            <p id="section-8.4-3.5.1">In step 8, if the used Recipient Context was created upon receiving this response and the message is not verified successfully, the client <span class="bcp14">MAY</span> delete that Recipient Context. Such a configuration, which is specified by the application, mitigates attacks that aim at overloading the client's storage.<a href="#section-8.4-3.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-processing-signature-checker">
<section id="section-8.5">
        <h3 id="name-external-signature-checkers">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-external-signature-checkers" class="section-name selfRef">External Signature Checkers</a>
        </h3>
<p id="section-8.5-1">When receiving a message protected in group mode, a signature checker (see <a href="#sec-additional-entities" class="auto internal xref">Section 3.3</a>) proceeds as follows.<a href="#section-8.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.5-2.1">
            <p id="section-8.5-2.1.1">The signature checker retrieves the encrypted countersignature ENC_SIGNATURE from the message payload, and computes the original countersignature SIGNATURE as<a href="#section-8.5-2.1.1" class="pilcrow">¶</a></p>
<p id="section-8.5-2.1.2">
SIGNATURE = ENC_SIGNATURE XOR KEYSTREAM<a href="#section-8.5-2.1.2" class="pilcrow">¶</a></p>
<p id="section-8.5-2.1.3">
where KEYSTREAM is derived as per <a href="#sssec-encrypted-signature-keystream" class="auto internal xref">Section 5.1</a>.<a href="#section-8.5-2.1.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.5-2.2">
            <p id="section-8.5-2.2.1">The signature checker verifies the original countersignature SIGNATURE, by using the public key of the sender endpoint as included in that endpoint's authentication credential. The signature checker determines the right authentication credential based on the ID Context (Gid) and the Sender ID of the sender endpoint.<a href="#section-8.5-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.5-3">Note that the following applies when attempting to verify the countersignature of a response message.<a href="#section-8.5-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.5-4.1">
            <p id="section-8.5-4.1.1">The response may not include a Partial IV and/or an ID Context. In such a case, the signature checker considers the same values from the corresponding request, i.e., the request matching with the response by CoAP Token value.<a href="#section-8.5-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.5-4.2">
            <p id="section-8.5-4.2.1">The response may not include a Sender ID. This can happen when the response protected in group mode matches a request protected in pairwise mode (see <a href="#ssec-pre-conditions" class="auto internal xref">Section 9.1</a>), with a case in point provided by <span>[<a href="#I-D.amsuess-core-cachable-oscore" class="cite xref">I-D.amsuess-core-cachable-oscore</a>]</span>. In such a case, the signature checker needs to use other means (e.g., source addressing information of the server endpoint) to identify the correct authentication credential including the public key to use for verifying the countersignature of the response.<a href="#section-8.5-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.5-5">The particular actions following a successful or unsuccessful verification of the countersignature are application specific and out of the scope of this document.<a href="#section-8.5-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-pairwise-protection">
<section id="section-9">
      <h2 id="name-message-processing-in-pairw">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-message-processing-in-pairw" class="section-name selfRef">Message Processing in Pairwise Mode</a>
      </h2>
<p id="section-9-1">When using the pairwise mode of Group OSCORE, messages are protected and processed as in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the modifications described in this section. The security objectives of the pairwise mode are discussed in <a href="#ssec-sec-objectives" class="auto internal xref">Appendix A.2</a>.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">The possible use of the pairwise mode is indicated by the Group Manager as part of the group data provided to candidate group members when joining the group, according to which the parameters AEAD Algorithm and Pairwise Key Agreement Algorithm in the Security Context are set (see <a href="#sec-context" class="auto internal xref">Section 2</a>).<a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">The pairwise mode takes advantage of an existing Security Context to establish keying material shared exclusively with any other member. For encryption and decryption operations in pairwise mode, the AEAD Algorithm from the Common Context is used (see <a href="#ssec-common-context-aead-alg" class="auto internal xref">Section 2.1.1</a>).<a href="#section-9-3" class="pilcrow">¶</a></p>
<p id="section-9-4">In order to use the pairwise mode in a group where the group mode is also used (i.e., Group Encryption Algorithm and Signature Algorithm in the Security Context are set), the signature scheme of the group mode <span class="bcp14">MUST</span> support a combined signature and encryption scheme. For example, this can rely on signing operations using ECDSA, and encryption operations using AES-CCM with keying material derived through ECDH.<a href="#section-9-4" class="pilcrow">¶</a></p>
<p id="section-9-5">The pairwise mode does not support external verifiers of source authentication and message integrity like the group mode does (see <a href="#sec-processing-signature-checker" class="auto internal xref">Section 8.5</a>).<a href="#section-9-5" class="pilcrow">¶</a></p>
<p id="section-9-6">An endpoint implementing only a silent server does not support the pairwise mode.<a href="#section-9-6" class="pilcrow">¶</a></p>
<p id="section-9-7">Endpoints using the CoAP Echo Option <span>[<a href="#RFC9175" class="cite xref">RFC9175</a>]</span> in a group where the AEAD Algorithm and Pairwise Key Agreement Algorithm are set <span class="bcp14">MUST</span> support the pairwise mode. This prevents the attack described in <a href="#ssec-unicast-requests" class="auto internal xref">Section 13.9</a>, which leverages requests sent over unicast to a single group member and protected in group mode.<a href="#section-9-7" class="pilcrow">¶</a></p>
<p id="section-9-8">The pairwise mode cannot be used to protect messages intended for multiple recipients. In fact, the keying material used for the pairwise mode is shared only between two endpoints.<a href="#section-9-8" class="pilcrow">¶</a></p>
<p id="section-9-9">However, a sender can use the pairwise mode to protect a message sent to (but not intended for) multiple recipients, if interested in a response from only one of them. For instance, this is useful to support the address discovery service defined in <a href="#ssec-pre-conditions" class="auto internal xref">Section 9.1</a>, when a single 'kid' value is indicated in the payload of a request sent to multiple recipients, e.g., over multicast.<a href="#section-9-9" class="pilcrow">¶</a></p>
<div id="ssec-pre-conditions">
<section id="section-9.1">
        <h3 id="name-pre-conditions">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-pre-conditions" class="section-name selfRef">Pre-Conditions</a>
        </h3>
<p id="section-9.1-1">In order to protect an outgoing message in pairwise mode, the sender needs to know the authentication credential and the Recipient ID for the recipient endpoint, as stored in the Recipient Context associated with that endpoint (see <a href="#pairwise-implementation" class="auto internal xref">Section 2.5.4</a>).<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">Furthermore, the sender needs to know the individual address of the recipient endpoint. This information may not be known at any given point in time. For instance, right after having joined the group, a client may know the authentication credential and Recipient ID for a given server, but not the addressing information required to reach it with an individual, one-to-one request.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1-3">In order to make addressing information of individual endpoints available, servers in the group <span class="bcp14">MAY</span> expose a resource to which a client can send a request targeting a set of servers, identified by their 'kid' values specified in the request payload, or implicitly if the request is sent in pairwise mode. Further details of such an interface are out of scope for this document.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-differences-oscore-pairwise">
<section id="section-9.2">
        <h3 id="name-main-differences-from-oscor">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-main-differences-from-oscor" class="section-name selfRef">Main Differences from OSCORE</a>
        </h3>
<p id="section-9.2-1">The pairwise mode protects messages between two members of a group, essentially following <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, but with the following notable differences.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2-2.1">
            <p id="section-9.2-2.1.1">The 'kid' and 'kid context' parameters of the COSE object are used as defined in <a href="#sec-cose-object-kid" class="auto internal xref">Section 4.2</a> of this document.<a href="#section-9.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.2-2.2">
            <p id="section-9.2-2.2.1">The external_aad defined in <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a> of this document is used for the encryption and decryption process.<a href="#section-9.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.2-2.3">
            <p id="section-9.2-2.3.1">The Pairwise Sender/Recipient Keys used as Sender/Recipient keys are derived as defined in <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a> of this document.<a href="#section-9.2-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-pairwise-protection-req">
<section id="section-9.3">
        <h3 id="name-protecting-the-request-2">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-protecting-the-request-2" class="section-name selfRef">Protecting the Request</a>
        </h3>
<p id="section-9.3-1">When using the pairwise mode to protect a request, a client <span class="bcp14">SHALL</span> proceed as described in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.1" class="relref">Section 8.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the differences summarized in <a href="#sec-differences-oscore-pairwise" class="auto internal xref">Section 9.2</a> of this document.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">Furthermore, when sending a request that establishes a long exchange, what is specified in <a href="#ssec-protect-request" class="auto internal xref">Section 8.1</a> of this document holds, with respect to storing the value of the 'kid' and 'kid context' parameters, and to storing an invariant identifier of the group.<a href="#section-9.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-pairwise-verify-req">
<section id="section-9.4">
        <h3 id="name-verifying-the-request-2">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-verifying-the-request-2" class="section-name selfRef">Verifying the Request</a>
        </h3>
<p id="section-9.4-1">Upon receiving a protected request with the Group Flag set to 0, following the procedure in <a href="#sec-message-reception" class="auto internal xref">Section 7</a>, a server <span class="bcp14">SHALL</span> proceed as described in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.2" class="relref">Section 8.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the differences summarized in <a href="#sec-differences-oscore-pairwise" class="auto internal xref">Section 9.2</a> of this document. The following differences also apply.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.4-2.1">
            <p id="section-9.4-2.1.1">If the server discards the request due to not retrieving a Security Context associated with the OSCORE group or to not supporting the pairwise mode, the server <span class="bcp14">MAY</span> respond with a 4.01 (Unauthorized) error message or a 4.02 (Bad Option) error message, respectively. When doing so, the server <span class="bcp14">MAY</span> set an Outer Max-Age Option with value zero, and <span class="bcp14">MAY</span> include a descriptive string as diagnostic payload.<a href="#section-9.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.4-2.2">
            <p id="section-9.4-2.2.1">If a new Recipient Context is created for this Recipient ID, new Pairwise Sender/Recipient Keys are also derived (see <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a>). The new Pairwise Sender/Recipient Keys are deleted if the Recipient Context is deleted as a result of the message not being successfully verified.<a href="#section-9.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.4-2.3">
            <p id="section-9.4-2.3.1">What is specified in <a href="#ssec-verify-request" class="auto internal xref">Section 8.2</a> of this document holds with respect to the following points.<a href="#section-9.4-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.4-2.3.2.1">
                <p id="section-9.4-2.3.2.1.1">The possible, dynamic creation and configuration of a Recipient Context upon receiving the request.<a href="#section-9.4-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.4-2.3.2.2">
                <p id="section-9.4-2.3.2.2.1">The possible deletion of a Recipient Context created upon receiving the request, in case the request is not verified successfully.<a href="#section-9.4-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.4-2.3.2.3">
                <p id="section-9.4-2.3.2.3.1">The rule about processing the request where the received Recipient ID ('kid') is equal to the server's Sender ID.<a href="#section-9.4-2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.4-2.3.2.4">
                <p id="section-9.4-2.3.2.4.1">The storing of the value of the 'kid' and 'kid context' parameters from the request, if the server intends to reply with multiple responses within the long exchange established by the request.<a href="#section-9.4-2.3.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
<div id="sec-pairwise-protection-resp">
<section id="section-9.5">
        <h3 id="name-protecting-the-response-2">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-protecting-the-response-2" class="section-name selfRef">Protecting the Response</a>
        </h3>
<p id="section-9.5-1">When using the pairwise mode to protect a response, a server <span class="bcp14">SHALL</span> proceed as described in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.3" class="relref">Section 8.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the differences summarized in <a href="#sec-differences-oscore-pairwise" class="auto internal xref">Section 9.2</a> of this document. The following differences also apply.<a href="#section-9.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5-2.1">
            <p id="section-9.5-2.1.1">What is specified in <a href="#ssec-protect-response" class="auto internal xref">Section 8.3</a> of this document holds with respect to the following points.<a href="#section-9.5-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5-2.1.2.1">
                <p id="section-9.5-2.1.2.1.1">The protection of a response when using a different Security Context than the one used to protect the corresponding request. That is, the server always protects a response with the Sender Context from its latest Security Context, and establishing a new Security Context resets the Sender Sequence Number to 0 (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#section-9.5-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.5-2.1.2.2">
                <p id="section-9.5-2.1.2.2.1">The use of the stored value of the 'kid' and 'kid context' parameters, if the server intends to reply with multiple responses within the long exchange established by the request.<a href="#section-9.5-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.5-2.1.2.3">
                <p id="section-9.5-2.1.2.3.1">The rules for the inclusion of the server's Sender Sequence Number as Partial IV in a response, as used to build the AEAD nonce to protect the response.<a href="#section-9.5-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.5-2.1.2.4">
                <p id="section-9.5-2.1.2.4.1">The rules for the inclusion of the ID Context (Gid) in the 'kid context' parameter of a response, if the ID Context used for the response differs from the one used to verify the request (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>), also for helping the client to synchronize.<a href="#section-9.5-2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.5-2.1.2.5">
                <p id="section-9.5-2.1.2.5.1">The rules for the inclusion of the Sender ID in the 'kid' parameter of a response to a request that was protected in pairwise mode, if the server has obtained a new Sender ID from the Group Manager when individually rekeyed (see <a href="#new-sender-id" class="auto internal xref">Section 2.6.3.1</a>), thus helping the client to synchronize.<a href="#section-9.5-2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
<div id="sec-pairwise-verify-resp">
<section id="section-9.6">
        <h3 id="name-verifying-the-response-2">
<a href="#section-9.6" class="section-number selfRef">9.6. </a><a href="#name-verifying-the-response-2" class="section-name selfRef">Verifying the Response</a>
        </h3>
<p id="section-9.6-1">Upon receiving a protected response with the Group Flag set to 0, following the procedure in <a href="#sec-message-reception" class="auto internal xref">Section 7</a>, a client <span class="bcp14">SHALL</span> proceed as described in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.4" class="relref">Section 8.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the differences summarized in <a href="#sec-differences-oscore-pairwise" class="auto internal xref">Section 9.2</a> of this document. The following differences also apply.<a href="#section-9.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.6-2.1">
            <p id="section-9.6-2.1.1">The client may receive a response protected with a Security Context different from the one used to protect the corresponding request. Also, upon the establishment of a new Security Context, the client re-initializes its Replay Windows in its Recipient Contexts (see <a href="#ssec-sender-recipient-context" class="auto internal xref">Section 2.2</a>).<a href="#section-9.6-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.6-2.2">
            <p id="section-9.6-2.2.1">The same as described in <a href="#ssec-verify-response" class="auto internal xref">Section 8.4</a> holds with respect to handling the 'kid' parameter of the response, when received as a reply to a request protected in pairwise mode. The client can also in this case check whether the replying server is the expected one, by relying on the server's public key. However, since the response is protected in pairwise mode, the public key is not used for verifying a countersignature as in <a href="#ssec-verify-response" class="auto internal xref">Section 8.4</a>. Instead, the expected server's authentication credential - namely Recipient Auth Cred and including the server's public key - was taken as input to derive the Pairwise Recipient Key used to decrypt and verify the response (see <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a>).<a href="#section-9.6-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.6-2.3">
            <p id="section-9.6-2.3.1">If a new Recipient Context is created for this Recipient ID, new Pairwise Sender/Recipient Keys are also derived (see <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a>). The new Pairwise Sender/Recipient Keys are deleted if the Recipient Context is deleted as a result of the message not being successfully verified.<a href="#section-9.6-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.6-2.4">
            <p id="section-9.6-2.4.1">What is specified in <a href="#ssec-verify-response" class="auto internal xref">Section 8.4</a> of this document holds with respect to the following points.<a href="#section-9.6-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.6-2.4.2.1">
                <p id="section-9.6-2.4.2.1.1">The possible, dynamic creation and configuration of a Recipient Context upon receiving the response.<a href="#section-9.6-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.6-2.4.2.2">
                <p id="section-9.6-2.4.2.2.1">The use of the stored value of the 'kid' and 'kid context' parameters, when processing a response received within a long exchange.<a href="#section-9.6-2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.6-2.4.2.3">
                <p id="section-9.6-2.4.2.3.1">The performing of ordering and replay protection for responses received within a long exchange.<a href="#section-9.6-2.4.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.6-2.4.2.4">
                <p id="section-9.6-2.4.2.4.1">The possible deletion of a Recipient Context created upon receiving the response, in case the response is not verified successfully.<a href="#section-9.6-2.4.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-synch-challenge-response">
<section id="section-10">
      <h2 id="name-challenge-response-based-fr">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-challenge-response-based-fr" class="section-name selfRef">Challenge-Response Based Freshness and Replay Window Recovery</a>
      </h2>
<p id="section-10-1">This section describes how a server endpoint can verify freshness of a request by means of a challenge-response exchange with a client, using the Echo Option for CoAP specified in <span><a href="https://rfc-editor.org/rfc/rfc9175#section-2" class="relref">Section 2</a> of [<a href="#RFC9175" class="cite xref">RFC9175</a>]</span>. The same mechanism, with small alterations, is also used by the server when first processing a request using a Recipient Context whose Replay Window was initialized as invalid.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">If the application requires freshness, e.g., according to time- or event-based policies (see <span><a href="https://rfc-editor.org/rfc/rfc9175#section-2.5.1" class="relref">Section 2.5.1</a> of [<a href="#RFC9175" class="cite xref">RFC9175</a>]</span>), a server proceeds as described below, upon receiving a request from a particular client for the first time.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">The server processes the message as described in this document, but, even if valid, does not deliver it to the application. Instead, the server replies to the client with a Group OSCORE protected 4.01 (Unauthorized) response message, including only the Echo Option and no diagnostic payload. The server <span class="bcp14">MUST</span> use its Partial IV when generating the AEAD nonce for protecting the response conveying the Echo Option, and <span class="bcp14">MUST</span> include the Partial IV in the response.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4">The Echo Option value <span class="bcp14">SHOULD NOT</span> be reused; if it is reused, it <span class="bcp14">MUST</span> be highly unlikely to have been recently used with this client. Since this response is protected with the Security Context used in the group, the client will consider the response valid upon successfully decrypting and verifying it.<a href="#section-10-4" class="pilcrow">¶</a></p>
<p id="section-10-5">The server stores the Echo Option value included in the response together with the pair (gid,kid), where 'gid' is the Group Identifier of the OSCORE group and 'kid' is the Sender ID of the client in the group. These are specified in the 'kid context' and 'kid' fields of the OSCORE Option of the request, respectively. After a group rekeying has been completed and a new Security Context has been established in the group, which results also in a new Group Identifier (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>), the server <span class="bcp14">MUST</span> delete all the stored Echo values associated with members of the group.<a href="#section-10-5" class="pilcrow">¶</a></p>
<p id="section-10-6">Upon receiving a 4.01 (Unauthorized) response that includes an Echo Option and originates from a verified group member, the subsequent client request echoing the Echo Option value <span class="bcp14">MUST</span> be sent as a unicast message to the same server.<a href="#section-10-6" class="pilcrow">¶</a></p>
<p id="section-10-7">If in the group the AEAD Algorithm and Pairwise Key Agreement Algorithm are set in the Security Context, the client <span class="bcp14">MUST</span> use the pairwise mode to protect the request, as per <a href="#sec-pairwise-protection-req" class="auto internal xref">Section 9.3</a>. Note that, as defined in <a href="#sec-pairwise-protection" class="auto internal xref">Section 9</a>, endpoints that are members of such a group and that use the Echo Option support the pairwise mode. In a group where the AEAD Algorithm and Pairwise Key Agreement Algorithm are not set, only the group mode can be used. Hence, requests including the Echo Option can be protected only with the Group Mode, with the caveat due to the risk for those requests to be redirected to a different server than the intended one, as discussed in <a href="#ssec-unicast-requests" class="auto internal xref">Section 13.9</a>.<a href="#section-10-7" class="pilcrow">¶</a></p>
<p id="section-10-8">The client does not necessarily resend the same request, but can instead send a more recent one, if the application permits it. This allows the client to not retain previously sent requests for full retransmission, unless the application explicitly requires otherwise. In either case, the client uses a fresh Sender Sequence Number value from its own Sender Context. If the client stores requests for possible retransmission with the Echo Option, it should not store a given request for longer than a preconfigured time interval. Note that the unicast request echoing the Echo Option is correctly treated and processed, since the 'kid context' field including the Group Identifier of the OSCORE group is still present in the OSCORE Option as part of the COSE object (see <a href="#sec-cose-object" class="auto internal xref">Section 4</a>).<a href="#section-10-8" class="pilcrow">¶</a></p>
<p id="section-10-9">Upon receiving the unicast request including the Echo Option, the server performs the following verifications.<a href="#section-10-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10-10.1">
          <p id="section-10-10.1.1">If the server does not store an Echo Option value for the pair (gid,kid), it considers: i) the time t1 when it has established the Security Context used to protect the received request; and ii) the time t2 when the request has been received. Since a valid request cannot be older than the Security Context used to protect it, the server verifies that (t2 - t1) is less than the largest amount of time acceptable to consider the request fresh.<a href="#section-10-10.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-10-10.2">
          <p id="section-10-10.2.1">If the server stores an Echo Option value for the pair (gid,kid) associated with that same client in the same group, the server verifies that the option value equals that same stored value previously sent to that client.<a href="#section-10-10.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-10-11">If the verifications above fail, the server <span class="bcp14">MUST NOT</span> process the request further and <span class="bcp14">MAY</span> send a 4.01 (Unauthorized) response including an Echo Option, hence performing a new challenge-response exchange.<a href="#section-10-11" class="pilcrow">¶</a></p>
<p id="section-10-12">If the verifications above are successful, the server considers the Recipient Context associated with the sender client and proceeds as follows.<a href="#section-10-12" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10-13.1">
          <p id="section-10-13.1.1">In case the Replay Window is invalid, the steps below occur.<a href="#section-10-13.1.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-10-13.1.2">
<li id="section-10-13.1.2.1">
              <p id="section-10-13.1.2.1.1">The server updates the Replay Window, by marking as received the Sender Sequence Number from the latest received request. This becomes the lower limit of the Replay Window, while all the other values are marked as not received.<a href="#section-10-13.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-10-13.1.2.2">
              <p id="section-10-13.1.2.2.1">The server makes the Replay Window valid, and accepts the request as fresh.<a href="#section-10-13.1.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</li>
        <li class="normal" id="section-10-13.2">
          <p id="section-10-13.2.1">In case the Replay Window is already valid, the server discards the verification result and accepts the request as fresh or treats it as a replay, according to the existing Replay Window.<a href="#section-10-13.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-10-14">A server should not deliver requests from a given client to the application until one valid request from that same client has been verified as fresh, as conveying an echoed Echo Option. A server may perform the challenge-response described above at any time, e.g., after a device reboot occurred in an unprepared way. A client has to be ready to perform the challenge-response based on the Echo Option if a server starts it.<a href="#section-10-14" class="pilcrow">¶</a></p>
<p id="section-10-15">Message freshness is further discussed in <a href="#ssec-seccons-freshness" class="auto internal xref">Section 13.14</a>.<a href="#section-10-15" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-compliance">
<section id="section-11">
      <h2 id="name-implementation-compliance">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-implementation-compliance" class="section-name selfRef">Implementation Compliance</a>
      </h2>
<p id="section-11-1">Like in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, HKDF SHA-256 is the mandatory to implement HKDF.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">An endpoint may support only the group mode, or only the pairwise mode, or both.<a href="#section-11-2" class="pilcrow">¶</a></p>
<p id="section-11-3">For endpoints that support the group mode, the following applies.<a href="#section-11-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11-4.1">
          <p id="section-11-4.1.1">For endpoints that use authenticated encryption, the AEAD algorithm AES-CCM-16-64-128 defined in <span><a href="https://rfc-editor.org/rfc/rfc9053#section-4.2" class="relref">Section 4.2</a> of [<a href="#RFC9053" class="cite xref">RFC9053</a>]</span> is mandatory to implement as Group Encryption Algorithm (see <a href="#ssec-common-context-cs-enc-alg" class="auto internal xref">Section 2.1.6</a>).<a href="#section-11-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-11-4.2">
          <p id="section-11-4.2.1">For many constrained IoT devices it is problematic to support more than one signature algorithm. Existing devices can be expected to support either EdDSA or ECDSA. In order to enable as much interoperability as we can reasonably achieve, the following applies with respect to the Signature Algorithm (see <a href="#ssec-common-context-cs-alg" class="auto internal xref">Section 2.1.7</a>).<a href="#section-11-4.2.1" class="pilcrow">¶</a></p>
<p id="section-11-4.2.2">
Less constrained endpoints <span class="bcp14">SHOULD</span> implement both: the EdDSA signature algorithm together with the elliptic curve Ed25519 <span>[<a href="#RFC8032" class="cite xref">RFC8032</a>]</span>; and the ECDSA signature algorithm together with the elliptic curve P-256.<a href="#section-11-4.2.2" class="pilcrow">¶</a></p>
<p id="section-11-4.2.3">
Constrained endpoints <span class="bcp14">SHOULD</span> implement: the EdDSA signature algorithm together with the elliptic curve Ed25519 <span>[<a href="#RFC8032" class="cite xref">RFC8032</a>]</span>; or the ECDSA signature algorithm together with the elliptic curve P-256.<a href="#section-11-4.2.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-11-4.3">
          <p id="section-11-4.3.1">Endpoints that implement the ECDSA signature algorithm <span class="bcp14">MAY</span> use "deterministic ECDSA" as specified in <span>[<a href="#RFC6979" class="cite xref">RFC6979</a>]</span>. Pure deterministic elliptic-curve signature algorithms such as deterministic ECDSA and EdDSA have the advantage of not requiring access to a source of high-quality randomness. However, these signature algorithms have been shown vulnerable to some side-channel and fault injection attacks due to their determinism, which can result in extracting a device's private key. As suggested in <span><a href="https://rfc-editor.org/rfc/rfc9053#section-2.1.1" class="relref">Section 2.1.1</a> of [<a href="#RFC9053" class="cite xref">RFC9053</a>]</span>, this can be addressed by combining both randomness and determinism <span>[<a href="#I-D.irtf-cfrg-det-sigs-with-noise" class="cite xref">I-D.irtf-cfrg-det-sigs-with-noise</a>]</span>.<a href="#section-11-4.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-11-5">For endpoints that support the pairwise mode, the following applies.<a href="#section-11-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11-6.1">
          <p id="section-11-6.1.1">The AEAD algorithm AES-CCM-16-64-128 defined in <span><a href="https://rfc-editor.org/rfc/rfc9053#section-4.2" class="relref">Section 4.2</a> of [<a href="#RFC9053" class="cite xref">RFC9053</a>]</span> is mandatory to implement as AEAD Algorithm (see <a href="#ssec-common-context-aead-alg" class="auto internal xref">Section 2.1.1</a>).<a href="#section-11-6.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-11-6.2">
          <p id="section-11-6.2.1">The ECDH-SS + HKDF-256 algorithm specified in <span><a href="https://rfc-editor.org/rfc/rfc9053#section-6.3.1" class="relref">Section 6.3.1</a> of [<a href="#RFC9053" class="cite xref">RFC9053</a>]</span> is mandatory to implement as Pairwise Key Agreement Algorithm (see <a href="#ssec-common-context-dh-alg" class="auto internal xref">Section 2.1.9</a>).<a href="#section-11-6.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-11-6.3">
          <p id="section-11-6.3.1">In order to enable as much interoperability as we can reasonably achieve in the presence of constrained devices (see above), the following applies.<a href="#section-11-6.3.1" class="pilcrow">¶</a></p>
<p id="section-11-6.3.2">
Less constrained endpoints <span class="bcp14">SHOULD</span> implement both the X25519 curve <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span> and the P-256 curve as ECDH curves.<a href="#section-11-6.3.2" class="pilcrow">¶</a></p>
<p id="section-11-6.3.3">
Constrained endpoints <span class="bcp14">SHOULD</span> implement the X25519 curve <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span> or the P-256 curve as ECDH curve.<a href="#section-11-6.3.3" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-11-7">Constrained IoT devices may alternatively represent Montgomery curves and (twisted) Edwards curves <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span> in the short-Weierstrass form Wei25519, with which the algorithms ECDSA25519 and ECDH25519 can be used for signature operations and Diffie-Hellman secret calculation, respectively <span>[<a href="#I-D.ietf-lwig-curve-representations" class="cite xref">I-D.ietf-lwig-curve-representations</a>]</span>.<a href="#section-11-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="web-linking">
<section id="section-12">
      <h2 id="name-web-linking">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-web-linking" class="section-name selfRef">Web Linking</a>
      </h2>
<p id="section-12-1">The use of Group OSCORE or OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> <span class="bcp14">MAY</span> be indicated by a target "gosc" attribute in a web link <span>[<a href="#RFC8288" class="cite xref">RFC8288</a>]</span> to a resource, e.g., using a link-format document <span>[<a href="#RFC6690" class="cite xref">RFC6690</a>]</span> if the resource is accessible over CoAP.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">The "gosc" attribute is a hint indicating that the destination of that link is only accessible using Group OSCORE or OSCORE, and unprotected access to it is not supported. Note that this is simply a hint, it does not include any security context material or any other information required to run Group OSCORE or OSCORE.<a href="#section-12-2" class="pilcrow">¶</a></p>
<p id="section-12-3">A value <span class="bcp14">MUST NOT</span> be given for the "gosc" attribute; any present value <span class="bcp14">MUST</span> be ignored by parsers. The "gosc" attribute <span class="bcp14">MUST NOT</span> appear more than once in a given link-value; occurrences after the first <span class="bcp14">MUST</span> be ignored by parsers.<a href="#section-12-3" class="pilcrow">¶</a></p>
<p id="section-12-4">When a link-value includes the "gosc" attribute, the link-value <span class="bcp14">MUST</span> also include the "osc" attribute defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-9" class="relref">Section 9</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. If the endpoint parsing the link-value supports Group OSCORE and understands the "gosc" attribute, then the parser <span class="bcp14">MUST</span> ignore the "osc" attribute, which is overshadowed by the "gosc" attribute.<a href="#section-12-4" class="pilcrow">¶</a></p>
<p id="section-12-5">The example in <a href="#fig-web-link-example" class="auto internal xref">Figure 4</a> shows a use of the "gosc" attribute: the client does resource discovery on a server and gets back a list of resources, one of which includes the "gosc" attribute indicating that the resource is protected with Group OSCORE or OSCORE. The link-format notation (see <span><a href="https://rfc-editor.org/rfc/rfc6690#section-5" class="relref">Section 5</a> of [<a href="#RFC6690" class="cite xref">RFC6690</a>]</span>) is used.<a href="#section-12-5" class="pilcrow">¶</a></p>
<span id="name-example-of-using-the-gosc-a"></span><div id="fig-web-link-example">
<figure id="figure-4">
        <div class="alignCenter art-text artwork" id="section-12-6.1">
<pre>
REQ: GET /.well-known/core

RES: 2.05 Content
    &lt;/sensors/temp&gt;;gosc;osc,
    &lt;/sensors/light&gt;;if="sensor"
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-example-of-using-the-gosc-a" class="selfRef">Example of using the "gosc" attribute in a web link.</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="sec-security-considerations">
<section id="section-13">
      <h2 id="name-security-considerations">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-13-1">The same threat model discussed for OSCORE in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-D.1" class="relref">Appendix D.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> holds for Group OSCORE.<a href="#section-13-1" class="pilcrow">¶</a></p>
<p id="section-13-2">For Group OSCORE, the Sender Context and Recipient Context additionally contain asymmetric keys, which are used to provide source authentication: in group mode, by means of countersignatures (see  <a href="#ssec-group-mode-security" class="auto internal xref">Section 13.1</a>); in pairwise mode, by using Diffie-Hellman (see <a href="#ssec-pairwise-mode-security" class="auto internal xref">Section 13.2</a>). The key pair can, for example, be generated by the endpoint or provisioned during manufacturing.<a href="#section-13-2" class="pilcrow">¶</a></p>
<p id="section-13-3">Note that, even if an endpoint is authorized to be a group member and to take part in group communications, there is a risk that it behaves inappropriately. For instance, it can forward the content of messages in the group to unauthorized entities. However, in many use cases, the devices in the group belong to a common authority and are configured by a commissioner (see <a href="#sec-use-cases" class="auto internal xref">Appendix B</a>), which results in a practically limited risk and enables a prompt detection/reaction in case of misbehaving.<a href="#section-13-3" class="pilcrow">¶</a></p>
<p id="section-13-4">The same considerations on supporting Proxy operations discussed for OSCORE in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-D.2" class="relref">Appendix D.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> hold for Group OSCORE.<a href="#section-13-4" class="pilcrow">¶</a></p>
<p id="section-13-5">The same considerations on protected message fields for OSCORE discussed in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-D.3" class="relref">Appendix D.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> hold for Group OSCORE.<a href="#section-13-5" class="pilcrow">¶</a></p>
<p id="section-13-6">The same considerations on uniqueness of (key, nonce) pairs for OSCORE discussed in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-D.4" class="relref">Appendix D.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> hold for Group OSCORE. This is further discussed in <a href="#ssec-key-nonce-uniqueness" class="auto internal xref">Section 13.3</a> of this document.<a href="#section-13-6" class="pilcrow">¶</a></p>
<p id="section-13-7">The same considerations on unprotected message fields for OSCORE discussed in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-D.5" class="relref">Appendix D.5</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> hold for Group OSCORE, with the following differences. First, the 'kid context' of request messages is part of the Additional Authenticated Data, thus safely enabling to keep long exchanges active beyond a possible change of ID Context (Gid), following a group rekeying (see <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a>). Second, the countersignature included in a Group OSCORE message protected in group mode is computed also over the value of the OSCORE Option, which is also part of the Additional Authenticated Data used in the signing process. This is further discussed in <a href="#ssec-cross-group-injection" class="auto internal xref">Section 13.7</a> of this document.<a href="#section-13-7" class="pilcrow">¶</a></p>
<p id="section-13-8">As discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-6.2.3" class="relref">Section 6.2.3</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, Group OSCORE addresses security attacks against CoAP listed in Sections 11.2-11.6 of <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, especially when run over IP multicast.<a href="#section-13-8" class="pilcrow">¶</a></p>
<p id="section-13-9">The rest of this section first discusses security aspects to be taken into account when using Group OSCORE. Then it goes through aspects covered in the security considerations of OSCORE (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12" class="relref">Section 12</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>), and discusses how they hold when Group OSCORE is used.<a href="#section-13-9" class="pilcrow">¶</a></p>
<div id="ssec-group-mode-security">
<section id="section-13.1">
        <h3 id="name-security-of-the-group-mode">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-security-of-the-group-mode" class="section-name selfRef">Security of the Group Mode</a>
        </h3>
<p id="section-13.1-1">The group mode defined in <a href="#mess-processing" class="auto internal xref">Section 8</a> relies on commonly shared group keying material to protect communication within a group. Using the group mode has the implications discussed below. The following refers to group members as the endpoints in the group storing the latest version of the group keying material.<a href="#section-13.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.1-2.1">
            <p id="section-13.1-2.1.1">Source authentication of messages sent to a group is ensured through a countersignature, which is computed by the sender using its own private key and then appended to the message payload. Also, the countersignature is encrypted by using a keystream derived from the group keying material (see <a href="#compression" class="auto internal xref">Section 5</a>). This ensures group privacy, i.e., an attacker cannot track an endpoint over two groups by linking messages between the two groups, unless being also a member of those groups.<a href="#section-13.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.1-2.2">
            <p id="section-13.1-2.2.1">Messages are encrypted at a group level (group-level data confidentiality), i.e., they can be decrypted by any member of the group, but not by an external adversary or other external entities.<a href="#section-13.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.1-2.3">
            <p id="section-13.1-2.3.1">If the used Group Encryption Algorithm provides integrity protection, then it also ensures group authentication and proof of group membership, but not source authentication. That is, it ensures that a message sent to a group has been sent by a member of that group, but not necessarily by the alleged sender. In fact, any group member is able to derive the Sender Key used by the actual sender endpoint, and thus can compute a valid authentication tag. Therefore, the message content could originate from any of the current group members.<a href="#section-13.1-2.3.1" class="pilcrow">¶</a></p>
<p id="section-13.1-2.3.2">
Furthermore, if the used Group Encryption Algorithm does not provide integrity protection, then it does not ensure any level of message authentication or proof of group membership.<a href="#section-13.1-2.3.2" class="pilcrow">¶</a></p>
<p id="section-13.1-2.3.3">
On the other hand, proof of group membership is always ensured by construction through the strict management of the group keying material (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>). That is, the group is rekeyed in case of members' leaving, and the current group members are informed of former group members. Thus, a current group member storing the latest group keying material does not store the authentication credential of any former group member.<a href="#section-13.1-2.3.3" class="pilcrow">¶</a></p>
<p id="section-13.1-2.3.4">
This allows a recipient endpoint to rely on the stored authentication credentials and public keys included therein, in order to always confidently assert the group membership of a sender endpoint when processing an incoming message, i.e., to assert that the sender endpoint was a group member when it signed the message. In turn, this prevents a former group member to possibly re-sign and inject in the group a stored message that was protected with old keying material.<a href="#section-13.1-2.3.4" class="pilcrow">¶</a></p>
<p id="section-13.1-2.3.5">
A case in point is a group where the Group Encryption Algorithm does not provide integrity protection; a group member leaves the group; and, after the group rekeying, associates with the group as external signature checker (see <a href="#sec-processing-signature-checker" class="auto internal xref">Section 8.5</a>). When doing so, it obtains from the Group Manager the new Signature Encryption Key, from which it can derive keystreams for encrypting and decrypting the countersignatures of messages protected in group mode.<a href="#section-13.1-2.3.5" class="pilcrow">¶</a></p>
<p id="section-13.1-2.3.6">
If, when participating in the group rekeying, the current group members had not deleted the Recipient Context and authentication credential of the former group member, then the signature checker would be able to successfully inject messages protected in group mode, as encrypted with the old group keying material, signed with its own private key, and with the countersignature encrypted by means of the latest Signature Encryption Key. Then, the group members, as still retaining the authentication credential of the signature checker, will verify and accept the message, even though the sender was not a group member when signing the message.<a href="#section-13.1-2.3.6" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-13.1-3">The security properties of the group mode are summarized below.<a href="#section-13.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-13.1-4">
<li id="section-13.1-4.1">
            <p id="section-13.1-4.1.1">Asymmetric source authentication, by means of a countersignature.<a href="#section-13.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-13.1-4.2">
            <p id="section-13.1-4.2.1">Symmetric group authentication, by means of an authentication tag (only for Group Encryption Algorithms providing integrity protection).<a href="#section-13.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-13.1-4.3">
            <p id="section-13.1-4.3.1">Symmetric group confidentiality, by means of symmetric encryption.<a href="#section-13.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-13.1-4.4">
            <p id="section-13.1-4.4.1">Proof of group membership, by strictly managing the group keying material, as well as by means of integrity tags when using a Group Encryption Algorithm that provides also integrity protection.<a href="#section-13.1-4.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-13.1-4.5">
            <p id="section-13.1-4.5.1">Group privacy, by encrypting the countersignature.<a href="#section-13.1-4.5.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-13.1-5">The group mode fulfills the security properties above while also displaying the following benefits. First, the use of a Group Encryption Algorithm that does not provide integrity protection results in a minimal communication overhead, by limiting the message payload to the ciphertext without integrity tag together with the encrypted countersignature. Second, it is possible to deploy semi-trusted entities such as signature checkers (see <a href="#sec-additional-entities" class="auto internal xref">Section 3.3</a>), which can break property 5, but cannot break properties 1, 2, 3, and 4.<a href="#section-13.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-pairwise-mode-security">
<section id="section-13.2">
        <h3 id="name-security-of-the-pairwise-mo">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-security-of-the-pairwise-mo" class="section-name selfRef">Security of the Pairwise Mode</a>
        </h3>
<p id="section-13.2-1">The pairwise mode defined in <a href="#sec-pairwise-protection" class="auto internal xref">Section 9</a> protects messages by using pairwise symmetric keys, derived from the static-static Diffie-Hellman shared secret computed from the asymmetric keys of the sender and recipient endpoint (see <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a>).<a href="#section-13.2-1" class="pilcrow">¶</a></p>
<p id="section-13.2-2">The used AEAD Algorithm <span class="bcp14">MUST</span> provide integrity protection. Therefore, the pairwise mode ensures both pairwise data-confidentiality and source authentication of messages, without using countersignatures. Furthermore, the recipient endpoint achieves proof of group membership for the sender endpoint, since only current group members have the required keying material to derive a valid Pairwise Sender/Recipient Key.<a href="#section-13.2-2" class="pilcrow">¶</a></p>
<p id="section-13.2-3">The long-term storing of the Diffie-Hellman shared secret is a potential security issue. In fact, if the shared secret of two group members is leaked, a third group member can exploit it to impersonate any of those two group members, by deriving and using their pairwise key. The possibility of such leakage should be contemplated, as more likely to happen than the leakage of a private key, which could be rather protected at a significantly higher level than generic memory, e.g., by using a Trusted Platform Module. Therefore, there is a trade-off between the maximum amount of time a same shared secret is stored and the frequency of its re-computing.<a href="#section-13.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-key-nonce-uniqueness">
<section id="section-13.3">
        <h3 id="name-uniqueness-of-key-nonce">
<a href="#section-13.3" class="section-number selfRef">13.3. </a><a href="#name-uniqueness-of-key-nonce" class="section-name selfRef">Uniqueness of (key, nonce)</a>
        </h3>
<p id="section-13.3-1">The proof for uniqueness of (key, nonce) pairs in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-D.4" class="relref">Appendix D.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> is also valid in group communication scenarios. That is, given an OSCORE group:<a href="#section-13.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.3-2.1">
            <p id="section-13.3-2.1.1">Uniqueness of Sender IDs within the group is enforced by the Group Manager. In fact, from the moment when a Gid is assigned to a group until the moment when a new Gid is assigned to that same group, the Group Manager does not reassign a Sender ID within the group (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#section-13.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.3-2.2">
            <p id="section-13.3-2.2.1">The case A in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-D.4" class="relref">Appendix D.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> concerns all requests as well as all responses including a Partial IV (e.g., Observe notifications <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span> or any other subsequent responses after the first one). In this case, same considerations from <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> apply here as well.<a href="#section-13.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.3-2.3">
            <p id="section-13.3-2.3.1">The case B in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-D.4" class="relref">Appendix D.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> concerns responses not including a Partial IV (e.g., a single response to a request). In this case, same considerations from <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> apply here as well.<a href="#section-13.3-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-13.3-3">As a consequence, each message encrypted/decrypted with the same Sender Key is processed by using a different (ID_PIV, PIV) pair. This means that nonces used by any fixed encrypting endpoint are unique. Thus, each message is processed with a different (key, nonce) pair.<a href="#section-13.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-cons-group-key-management">
<section id="section-13.4">
        <h3 id="name-management-of-group-keying-m">
<a href="#section-13.4" class="section-number selfRef">13.4. </a><a href="#name-management-of-group-keying-m" class="section-name selfRef">Management of Group Keying Material</a>
        </h3>
<p id="section-13.4-1">The protocol described in this document should take into account the risk of compromise of group members. In particular, this document specifies that a key management scheme for secure revocation and renewal of Security Contexts and group keying material <span class="bcp14">MUST</span> be adopted.<a href="#section-13.4-1" class="pilcrow">¶</a></p>
<p id="section-13.4-2"><span>[<a href="#I-D.ietf-ace-key-groupcomm-oscore" class="cite xref">I-D.ietf-ace-key-groupcomm-oscore</a>]</span> specifies a simple rekeying scheme for renewing the Security Context in a group.<a href="#section-13.4-2" class="pilcrow">¶</a></p>
<p id="section-13.4-3">Alternative rekeying schemes that are more scalable with the group size may be needed in dynamic, large groups where endpoints can join and leave at any time, in order to limit the impact on performance due to the Security Context and keying material update.<a href="#section-13.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-key-rotation">
<section id="section-13.5">
        <h3 id="name-update-of-security-context-">
<a href="#section-13.5" class="section-number selfRef">13.5. </a><a href="#name-update-of-security-context-" class="section-name selfRef">Update of Security Context and Key Rotation</a>
        </h3>
<p id="section-13.5-1">A group member can receive a message shortly after the group has been rekeyed, and new security parameters and keying material have been distributed by the Group Manager.<a href="#section-13.5-1" class="pilcrow">¶</a></p>
<p id="section-13.5-2">This may result in a client using an old Security Context to protect a request, and a server using a different new Security Context to protect a corresponding response. As a consequence, clients may receive a response protected with a Security Context different from the one used to protect the corresponding request.<a href="#section-13.5-2" class="pilcrow">¶</a></p>
<p id="section-13.5-3">In particular, a server may first get a request protected with the old Security Context, then install the new Security Context, and only after that produce a response to send back to the client. In such a case, as specified in <a href="#ssec-protect-response" class="auto internal xref">Section 8.3</a>, the server <span class="bcp14">MUST</span> protect the potential response using the new Security Context. Specifically, the server <span class="bcp14">MUST</span> include its Sender Sequence Number as Partial IV in the response and use it to build the AEAD nonce to protect the response. This prevents the AEAD nonce from the request from being reused with the new Security Context.<a href="#section-13.5-3" class="pilcrow">¶</a></p>
<p id="section-13.5-4">The client will process that response using the new Security Context, provided that it has installed the new security parameters and keying material before the message processing.<a href="#section-13.5-4" class="pilcrow">¶</a></p>
<p id="section-13.5-5">In case block-wise transfer <span>[<a href="#RFC7959" class="cite xref">RFC7959</a>]</span> is used, the same considerations from <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-key-groupcomm-19#section-10.3" class="relref">Section 10.3</a> of [<a href="#I-D.ietf-ace-key-groupcomm" class="cite xref">I-D.ietf-ace-key-groupcomm</a>]</span> hold.<a href="#section-13.5-5" class="pilcrow">¶</a></p>
<p id="section-13.5-6">Furthermore, as described below, a group rekeying may temporarily result in misaligned Security Contexts between the sender and recipient of a same message.<a href="#section-13.5-6" class="pilcrow">¶</a></p>
<div id="ssec-key-rotation-late-sender">
<section id="section-13.5.1">
          <h4 id="name-late-update-on-the-sender">
<a href="#section-13.5.1" class="section-number selfRef">13.5.1. </a><a href="#name-late-update-on-the-sender" class="section-name selfRef">Late Update on the Sender</a>
          </h4>
<p id="section-13.5.1-1">In this case, the sender protects a message using the old Security Context, i.e., before having installed the new Security Context. However, the recipient receives the message after having installed the new Security Context, and is thus unable to correctly process it.<a href="#section-13.5.1-1" class="pilcrow">¶</a></p>
<p id="section-13.5.1-2">A possible way to ameliorate this issue is to preserve the old retained Security Context for a maximum amount of time defined by the application. By doing so, the recipient can still try to process the received message using the old retained Security Context.<a href="#section-13.5.1-2" class="pilcrow">¶</a></p>
<p id="section-13.5.1-3">This makes particular sense when the recipient is a client, that would hence be able to process incoming responses protected with the old retained Security Context used to protect the associated request. If, as typically expected, the old Gid is not included in the response, then the client will first fail to process the response using the latest Security Context, and then use the old retained Security Context as a second attempt.<a href="#section-13.5.1-3" class="pilcrow">¶</a></p>
<p id="section-13.5.1-4">Instead, a recipient server can immediately process an incoming request with the old retained Security Context, as signaled by the old Gid that is always included in requests. However, the server would better and more simply discard such an incoming request.<a href="#section-13.5.1-4" class="pilcrow">¶</a></p>
<p id="section-13.5.1-5">This tolerance preserves the processing of secure messages throughout a long-lasting key rotation, as group rekeying processes may likely take a long time to complete, especially in large groups. On the other hand, a former (compromised) group member can abusively take advantage of this, and send messages protected with the old retained Security Context. Therefore, a conservative application policy should not admit the retention of old Security Contexts.<a href="#section-13.5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-key-rotation-late-recipient">
<section id="section-13.5.2">
          <h4 id="name-late-update-on-the-recipien">
<a href="#section-13.5.2" class="section-number selfRef">13.5.2. </a><a href="#name-late-update-on-the-recipien" class="section-name selfRef">Late Update on the Recipient</a>
          </h4>
<p id="section-13.5.2-1">In this case, the sender protects a message using the new Security Context, but the recipient receives that message before having installed the new Security Context. Therefore, the recipient would not be able to correctly process the message and hence discards it.<a href="#section-13.5.2-1" class="pilcrow">¶</a></p>
<p id="section-13.5.2-2">If the recipient installs the new Security Context shortly after that and the sender endpoint retransmits the message, the former will still be able to receive and correctly process the message.<a href="#section-13.5.2-2" class="pilcrow">¶</a></p>
<p id="section-13.5.2-3">In any case, the recipient should actively ask the Group Manager for an updated Security Context according to an application-defined policy, for instance after a given number of unsuccessfully decrypted incoming messages.<a href="#section-13.5.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssec-gid-collision">
<section id="section-13.6">
        <h3 id="name-collision-of-group-identifi">
<a href="#section-13.6" class="section-number selfRef">13.6. </a><a href="#name-collision-of-group-identifi" class="section-name selfRef">Collision of Group Identifiers</a>
        </h3>
<p id="section-13.6-1">In case endpoints are deployed in multiple groups managed by different non-synchronized Group Managers, it is possible for Group Identifiers of different groups to coincide.<a href="#section-13.6-1" class="pilcrow">¶</a></p>
<p id="section-13.6-2">This does not impair the security of the AEAD algorithm. In fact, as long as the Master Secret is different for different groups and this condition holds over time, AEAD keys are different among different groups.<a href="#section-13.6-2" class="pilcrow">¶</a></p>
<p id="section-13.6-3">In case multiple groups use the same IP multicast address, the entity assigning that address may help limiting the chances to experience such collisions of Group Identifiers. In particular, it may allow the Group Managers of those groups using the same IP multicast address to share their respective list of assigned Group Identifiers currently in use.<a href="#section-13.6-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-cross-group-injection">
<section id="section-13.7">
        <h3 id="name-cross-group-message-injecti">
<a href="#section-13.7" class="section-number selfRef">13.7. </a><a href="#name-cross-group-message-injecti" class="section-name selfRef">Cross-group Message Injection</a>
        </h3>
<p id="section-13.7-1">A same endpoint is allowed to and would likely use the same pair (private key, authentication credential) in multiple OSCORE groups, possibly administered by different Group Managers.<a href="#section-13.7-1" class="pilcrow">¶</a></p>
<p id="section-13.7-2">When a sender endpoint sends a message protected in pairwise mode to a recipient endpoint in an OSCORE group, a malicious group member may attempt to inject the message to a different OSCORE group also including the same endpoints (see <a href="#ssec-cross-group-injection-attack" class="auto internal xref">Section 13.7.1</a>).<a href="#section-13.7-2" class="pilcrow">¶</a></p>
<p id="section-13.7-3">This practically relies on altering the content of the OSCORE Option, and having the same MAC in the ciphertext still correctly validating, which has a success probability depending on the size of the MAC.<a href="#section-13.7-3" class="pilcrow">¶</a></p>
<p id="section-13.7-4">As discussed in <a href="#sssec-cross-group-injection-group-mode" class="auto internal xref">Section 13.7.2</a>, the attack is practically infeasible if the message is protected in group mode, thanks to the countersignature also bound to the OSCORE Option through the Additional Authenticated Data used in the signing process (see <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a>).<a href="#section-13.7-4" class="pilcrow">¶</a></p>
<div id="ssec-cross-group-injection-attack">
<section id="section-13.7.1">
          <h4 id="name-attack-description">
<a href="#section-13.7.1" class="section-number selfRef">13.7.1. </a><a href="#name-attack-description" class="section-name selfRef">Attack Description</a>
          </h4>
<p id="section-13.7.1-1">Let us consider:<a href="#section-13.7.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.7.1-2.1">
              <p id="section-13.7.1-2.1.1">Two OSCORE groups G1 and G2, with ID Context (Group ID) Gid1 and Gid2, respectively. Both G1 and G2 use the AEAD cipher AES-CCM-16-64-128, i.e., the MAC of the ciphertext is 8 bytes in size.<a href="#section-13.7.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-13.7.1-2.2">
              <p id="section-13.7.1-2.2.1">A sender endpoint X which is member of both G1 and G2, and uses the same pair (private key, authentication credential) in both groups. The endpoint X has Sender ID Sid1 in G1 and Sender ID Sid2 in G2. The pairs (Sid1, Gid1) and (Sid2, Gid2) identify the same authentication credential of X in G1 and G2, respectively.<a href="#section-13.7.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-13.7.1-2.3">
              <p id="section-13.7.1-2.3.1">A recipient endpoint Y which is member of both G1 and G2, and uses the same pair (private key, authentication credential) in both groups. The endpoint Y has Sender ID Sid3 in G1 and Sender ID Sid4 in G2. The pairs (Sid3, Gid1) and (Sid4, Gid2) identify the same authentication credential of Y in G1 and G2, respectively.<a href="#section-13.7.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-13.7.1-2.4">
              <p id="section-13.7.1-2.4.1">A malicious endpoint Z is also member of both G1 and G2. Hence, Z is able to derive the Sender Keys used by X in G1 and G2.<a href="#section-13.7.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-13.7.1-3">When X sends a message M1 addressed to Y in G1 and protected in pairwise mode, Z can intercept M1, and attempt to forge a valid message M2 to be injected in G2, making it appear as still sent by X to Y and valid to be accepted.<a href="#section-13.7.1-3" class="pilcrow">¶</a></p>
<p id="section-13.7.1-4">More in detail, Z intercepts and stops message M1, and forges a message M2 by changing the value of the OSCORE Option from M1 as follows: the 'kid context' is set to G2 (rather than G1); and the 'kid' is set to Sid2 (rather than Sid1). Then, Z injects message M2 as addressed to Y in G2.<a href="#section-13.7.1-4" class="pilcrow">¶</a></p>
<p id="section-13.7.1-5">Upon receiving M2, there is a probability equal to 2^-64 that Y successfully verifies the same unchanged MAC by using the Pairwise Recipient Key associated with X in G2.<a href="#section-13.7.1-5" class="pilcrow">¶</a></p>
<p id="section-13.7.1-6">Note that Z does not know the pairwise keys of X and Y, since it does not know and is not able to compute their shared Diffie-Hellman secret. Therefore, Z is not able to check offline if a performed forgery is actually valid, before sending the forged message to G2.<a href="#section-13.7.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sssec-cross-group-injection-group-mode">
<section id="section-13.7.2">
          <h4 id="name-attack-prevention-in-group-">
<a href="#section-13.7.2" class="section-number selfRef">13.7.2. </a><a href="#name-attack-prevention-in-group-" class="section-name selfRef">Attack Prevention in Group Mode</a>
          </h4>
<p id="section-13.7.2-1">When a Group OSCORE message is protected in group mode, the countersignature is computed also over the value of the OSCORE Option, which is part of the Additional Authenticated Data used in the signing process (see <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a>).<a href="#section-13.7.2-1" class="pilcrow">¶</a></p>
<p id="section-13.7.2-2">That is, other than over the ciphertext, the countersignature is computed over: the ID Context (Gid) and the Partial IV, which are always present in requests; as well as the Sender ID of the message originator, which is always present in requests as well as in responses to requests protected in group mode.<a href="#section-13.7.2-2" class="pilcrow">¶</a></p>
<p id="section-13.7.2-3">Since the signing process takes as input also the ciphertext of the COSE_Encrypt0 object, the countersignature is bound not only to the intended OSCORE group, hence to the triplet (Master Secret, Master Salt, ID Context), but also to a specific Sender ID in that group and to its specific symmetric key used for AEAD encryption, hence to the quartet (Master Secret, Master Salt, ID Context, Sender ID).<a href="#section-13.7.2-3" class="pilcrow">¶</a></p>
<p id="section-13.7.2-4">This makes it practically infeasible to perform the attack described in <a href="#ssec-cross-group-injection-attack" class="auto internal xref">Section 13.7.1</a>, since it would require the adversary to additionally forge a valid countersignature that replaces the original one in the forged message M2.<a href="#section-13.7.2-4" class="pilcrow">¶</a></p>
<p id="section-13.7.2-5">If, hypothetically, the countersignature did not cover the OSCORE Option:<a href="#section-13.7.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.7.2-6.1">
              <p id="section-13.7.2-6.1.1">The attack described in <a href="#ssec-cross-group-injection-attack" class="auto internal xref">Section 13.7.1</a> would still be possible against response messages protected in group mode, since the same unchanged countersignature from message M1 would be also valid in message M2.<a href="#section-13.7.2-6.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-13.7.2-6.2">
              <p id="section-13.7.2-6.2.1">A simplification would also be possible in performing the attack, since Z is able to derive the Sender/Recipient Keys of X and Y in G1 and G2. That is, Z can also set a convenient Partial IV in the response, until the same unchanged MAC is successfully verified by using G2 as 'request_kid_context', Sid2 as 'request_kid', and the symmetric key associated with X in G2.<a href="#section-13.7.2-6.2.1" class="pilcrow">¶</a></p>
<p id="section-13.7.2-6.2.2">
Since the Partial IV is 5 bytes in size, this requires 2^40 operations to test all the Partial IVs, which can be done in real-time. The probability that a single given message M1 can be used to forge a response M2 for a given request would be equal to 2^-24, since there are more MAC values (8 bytes in size) than Partial IV values (5 bytes in size).<a href="#section-13.7.2-6.2.2" class="pilcrow">¶</a></p>
<p id="section-13.7.2-6.2.3">
Note that, by changing the Partial IV as discussed above, any member of G1 would also be able to forge a valid signed response message M2 to be injected in the same group G1.<a href="#section-13.7.2-6.2.3" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="ssec-group-cloning">
<section id="section-13.8">
        <h3 id="name-prevention-of-group-cloning">
<a href="#section-13.8" class="section-number selfRef">13.8. </a><a href="#name-prevention-of-group-cloning" class="section-name selfRef">Prevention of Group Cloning Attack</a>
        </h3>
<p id="section-13.8-1">Both when using the group mode and the pairwise mode, the message protection covers also the Group Manager's authentication credential. This is included in the Additional Authenticated Data used in the signing process and/or in the integrity-protected encryption process (see <a href="#sec-cose-object-ext-aad" class="auto internal xref">Section 4.4</a>).<a href="#section-13.8-1" class="pilcrow">¶</a></p>
<p id="section-13.8-2">By doing so, an endpoint X member of a group G1 cannot perform the following attack.<a href="#section-13.8-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-13.8-3">
<li id="section-13.8-3.1">
            <p id="section-13.8-3.1.1">X sets up a group G2 where it acts as Group Manager.<a href="#section-13.8-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-13.8-3.2">
            <p id="section-13.8-3.2.1">X makes G2 a "clone" of G1, i.e., G1 and G2 use the same algorithms and have the same Master Secret, Master Salt and ID Context.<a href="#section-13.8-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-13.8-3.3">
            <p id="section-13.8-3.3.1">X collects a message M sent to G1 and injects it in G2.<a href="#section-13.8-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-13.8-3.4">
            <p id="section-13.8-3.4.1">Members of G2 accept M and believe it to be originated in G2.<a href="#section-13.8-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-13.8-4">The attack above is effectively prevented, since message M is protected by including the authentication credential of G1's Group Manager in the Additional Authenticated Data. Therefore, members of G2 do not successfully verify and decrypt M, since they correctly use the authentication credential of X as Group Manager of G2 when attempting to.<a href="#section-13.8-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-unicast-requests">
<section id="section-13.9">
        <h3 id="name-group-oscore-for-unicast-re">
<a href="#section-13.9" class="section-number selfRef">13.9. </a><a href="#name-group-oscore-for-unicast-re" class="section-name selfRef">Group OSCORE for Unicast Requests</a>
        </h3>
<p id="section-13.9-1">If a request is intended to be sent over unicast as addressed to a single group member, it is <span class="bcp14">NOT RECOMMENDED</span> for the client to protect the request by using the group mode as defined in <a href="#ssec-protect-request" class="auto internal xref">Section 8.1</a>.<a href="#section-13.9-1" class="pilcrow">¶</a></p>
<p id="section-13.9-2">This does not include the case where the client sends a request over unicast to a proxy, to be forwarded to multiple intended recipients over multicast <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>. In this case, the client typically protects the request with the group mode, even though it is sent to the proxy over unicast (see <a href="#mess-processing" class="auto internal xref">Section 8</a>).<a href="#section-13.9-2" class="pilcrow">¶</a></p>
<p id="section-13.9-3">If the client uses the group mode with its own Sender Key to protect a unicast request to a group member, an on-path adversary can, right then or later on, redirect that request to one/many different group member(s) over unicast, or to the whole OSCORE group over multicast. By doing so, the adversary can induce the target group member(s) to perform actions intended for one group member only. Note that the adversary can be external, i.e., they do not need to also be a member of the OSCORE group.<a href="#section-13.9-3" class="pilcrow">¶</a></p>
<p id="section-13.9-4">This is due to the fact that the client is not able to indicate the single intended recipient in a way which is secure and possible to process for Group OSCORE on the server side. In particular, Group OSCORE does not protect network addressing information such as the IP address of the intended recipient server. It follows that the server(s) receiving the redirected request cannot assert whether that was the original intention of the client, and would thus simply assume so.<a href="#section-13.9-4" class="pilcrow">¶</a></p>
<p id="section-13.9-5">The impact of such an attack depends especially on the REST method of the request, i.e., the Inner CoAP Code of the OSCORE request message. In particular, safe methods such as GET and FETCH would trigger (several) unintended responses from the targeted server(s), while not resulting in destructive behavior. On the other hand, non safe methods such as PUT, POST, and PATCH/iPATCH would result in the target server(s) taking active actions on their resources and possible cyber-physical environment, with the risk of destructive consequences and possible implications for safety.<a href="#section-13.9-5" class="pilcrow">¶</a></p>
<p id="section-13.9-6">A client can instead use the pairwise mode as defined in <a href="#sec-pairwise-protection-req" class="auto internal xref">Section 9.3</a>, in order to protect a request sent to a single group member by using pairwise keying material (see <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a>). This prevents the attack discussed above by construction, as only the intended server is able to derive the pairwise keying material used by the client to protect the request. In a group where the AEAD Algorithm and Pairwise Key Agreement Algorithm are set in the Security Context, a client supporting the pairwise mode <span class="bcp14">SHOULD</span> use it to protect requests sent to a single group member over unicast. For an example where this is not fulfilled, see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-observe-multicast-notifications-09#section-9.2.1" class="relref">Section 9.2.1</a> of [<a href="#I-D.ietf-core-observe-multicast-notifications" class="cite xref">I-D.ietf-core-observe-multicast-notifications</a>]</span>.<a href="#section-13.9-6" class="pilcrow">¶</a></p>
<p id="section-13.9-7">The use of block-wise transfers <span>[<a href="#RFC7959" class="cite xref">RFC7959</a>]</span> with group communication for CoAP is as discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11#section-3.8" class="relref">Section 3.8</a> of [<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>. Note that, after a first block-wise request which targets all servers in the group and includes the CoAP Block2 Option, following block-wise exchanges rely on unicast requests that should therefore be protected using the pairwise mode.<a href="#section-13.9-7" class="pilcrow">¶</a></p>
<p id="section-13.9-8">Editor's note: The paragraph above will have to be re-checked against the Section "Block-Wise Transfer" of <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, in order to ensure that it is aligned with that.<a href="#section-13.9-8" class="pilcrow">¶</a></p>
<p id="section-13.9-9">Additional considerations are discussed in <a href="#sec-synch-challenge-response" class="auto internal xref">Section 10</a>, with respect to requests including a CoAP Echo Option <span>[<a href="#RFC9175" class="cite xref">RFC9175</a>]</span> that have to be sent over unicast, as a challenge-response method for servers to achieve freshness or to initialize as valid a previously invalid Replay Window.<a href="#section-13.9-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-e2e-protection">
<section id="section-13.10">
        <h3 id="name-end-to-end-protection">
<a href="#section-13.10" class="section-number selfRef">13.10. </a><a href="#name-end-to-end-protection" class="section-name selfRef">End-to-end Protection</a>
        </h3>
<p id="section-13.10-1">The same considerations from <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12.1" class="relref">Section 12.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> hold for Group OSCORE.<a href="#section-13.10-1" class="pilcrow">¶</a></p>
<p id="section-13.10-2">Additionally, (D)TLS and Group OSCORE can be combined for protecting message exchanges occurring over unicast. However, it is not possible to combine (D)TLS and Group OSCORE for protecting message exchanges where messages are sent over multicast.<a href="#section-13.10-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-master-secret">
<section id="section-13.11">
        <h3 id="name-master-secret">
<a href="#section-13.11" class="section-number selfRef">13.11. </a><a href="#name-master-secret" class="section-name selfRef">Master Secret</a>
        </h3>
<p id="section-13.11-1">Group OSCORE derives the Security Context using the same construction used by OSCORE, and by using the Group Identifier of a group as the related ID Context. Hence, the same required properties of the Security Context parameters discussed in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.3" class="relref">Section 3.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> hold for this document.<a href="#section-13.11-1" class="pilcrow">¶</a></p>
<p id="section-13.11-2">With particular reference to the OSCORE Master Secret, it has to be kept secret among the members of the respective OSCORE group and the Group Manager responsible for that group. Also, the Master Secret must have a good amount of randomness, and the Group Manager can generate it offline using a good random number generator. This includes the case where the Group Manager rekeys the group by generating and distributing a new Master Secret. Randomness requirements for security are described in <span>[<a href="#RFC4086" class="cite xref">RFC4086</a>]</span>.<a href="#section-13.11-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-replay-protection">
<section id="section-13.12">
        <h3 id="name-replay-protection-2">
<a href="#section-13.12" class="section-number selfRef">13.12. </a><a href="#name-replay-protection-2" class="section-name selfRef">Replay Protection</a>
        </h3>
<p id="section-13.12-1">As in OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, also Group OSCORE relies on Sender Sequence Numbers included in the COSE message field 'Partial IV' and used to build AEAD nonces.<a href="#section-13.12-1" class="pilcrow">¶</a></p>
<p id="section-13.12-2">Note that the Partial IV of an endpoint does not necessarily grow monotonically. For instance, upon exhaustion of the endpoint's Sender Sequence Number space, the endpoint's Partial IV space also gets exhausted. As discussed in <a href="#sec-group-re-join" class="auto internal xref">Section 2.6.3</a>, this results either in the endpoint being individually rekeyed and getting a new Sender ID, or in the establishment of a new Security Context in the group. Therefore, uniqueness of (key, nonce) pairs (see <a href="#ssec-key-nonce-uniqueness" class="auto internal xref">Section 13.3</a>) is preserved also when a new Security Context is established.<a href="#section-13.12-2" class="pilcrow">¶</a></p>
<p id="section-13.12-3">Since one-to-many communication such as multicast usually involves unreliable transports, the simplification of the Replay Window to a size of 1 suggested in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-7.4" class="relref">Section 7.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> is not viable with Group OSCORE, unless exchanges in the group rely only on unicast messages.<a href="#section-13.12-3" class="pilcrow">¶</a></p>
<p id="section-13.12-4">A server's Replay Window may be initialized as invalid (see <a href="#ssec-loss-mutable-context" class="auto internal xref">Section 2.6.1</a>). The server can either retrieve a new Group OSCORE Security Context, or make a Replay Window valid (see <a href="#sec-synch-challenge-response" class="auto internal xref">Section 10</a>) before resuming to accept incoming messages from other group members.<a href="#section-13.12-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-seccons-ordering">
<section id="section-13.13">
        <h3 id="name-message-ordering">
<a href="#section-13.13" class="section-number selfRef">13.13. </a><a href="#name-message-ordering" class="section-name selfRef">Message Ordering</a>
        </h3>
<p id="section-13.13-1">Assuming that the other endpoint is honest, Group OSCORE provides relative ordering of received messages. For a given Group OSCORE Security Context, the received Partial IV (when included) allows the recipient endpoint to determine the order in which requests or responses were sent by the other endpoint.<a href="#section-13.13-1" class="pilcrow">¶</a></p>
<p id="section-13.13-2">In case the Partial IV was omitted in a response, this indicates that it was the oldest response from the sender endpoint to the corresponding request (like notification responses in OSCORE, see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-7.4.1" class="relref">Section 7.4.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>). A received response is not older than the corresponding request.<a href="#section-13.13-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-seccons-freshness">
<section id="section-13.14">
        <h3 id="name-message-freshness">
<a href="#section-13.14" class="section-number selfRef">13.14. </a><a href="#name-message-freshness" class="section-name selfRef">Message Freshness</a>
        </h3>
<p id="section-13.14-1">As in OSCORE, Group OSCORE provides only the guarantee that the request is not older than the Group OSCORE Security Context used to protect it. Other aspects of freshness are discussed in <a href="#sec-freshness" class="auto internal xref">Section 6.2</a>.<a href="#section-13.14-1" class="pilcrow">¶</a></p>
<p id="section-13.14-2">The challenge-response approach described in <a href="#sec-synch-challenge-response" class="auto internal xref">Section 10</a> provides an assurance of freshness of the request without depending on the honesty of the client. However, it can result in an impact on performance which is undesirable or unbearable, especially in large groups where many endpoints at the same time might join as new members.<a href="#section-13.14-2" class="pilcrow">¶</a></p>
<p id="section-13.14-3">Endpoints configured as silent servers are not able to perform the challenge-response described above, as they do not store a Sender Context to secure the 4.01 (Unauthorized) response to the client. Thus, silent servers should adopt alternative approaches to make their Replay Windows valid.<a href="#section-13.14-3" class="pilcrow">¶</a></p>
<p id="section-13.14-4">Since requests including the Echo Option are sent over unicast, a server can be victim of the attack discussed in <a href="#ssec-unicast-requests" class="auto internal xref">Section 13.9</a>, in case such requests are protected in group mode. Instead, protecting those requests with the pairwise mode prevents the attack above. In fact, only the very server involved in the challenge-response exchange is able to derive the pairwise key used by the client to protect the request including the Echo Option.<a href="#section-13.14-4" class="pilcrow">¶</a></p>
<p id="section-13.14-5">In either case, an internal on-path adversary would not be able to mix up the Echo Option value of two different unicast requests, sent by a same client to any two different servers in the group. In fact, even if the group mode was used, this would require the adversary to forge the countersignature of both requests. As a consequence, each of the two servers remains able to selectively accept a request with the Echo Option only if it is waiting for that exact integrity-protected Echo Option value, and is thus the intended recipient.<a href="#section-13.14-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-client-aliveness">
<section id="section-13.15">
        <h3 id="name-client-aliveness">
<a href="#section-13.15" class="section-number selfRef">13.15. </a><a href="#name-client-aliveness" class="section-name selfRef">Client Aliveness</a>
        </h3>
<p id="section-13.15-1">Like in OSCORE (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12.5" class="relref">Section 12.5</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>), a server may verify the aliveness of the client by using the CoAP Echo Option <span>[<a href="#RFC9175" class="cite xref">RFC9175</a>]</span> as described in <a href="#sec-synch-challenge-response" class="auto internal xref">Section 10</a>.<a href="#section-13.15-1" class="pilcrow">¶</a></p>
<p id="section-13.15-2">In the interest of avoiding otherwise unnecessary uses of such an approach, the server can exploit the fact that the received request cannot be older than the Security Context used to protect it. This effectively allows the server to verify the client aliveness relative to the installation of the latest group keying material.<a href="#section-13.15-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-crypto-considerations">
<section id="section-13.16">
        <h3 id="name-cryptographic-consideration">
<a href="#section-13.16" class="section-number selfRef">13.16. </a><a href="#name-cryptographic-consideration" class="section-name selfRef">Cryptographic Considerations</a>
        </h3>
<p id="section-13.16-1">The same considerations from <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12.6" class="relref">Section 12.6</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> about the maximum Sender Sequence Number hold for Group OSCORE.<a href="#section-13.16-1" class="pilcrow">¶</a></p>
<p id="section-13.16-2">As discussed in <a href="#ssec-wrap-around-partial-iv" class="auto internal xref">Section 2.6.2</a>, an endpoint that experiences an exhaustion of its own Sender Sequence Number space <span class="bcp14">MUST NOT</span> protect further messages including a Partial IV, until it has derived a new Sender Context. This prevents the endpoint to reuse the same AEAD nonce with the same Sender Key.<a href="#section-13.16-2" class="pilcrow">¶</a></p>
<p id="section-13.16-3">In order to renew its own Sender Context, the endpoint <span class="bcp14">SHOULD</span> inform the Group Manager, which can either renew the whole Security Context by means of group rekeying, or provide only that endpoint with a new Sender ID value. In either case, the endpoint derives a new Sender Context, and in particular a new Sender Key.<a href="#section-13.16-3" class="pilcrow">¶</a></p>
<p id="section-13.16-4">Additionally, the same considerations from <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12.6" class="relref">Section 12.6</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> hold for Group OSCORE, about building the AEAD nonce and the secrecy of the Security Context parameters.<a href="#section-13.16-4" class="pilcrow">¶</a></p>
<p id="section-13.16-5">The group mode uses the "encrypt-then-sign" construction, i.e., the countersignature is computed over the COSE_Encrypt0 object (see <a href="#sec-cose-object-unprotected-field" class="auto internal xref">Section 4.1</a>). This is motivated by enabling signature checkers (see <a href="#sec-additional-entities" class="auto internal xref">Section 3.3</a>), which do not join a group as members but are allowed to verify countersignatures of messages protected in group mode without being able to decrypt them (see <a href="#sec-processing-signature-checker" class="auto internal xref">Section 8.5</a>).<a href="#section-13.16-5" class="pilcrow">¶</a></p>
<p id="section-13.16-6">If the Group Encryption Algorithm used in group mode provides integrity protection, countersignatures of COSE_Encrypt0 with short authentication tags do not provide the security properties associated with the same algorithm used in COSE_Sign (see <span><a href="https://rfc-editor.org/rfc/rfc9338#section-6" class="relref">Section 6</a> of [<a href="#RFC9338" class="cite xref">RFC9338</a>]</span>). To provide 128-bit security against collision attacks, the tag length <span class="bcp14">MUST</span> be at least 256-bits. A countersignature of a COSE_Encrypt0 with AES-CCM-16-64-128 provides at most 32 bits of integrity protection.<a href="#section-13.16-6" class="pilcrow">¶</a></p>
<p id="section-13.16-7">The derivation of pairwise keys defined in <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a> is compatible with ECDSA and EdDSA asymmetric keys, but is not compatible with RSA asymmetric keys.<a href="#section-13.16-7" class="pilcrow">¶</a></p>
<p id="section-13.16-8">For the public key translation from Ed25519 (Ed448) to X25519 (X448) specified in <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a>, variable time methods can be used since the translation operates on public information. Any byte string of appropriate length is accepted as a public key for X25519 (X448) in <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>. It is therefore not necessary for security to validate the translated public key (assuming the translation was successful).<a href="#section-13.16-8" class="pilcrow">¶</a></p>
<p id="section-13.16-9">The security of using the same key pair for Diffie-Hellman and for signing (by considering the ECDH procedure in <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a> as a Key Encapsulation Mechanism (KEM)) is demonstrated in <span>[<a href="#Degabriele" class="cite xref">Degabriele</a>]</span> and <span>[<a href="#Thormarker" class="cite xref">Thormarker</a>]</span>.<a href="#section-13.16-9" class="pilcrow">¶</a></p>
<p id="section-13.16-10">Applications using ECDH (except X25519 and X448) based KEM in <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a> are assumed to verify that a peer endpoint's public key is on the expected curve and that the shared secret is not the point at infinity. The KEM in <span>[<a href="#Degabriele" class="cite xref">Degabriele</a>]</span> checks that the shared secret is different from the point at infinity, as does the procedure in Section 5.7.1.2 of <span>[<a href="#NIST-800-56A" class="cite xref">NIST-800-56A</a>]</span> which is referenced in <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a>.<a href="#section-13.16-10" class="pilcrow">¶</a></p>
<p id="section-13.16-11">By extending Theorem 2 of <span>[<a href="#Degabriele" class="cite xref">Degabriele</a>]</span>, <span>[<a href="#Thormarker" class="cite xref">Thormarker</a>]</span> shows that the same key pair can be used with X25519 and Ed25519 (X448 and Ed448) for the KEM specified in <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a>. By symmetry in the KEM used in this document, both endpoints can consider themselves to have the recipient role in the KEM - as discussed in Section 7 of <span>[<a href="#Thormarker" class="cite xref">Thormarker</a>]</span> - and rely on the mentioned proofs for the security of their key pairs.<a href="#section-13.16-11" class="pilcrow">¶</a></p>
<p id="section-13.16-12">Theorem 3 in <span>[<a href="#Degabriele" class="cite xref">Degabriele</a>]</span> shows that the same key pair can be used for an ECDH based KEM and ECDSA. The KEM uses a different KDF than in <a href="#sec-derivation-pairwise" class="auto internal xref">Section 2.5</a>, but the proof only depends on that the KDF has certain required properties, which are the typical assumptions about HKDF, e.g., that output keys are pseudorandom. In order to comply with the assumptions of Theorem 3, received public keys <span class="bcp14">MUST</span> be successfully validated, see Section 5.6.2.3.4 of <span>[<a href="#NIST-800-56A" class="cite xref">NIST-800-56A</a>]</span>. The validation <span class="bcp14">MAY</span> be performed by a trusted Group Manager. For <span>[<a href="#Degabriele" class="cite xref">Degabriele</a>]</span> to apply as it is written, public keys need to be in the expected subgroup. For this, we rely on cofactor Diffie-Hellman as per Section 5.7.1.2 of <span>[<a href="#NIST-800-56A" class="cite xref">NIST-800-56A</a>]</span>, which is referenced in <a href="#key-derivation-pairwise" class="auto internal xref">Section 2.5.1</a>.<a href="#section-13.16-12" class="pilcrow">¶</a></p>
<p id="section-13.16-13">HashEdDSA variants of Ed25519 and Ed448 are not used by COSE (see <span><a href="https://rfc-editor.org/rfc/rfc9053#section-2.2" class="relref">Section 2.2</a> of [<a href="#RFC9053" class="cite xref">RFC9053</a>]</span>), and are not covered by the analysis in <span>[<a href="#Thormarker" class="cite xref">Thormarker</a>]</span>. Hence, they <span class="bcp14">MUST NOT</span> be used with the public keys used to derive pairwise keys as specified in this document.<a href="#section-13.16-13" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-message-segmentation">
<section id="section-13.17">
        <h3 id="name-message-segmentation">
<a href="#section-13.17" class="section-number selfRef">13.17. </a><a href="#name-message-segmentation" class="section-name selfRef">Message Segmentation</a>
        </h3>
<p id="section-13.17-1">The same considerations from <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12.7" class="relref">Section 12.7</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> hold for Group OSCORE.<a href="#section-13.17-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-privacy">
<section id="section-13.18">
        <h3 id="name-privacy-considerations">
<a href="#section-13.18" class="section-number selfRef">13.18. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
        </h3>
<p id="section-13.18-1">Group OSCORE ensures end-to-end integrity protection and encryption of the message payload and of all the options that are not used for proxy operations. In particular, options are processed according to the same class U/I/E that they have for OSCORE. Therefore, the same privacy considerations from <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12.8" class="relref">Section 12.8</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> hold for Group OSCORE, with the following addition.<a href="#section-13.18-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.18-2.1">
            <p id="section-13.18-2.1.1">When protecting a message in group mode, the countersignature is encrypted by using a keystream derived from the group keying material (see <a href="#compression" class="auto internal xref">Section 5</a> and <a href="#sssec-encrypted-signature-keystream" class="auto internal xref">Section 5.1</a>). This ensures group privacy. That is, an attacker cannot track an endpoint over two groups by linking messages between the two groups, unless being also a member of those groups.<a href="#section-13.18-2.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-13.18-3">Furthermore, the following privacy considerations hold about the OSCORE Option, which may reveal information on the communicating endpoints.<a href="#section-13.18-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.18-4.1">
            <p id="section-13.18-4.1.1">The 'kid' parameter, which is intended to help a recipient endpoint to find the right Recipient Context, may reveal information about the Sender Endpoint. When both a request and the corresponding responses include the 'kid' parameter, this may reveal information about both a client sending a request and all the possibly replying servers sending their own individual response.<a href="#section-13.18-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.18-4.2">
            <p id="section-13.18-4.2.1">The 'kid context' parameter, which is intended to help a recipient endpoint to find the right Security Context, reveals information about the sender endpoint. In particular, it reveals that the sender endpoint is a member of a particular OSCORE group, whose current Group ID is indicated in the 'kid context' parameter.<a href="#section-13.18-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-13.18-5">When receiving a group request, each of the recipient endpoints can reply with a response that includes its Sender ID as 'kid' parameter. All these responses will be matchable with the request through the CoAP Token. Thus, even if these responses do not include a 'kid context' parameter, it becomes possible to understand that the responder endpoints are in the same group of the requester endpoint.<a href="#section-13.18-5" class="pilcrow">¶</a></p>
<p id="section-13.18-6">Furthermore, using the approach described in <a href="#sec-synch-challenge-response" class="auto internal xref">Section 10</a> to make Replay Windows valid may reveal when a server device goes through a reboot. This can be mitigated by the server device storing the precise state of the Replay Window of each known client on a clean shutdown.<a href="#section-13.18-6" class="pilcrow">¶</a></p>
<p id="section-13.18-7">Finally, the approach described in <a href="#ssec-gid-collision" class="auto internal xref">Section 13.6</a> to prevent collisions of Group Identifiers from different Group Managers may reveal information about events in the respective OSCORE groups. In particular, a Group Identifier changes when the corresponding group is rekeyed. Thus, Group Managers might use the shared list of Group Identifiers to infer the rate and patterns of group membership changes triggering a group rekeying, e.g., due to newly joined members or evicted (compromised) members. In order to alleviate this privacy concern, it should be hidden from the Group Managers which exact Group Manager has currently assigned which Group Identifiers in its OSCORE groups.<a href="#section-13.18-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-14">
      <h2 id="name-iana-considerations">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-14-1">Note to RFC Editor: Please replace "[RFC-XXXX]" with the RFC number of this document and delete this paragraph.<a href="#section-14-1" class="pilcrow">¶</a></p>
<p id="section-14-2">This document has the following actions for IANA.<a href="#section-14-2" class="pilcrow">¶</a></p>
<div id="iana-cons-flag-bits">
<section id="section-14.1">
        <h3 id="name-oscore-flag-bits-registry">
<a href="#section-14.1" class="section-number selfRef">14.1. </a><a href="#name-oscore-flag-bits-registry" class="section-name selfRef">OSCORE Flag Bits Registry</a>
        </h3>
<p id="section-14.1-1">IANA is asked to add the following entry to the "OSCORE Flag Bits" registry within the "Constrained RESTful Environments (CoRE) Parameters" registry group.<a href="#section-14.1-1" class="pilcrow">¶</a></p>
<span id="name-registrations-in-the-oscore"></span><div id="_table-iana-oscore-flag-bits">
<table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-registrations-in-the-oscore" class="selfRef">Registrations in the OSCORE Flag Bits Registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Bit Position</th>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">Group Flag</td>
              <td class="text-left" rowspan="1" colspan="1">For using a Group OSCORE Security Context, set to 1 if the message is protected with the group mode</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
<div id="iana-cons-oscore-option-numbers">
<section id="section-14.2">
        <h3 id="name-coap-option-numbers-registr">
<a href="#section-14.2" class="section-number selfRef">14.2. </a><a href="#name-coap-option-numbers-registr" class="section-name selfRef">CoAP Option Numbers Registry</a>
        </h3>
<p id="section-14.2-1">IANA is asked to add this document as a reference for the OSCORE Option in the "CoAP Option Numbers" registry within the "Constrained RESTful Environments (CoRE) Parameters" registry group.<a href="#section-14.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-target-attributes">
<section id="section-14.3">
        <h3 id="name-target-attributes-registry">
<a href="#section-14.3" class="section-number selfRef">14.3. </a><a href="#name-target-attributes-registry" class="section-name selfRef">Target Attributes Registry</a>
        </h3>
<p id="section-14.3-1">IANA is asked to add the following entry to the "Target Attributes" registry within the "Constrained RESTful Environments (CoRE) Parameters" registry group.<a href="#section-14.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3-2">
<pre>
Attribute Name: gosc
Brief Description: Hint: resource only accessible
                   using Group OSCORE or OSCORE
Change Controller: IETF
Reference: [RFC-XXXX]
</pre><a href="#section-14.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-15">
      <h2 id="name-references">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-15.1">
        <h3 id="name-normative-references">
<a href="#section-15.1" class="section-number selfRef">15.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-core-groupcomm-bis">[I-D.ietf-core-groupcomm-bis]</dt>
        <dd>
<span class="refAuthor">Dijk, E.</span>, <span class="refAuthor">Wang, C.</span>, and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Group Communication for the Constrained Application Protocol (CoAP)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-groupcomm-bis-11</span>, <time datetime="2024-04-24" class="refDate">24 April 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11">https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-800-56A">[NIST-800-56A]</dt>
        <dd>
<span class="refAuthor">Barker, E.</span>, <span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Roginsky, A.</span>, <span class="refAuthor">Vassilev, A.</span>, and <span class="refAuthor">R. Davis</span>, <span class="refTitle">"Recommendation for Pair-Wise Key-Establishment Schemes Using Discrete Logarithm Cryptography - NIST Special Publication 800-56A, Revision 3"</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-56Ar3.pdf">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-56Ar3.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4086">[RFC4086]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refAuthor">Schiller, J.</span>, and <span class="refAuthor">S. Crocker</span>, <span class="refTitle">"Randomness Requirements for Security"</span>, <span class="seriesInfo">BCP 106</span>, <span class="seriesInfo">RFC 4086</span>, <span class="seriesInfo">DOI 10.17487/RFC4086</span>, <time datetime="2005-06" class="refDate">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4086">https://www.rfc-editor.org/rfc/rfc4086</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6979">[RFC6979]</dt>
        <dd>
<span class="refAuthor">Pornin, T.</span>, <span class="refTitle">"Deterministic Usage of the Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA)"</span>, <span class="seriesInfo">RFC 6979</span>, <span class="seriesInfo">DOI 10.17487/RFC6979</span>, <time datetime="2013-08" class="refDate">August 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6979">https://www.rfc-editor.org/rfc/rfc6979</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7252">https://www.rfc-editor.org/rfc/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7641">[RFC7641]</dt>
        <dd>
<span class="refAuthor">Hartke, K.</span>, <span class="refTitle">"Observing Resources in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7641</span>, <span class="seriesInfo">DOI 10.17487/RFC7641</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7641">https://www.rfc-editor.org/rfc/rfc7641</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7748">[RFC7748]</dt>
        <dd>
<span class="refAuthor">Langley, A.</span>, <span class="refAuthor">Hamburg, M.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7748">https://www.rfc-editor.org/rfc/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8032">[RFC8032]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span> and <span class="refAuthor">I. Liusvaara</span>, <span class="refTitle">"Edwards-Curve Digital Signature Algorithm (EdDSA)"</span>, <span class="seriesInfo">RFC 8032</span>, <span class="seriesInfo">DOI 10.17487/RFC8032</span>, <time datetime="2017-01" class="refDate">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8032">https://www.rfc-editor.org/rfc/rfc8032</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8288">[RFC8288]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"Web Linking"</span>, <span class="seriesInfo">RFC 8288</span>, <span class="seriesInfo">DOI 10.17487/RFC8288</span>, <time datetime="2017-10" class="refDate">October 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8288">https://www.rfc-editor.org/rfc/rfc8288</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8613">https://www.rfc-editor.org/rfc/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9052">[RFC9052]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Structures and Process"</span>, <span class="seriesInfo">STD 96</span>, <span class="seriesInfo">RFC 9052</span>, <span class="seriesInfo">DOI 10.17487/RFC9052</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9052">https://www.rfc-editor.org/rfc/rfc9052</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9053">[RFC9053]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Initial Algorithms"</span>, <span class="seriesInfo">RFC 9053</span>, <span class="seriesInfo">DOI 10.17487/RFC9053</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9053">https://www.rfc-editor.org/rfc/rfc9053</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9175">[RFC9175]</dt>
        <dd>
<span class="refAuthor">Amsüss, C.</span>, <span class="refAuthor">Preuß Mattsson, J.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Constrained Application Protocol (CoAP): Echo, Request-Tag, and Token Processing"</span>, <span class="seriesInfo">RFC 9175</span>, <span class="seriesInfo">DOI 10.17487/RFC9175</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9175">https://www.rfc-editor.org/rfc/rfc9175</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9338">[RFC9338]</dt>
      <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Countersignatures"</span>, <span class="seriesInfo">STD 96</span>, <span class="seriesInfo">RFC 9338</span>, <span class="seriesInfo">DOI 10.17487/RFC9338</span>, <time datetime="2022-12" class="refDate">December 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9338">https://www.rfc-editor.org/rfc/rfc9338</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-15.2">
        <h3 id="name-informative-references">
<a href="#section-15.2" class="section-number selfRef">15.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="Degabriele">[Degabriele]</dt>
        <dd>
<span class="refAuthor">Degabriele, J. P.</span>, <span class="refAuthor">Lehmann, A.</span>, <span class="refAuthor">Paterson, K. G.</span>, <span class="refAuthor">Smart, N. P.</span>, and <span class="refAuthor">M. Strefler</span>, <span class="refTitle">"On the Joint Security of Encryption and Signature in EMV"</span>, <time datetime="2011-12" class="refDate">December 2011</time>, <span>&lt;<a href="https://eprint.iacr.org/2011/615">https://eprint.iacr.org/2011/615</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.amsuess-core-cachable-oscore">[I-D.amsuess-core-cachable-oscore]</dt>
        <dd>
<span class="refAuthor">Amsüss, C.</span> and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Cacheable OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-amsuess-core-cachable-oscore-09</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-amsuess-core-cachable-oscore-09">https://datatracker.ietf.org/doc/html/draft-amsuess-core-cachable-oscore-09</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-key-groupcomm">[I-D.ietf-ace-key-groupcomm]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span> and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Key Provisioning for Group Communication using ACE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-key-groupcomm-19</span>, <time datetime="2024-04-30" class="refDate">30 April 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-key-groupcomm-19">https://datatracker.ietf.org/doc/html/draft-ietf-ace-key-groupcomm-19</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-key-groupcomm-oscore">[I-D.ietf-ace-key-groupcomm-oscore]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Park, J.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Key Management for OSCORE Groups in ACE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-key-groupcomm-oscore-16</span>, <time datetime="2023-03-06" class="refDate">6 March 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-key-groupcomm-oscore-16">https://datatracker.ietf.org/doc/html/draft-ietf-ace-key-groupcomm-oscore-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-groupcomm-proxy">[I-D.ietf-core-groupcomm-proxy]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span> and <span class="refAuthor">E. Dijk</span>, <span class="refTitle">"Proxy Operations for CoAP Group Communication"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-groupcomm-proxy-02</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-proxy-02">https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-proxy-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-observe-multicast-notifications">[I-D.ietf-core-observe-multicast-notifications]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Höglund, R.</span>, <span class="refAuthor">Amsüss, C.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Observe Notifications as CoAP Multicast Responses"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-observe-multicast-notifications-09</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-observe-multicast-notifications-09">https://datatracker.ietf.org/doc/html/draft-ietf-core-observe-multicast-notifications-09</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-capable-proxies">[I-D.ietf-core-oscore-capable-proxies]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span> and <span class="refAuthor">R. Höglund</span>, <span class="refTitle">"OSCORE-capable Proxies"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-capable-proxies-02</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-capable-proxies-02">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-capable-proxies-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-cbor-encoded-cert">[I-D.ietf-cose-cbor-encoded-cert]</dt>
        <dd>
<span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Raza, S.</span>, <span class="refAuthor">Höglund, J.</span>, and <span class="refAuthor">M. Furuhed</span>, <span class="refTitle">"CBOR Encoded X.509 Certificates (C509 Certificates)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-cbor-encoded-cert-11</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-cose-cbor-encoded-cert-11">https://datatracker.ietf.org/doc/html/draft-ietf-cose-cbor-encoded-cert-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-iotops-security-protocol-comparison">[I-D.ietf-iotops-security-protocol-comparison]</dt>
        <dd>
<span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">M. Vučinić</span>, <span class="refTitle">"Comparison of CoAP Security Protocols"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-iotops-security-protocol-comparison-06</span>, <time datetime="2024-03-20" class="refDate">20 March 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-iotops-security-protocol-comparison-06">https://datatracker.ietf.org/doc/html/draft-ietf-iotops-security-protocol-comparison-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lwig-curve-representations">[I-D.ietf-lwig-curve-representations]</dt>
        <dd>
<span class="refAuthor">Struik, R.</span>, <span class="refTitle">"Alternative Elliptic Curve Representations"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lwig-curve-representations-23</span>, <time datetime="2022-01-21" class="refDate">21 January 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-lwig-curve-representations-23">https://datatracker.ietf.org/doc/html/draft-ietf-lwig-curve-representations-23</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.irtf-cfrg-det-sigs-with-noise">[I-D.irtf-cfrg-det-sigs-with-noise]</dt>
        <dd>
<span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Thormarker, E.</span>, and <span class="refAuthor">S. Ruohomaa</span>, <span class="refTitle">"Hedged ECDSA and EdDSA Signatures"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-det-sigs-with-noise-03</span>, <time datetime="2024-03-16" class="refDate">16 March 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-det-sigs-with-noise-03">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-det-sigs-with-noise-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4944">[RFC4944]</dt>
        <dd>
<span class="refAuthor">Montenegro, G.</span>, <span class="refAuthor">Kushalnagar, N.</span>, <span class="refAuthor">Hui, J.</span>, and <span class="refAuthor">D. Culler</span>, <span class="refTitle">"Transmission of IPv6 Packets over IEEE 802.15.4 Networks"</span>, <span class="seriesInfo">RFC 4944</span>, <span class="seriesInfo">DOI 10.17487/RFC4944</span>, <time datetime="2007-09" class="refDate">September 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4944">https://www.rfc-editor.org/rfc/rfc4944</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4949">[RFC4949]</dt>
        <dd>
<span class="refAuthor">Shirey, R.</span>, <span class="refTitle">"Internet Security Glossary, Version 2"</span>, <span class="seriesInfo">FYI 36</span>, <span class="seriesInfo">RFC 4949</span>, <span class="seriesInfo">DOI 10.17487/RFC4949</span>, <time datetime="2007-08" class="refDate">August 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4949">https://www.rfc-editor.org/rfc/rfc4949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5280">[RFC5280]</dt>
        <dd>
<span class="refAuthor">Cooper, D.</span>, <span class="refAuthor">Santesson, S.</span>, <span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Boeyen, S.</span>, <span class="refAuthor">Housley, R.</span>, and <span class="refAuthor">W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5280">https://www.rfc-editor.org/rfc/rfc5280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5869">https://www.rfc-editor.org/rfc/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6282">[RFC6282]</dt>
        <dd>
<span class="refAuthor">Hui, J., Ed.</span> and <span class="refAuthor">P. Thubert</span>, <span class="refTitle">"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"</span>, <span class="seriesInfo">RFC 6282</span>, <span class="seriesInfo">DOI 10.17487/RFC6282</span>, <time datetime="2011-09" class="refDate">September 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6282">https://www.rfc-editor.org/rfc/rfc6282</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6690">[RFC6690]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refTitle">"Constrained RESTful Environments (CoRE) Link Format"</span>, <span class="seriesInfo">RFC 6690</span>, <span class="seriesInfo">DOI 10.17487/RFC6690</span>, <time datetime="2012-08" class="refDate">August 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6690">https://www.rfc-editor.org/rfc/rfc6690</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7228">[RFC7228]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refAuthor">Ersue, M.</span>, and <span class="refAuthor">A. Keranen</span>, <span class="refTitle">"Terminology for Constrained-Node Networks"</span>, <span class="seriesInfo">RFC 7228</span>, <span class="seriesInfo">DOI 10.17487/RFC7228</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7228">https://www.rfc-editor.org/rfc/rfc7228</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7959">[RFC7959]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">Z. Shelby, Ed.</span>, <span class="refTitle">"Block-Wise Transfers in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7959</span>, <span class="seriesInfo">DOI 10.17487/RFC7959</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7959">https://www.rfc-editor.org/rfc/rfc7959</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8075">[RFC8075]</dt>
        <dd>
<span class="refAuthor">Castellani, A.</span>, <span class="refAuthor">Loreto, S.</span>, <span class="refAuthor">Rahman, A.</span>, <span class="refAuthor">Fossati, T.</span>, and <span class="refAuthor">E. Dijk</span>, <span class="refTitle">"Guidelines for Mapping Implementations: HTTP to the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 8075</span>, <span class="seriesInfo">DOI 10.17487/RFC8075</span>, <time datetime="2017-02" class="refDate">February 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8075">https://www.rfc-editor.org/rfc/rfc8075</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8392">[RFC8392]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"CBOR Web Token (CWT)"</span>, <span class="seriesInfo">RFC 8392</span>, <span class="seriesInfo">DOI 10.17487/RFC8392</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8392">https://www.rfc-editor.org/rfc/rfc8392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9147">[RFC9147]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Tschofenig, H.</span>, and <span class="refAuthor">N. Modadugu</span>, <span class="refTitle">"The Datagram Transport Layer Security (DTLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 9147</span>, <span class="seriesInfo">DOI 10.17487/RFC9147</span>, <time datetime="2022-04" class="refDate">April 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9147">https://www.rfc-editor.org/rfc/rfc9147</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9200">[RFC9200]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments Using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="seriesInfo">RFC 9200</span>, <span class="seriesInfo">DOI 10.17487/RFC9200</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9200">https://www.rfc-editor.org/rfc/rfc9200</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Thormarker">[Thormarker]</dt>
      <dd>
<span class="refAuthor">Thormarker, E.</span>, <span class="refTitle">"On using the same key pair for Ed25519 and an X25519 based KEM"</span>, <time datetime="2021-04" class="refDate">April 2021</time>, <span>&lt;<a href="https://eprint.iacr.org/2021/509">https://eprint.iacr.org/2021/509</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="sec-requirements">
<section id="appendix-A">
      <h2 id="name-assumptions-and-security-ob">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-assumptions-and-security-ob" class="section-name selfRef">Assumptions and Security Objectives</a>
      </h2>
<p id="appendix-A-1">This section presents a set of assumptions and security objectives for the protocol described in this document. The rest of this section refers to three types of groups:<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-2.1">
          <p id="appendix-A-2.1.1">Application group, i.e., a set of CoAP endpoints that share a common pool of resources.<a href="#appendix-A-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.2">
          <p id="appendix-A-2.2.1">Security group, as defined in <a href="#terminology" class="auto internal xref">Section 1.1</a> of this document. There can be a one-to-one or a one-to-many relation between security groups and application groups, and vice versa.<a href="#appendix-A-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.3">
          <p id="appendix-A-2.3.1">CoAP group, i.e., a set of CoAP endpoints where each endpoint is configured to receive one-to-many CoAP requests, e.g., sent to the group's associated IP multicast address and UDP port as defined in <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>. An endpoint may be a member of multiple CoAP groups. There can be a one-to-one or a one-to-many relation between application groups and CoAP groups. Note that a device sending a CoAP request to a CoAP group is not necessarily itself a member of that group: it is a member only if it also has a CoAP server endpoint listening to requests for this CoAP group, sent to the associated IP multicast address and port. In order to provide secure group communication, all members of a CoAP group as well as all further endpoints configured only as clients sending CoAP (multicast) requests to the CoAP group have to be member of a security group. There can be a one-to-one or a one-to-many relation between security groups and CoAP groups, and vice versa.<a href="#appendix-A-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="ssec-sec-assumptions">
<section id="appendix-A.1">
        <h3 id="name-assumptions">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-assumptions" class="section-name selfRef">Assumptions</a>
        </h3>
<p id="appendix-A.1-1">The following points are assumed to be already addressed and are out of the scope of this document.<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.1-2.1">
            <p id="appendix-A.1-2.1.1">Multicast communication topology: this document considers both 1-to-N (one sender and multiple recipients) and M-to-N (multiple senders and multiple recipients) communication topologies. The 1-to-N communication topology is the simplest group communication scenario that would serve the needs of a typical Low-power and Lossy Network (LLN). Examples of use cases that benefit from secure group communication are provided in <a href="#sec-use-cases" class="auto internal xref">Appendix B</a>.<a href="#appendix-A.1-2.1.1" class="pilcrow">¶</a></p>
<p id="appendix-A.1-2.1.2">
In a 1-to-N communication model, only a single client transmits data to the CoAP group, in the form of request messages; in an M-to-N communication model (where M and N do not necessarily have the same value), M clients transmit data to the CoAP group. According to <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>, any possible proxy entity is supposed to know about the clients. Also, every client expects and is able to handle multiple response messages associated with a same request sent to the CoAP group.<a href="#appendix-A.1-2.1.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.2">
            <p id="appendix-A.1-2.2.1">Group size: security solutions for group communication should be able to adequately support different and possibly large security groups. The group size is the current number of members in a security group. In the use cases mentioned in this document, the number of clients (normally the controlling devices) is expected to be much smaller than the number of servers (i.e., the controlled devices). A security solution for group communication that supports 1 to 50 clients would be able to properly cover the group sizes required for most use cases that are relevant for this document. The maximum group size is expected to be in the range of hundreds to thousands of devices, with large groups easier to manage if including several silent servers. Security groups larger than that should be divided into smaller independent groups. One should not assume that the set of members of a security group remains fixed. That is, the group membership is subject to changes, possibly on a frequent basis.<a href="#appendix-A.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.3">
            <p id="appendix-A.1-2.3.1">Communication with the Group Manager: an endpoint must use a secure dedicated channel when communicating with the Group Manager, also when not registered as a member of the security group.<a href="#appendix-A.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.4">
            <p id="appendix-A.1-2.4.1">Provisioning and management of Security Contexts: a Security Context must be established among the members of the security group. A secure mechanism must be used to generate, revoke and (re-)distribute keying material, communication policies and security parameters in the security group. The actual provisioning and management of the Security Context is out of the scope of this document.<a href="#appendix-A.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.5">
            <p id="appendix-A.1-2.5.1">Multicast data security cipher suite: all members of a security group must use the same cipher suite to provide authenticity, integrity and confidentiality of messages in the group. The cipher suite is specified as part of the Security Context.<a href="#appendix-A.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.6">
            <p id="appendix-A.1-2.6.1">Ensuring backward security: a new device joining the security group should not have access to any old Security Contexts used before its joining. This ensures that a new member of the security group is not able to decrypt confidential data sent before it has joined the security group. The adopted key management scheme should ensure that the Security Context is updated to ensure backward confidentiality. The actual mechanism to update the Security Context and renew the group keying material in the security group upon a new member's joining has to be defined as part of the group key management scheme.<a href="#appendix-A.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.7">
            <p id="appendix-A.1-2.7.1">Ensuring forward security: entities that leave the security group should not have access to any future Security Contexts or message exchanged within the security group after their leaving. This ensures that a former member of the security group is not able to decrypt confidential data sent within the security group anymore. Also, it ensures that a former member is not able to send protected messages to the security group anymore. The actual mechanism to update the Security Context and renew the group keying material in the security group upon a member's leaving has to be defined as part of the group key management scheme.<a href="#appendix-A.1-2.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="ssec-sec-objectives">
<section id="appendix-A.2">
        <h3 id="name-security-objectives">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-security-objectives" class="section-name selfRef">Security Objectives</a>
        </h3>
<p id="appendix-A.2-1">The protocol described in this document aims at fulfilling the following security objectives:<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-2.1">
            <p id="appendix-A.2-2.1.1">Data replay protection: request messages or response messages replayed within the security group must be detected.<a href="#appendix-A.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-2.2">
            <p id="appendix-A.2-2.2.1">Data confidentiality: messages sent within the security group shall be encrypted.<a href="#appendix-A.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-2.3">
            <p id="appendix-A.2-2.3.1">Group-level data confidentiality: the group mode provides group-level data confidentiality since messages are encrypted at a group level, i.e., in such a way that they can be decrypted by any member of the security group, but not by an external adversary or other external entities.<a href="#appendix-A.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-2.4">
            <p id="appendix-A.2-2.4.1">Pairwise data confidentiality: the pairwise mode especially provides pairwise data confidentiality, since messages are encrypted using pairwise keying material shared between any two group members, hence they can be decrypted only by the intended single recipient.<a href="#appendix-A.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-2.5">
            <p id="appendix-A.2-2.5.1">Source message authentication: messages sent within the security group shall be authenticated. That is, it is essential to ensure that a message is originated by a member of the security group in the first place, and in particular by a specific, identifiable member of the security group.<a href="#appendix-A.2-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-2.6">
            <p id="appendix-A.2-2.6.1">Message integrity: messages sent within the security group shall be integrity protected. That is, it is essential to ensure that a message has not been tampered with, either by a group member, or by an external adversary or other external entities which are not members of the security group.<a href="#appendix-A.2-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-2.7">
            <p id="appendix-A.2-2.7.1">Message ordering: it must be possible to determine the ordering of messages coming from a single sender. Like in OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, a recipient endpoint can determine the relative order of requests or responses from another sender endpoint by means of their Partial IV. It is not required to determine ordering of messages from different senders.<a href="#appendix-A.2-2.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-use-cases">
<section id="appendix-B">
      <h2 id="name-list-of-use-cases">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-list-of-use-cases" class="section-name selfRef">List of Use Cases</a>
      </h2>
<p id="appendix-B-1">Group Communication for CoAP <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span> provides the necessary background for multicast-based CoAP communication, with particular reference to low-power and lossy networks (LLNs) and resource constrained environments. The interested reader is encouraged to first read <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span> to understand the non-security related details. This section discusses a number of use cases that benefit from secure group communication, and refers to the three types of groups from <a href="#sec-requirements" class="auto internal xref">Appendix A</a>. Specific security requirements for these use cases are discussed in <a href="#sec-requirements" class="auto internal xref">Appendix A</a>.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-2.1">
          <p id="appendix-B-2.1.1">Lighting control: consider a building equipped with IP-connected lighting devices, switches, and border routers. The lighting devices acting as servers are organized into application groups and CoAP groups, according to their physical location in the building. For instance, lighting devices in a room or corridor can be configured as members of a single application group and corresponding CoAP group. Those lighting devices together with the switches acting as clients in the same room or corridor can be configured as members of the corresponding security group. Switches are then used to control the lighting devices by sending on/off/dimming commands to all lighting devices in the CoAP group, while border routers connected to an IP network backbone (which is also multicast-enabled) can be used to interconnect routers in the building. Consequently, this would also enable logical groups to be formed even if devices with a role in the lighting application may be physically in different subnets (e.g., on wired and wireless networks). Connectivity between lighting devices may be realized, for instance, by means of IPv6 and (border) routers supporting 6LoWPAN <span>[<a href="#RFC4944" class="cite xref">RFC4944</a>]</span><span>[<a href="#RFC6282" class="cite xref">RFC6282</a>]</span>. Group communication enables synchronous operation of a set of connected lights, ensuring that the light preset (e.g., dimming level or color) of a large set of luminaires are changed at the same perceived time. This is especially useful for providing a visual synchronicity of light effects to the user. As a practical guideline, events within a 200 ms interval are perceived as simultaneous by humans, which is necessary to ensure in many setups. Devices may reply back to the switches that issue on/off/dimming commands, in order to report about the execution of the requested operation (e.g., OK, failure, error) and their current operational status. In a typical lighting control scenario, a single switch is the only entity responsible for sending commands to a set of lighting devices. In more advanced lighting control use cases, an M-to-N communication topology would be required, for instance in case multiple sensors (presence or day-light) are responsible to trigger events to a set of lighting devices. Especially in professional lighting scenarios, the roles of client and server are configured by the lighting commissioner, and devices strictly follow those roles.<a href="#appendix-B-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.2">
          <p id="appendix-B-2.2.1">Integrated building control: enabling Building Automation and Control Systems (BACSs) to control multiple heating, ventilation and air-conditioning units to predefined presets. Controlled units can be organized into application groups and CoAP groups in order to reflect their physical position in the building, e.g., devices in the same room can be configured as members of a single application group and corresponding CoAP group. As a practical guideline, events within intervals of seconds are typically acceptable. Controlled units are expected to possibly reply back to the BACS issuing control commands, in order to report about the execution of the requested operation (e.g., OK, failure, error) and their current operational status.<a href="#appendix-B-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.3">
          <p id="appendix-B-2.3.1">Software and firmware updates: software and firmware updates often comprise quite a large amount of data. This can overload a Low-power and Lossy Network (LLN) that is otherwise typically used to deal with only small amounts of data, on an infrequent base. Rather than sending software and firmware updates as unicast messages to each individual device, multicasting such updated data to a larger set of devices at once displays a number of benefits. For instance, it can significantly reduce the network load and decrease the overall time latency for propagating this data to all devices. Even if the complete whole update process itself is secured, securing the individual messages is important, in case updates consist of relatively large amounts of data. In fact, checking individual received data piecemeal for tampering avoids that devices store large amounts of partially corrupted data and that they detect tampering hereof only after all data has been received. Devices receiving software and firmware updates are expected to possibly reply back, in order to provide a feedback about the execution of the update operation (e.g., OK, failure, error) and their current operational status.<a href="#appendix-B-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.4">
          <p id="appendix-B-2.4.1">Parameter and configuration update: by means of multicast communication, it is possible to update the settings of a set of similar devices, both simultaneously and efficiently. Possible parameters are related, for instance, to network load management or network access control. Devices receiving parameter and configuration updates are expected to possibly reply back, to provide a feedback about the execution of the update operation (e.g., OK, failure, error) and their current operational status.<a href="#appendix-B-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.5">
          <p id="appendix-B-2.5.1">Commissioning of Low-power and Lossy Network (LLN) systems: a commissioning device is responsible for querying all devices in the local network or a selected subset of them, in order to discover their presence, and be aware of their capabilities, default configuration, and operating conditions. Queried devices displaying similarities in their capabilities and features, or sharing a common physical location can be configured as members of a single application group and corresponding CoAP group. Queried devices are expected to reply back to the commissioning device, in order to notify their presence, and provide the requested information and their current operational status.<a href="#appendix-B-2.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.6">
          <p id="appendix-B-2.6.1">Emergency multicast: a particular emergency-related information (e.g., natural disaster) is generated and multicast by an emergency notifier, and relayed to multiple devices. The latter may reply back to the emergency notifier, in order to provide their feedback and local information related to the ongoing emergency. This kind of setups should additionally rely on a fault-tolerant multicast algorithm, such as Multicast Protocol for Low-Power and Lossy Networks (MPL).<a href="#appendix-B-2.6.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="gid-ex">
<section id="appendix-C">
      <h2 id="name-example-of-group-identifier">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-example-of-group-identifier" class="section-name selfRef">Example of Group Identifier Format</a>
      </h2>
<p id="appendix-C-1">This section provides an example of how the Group Identifier (Gid) can be specifically formatted. That is, the Gid can be composed of two parts, namely a Group Prefix and a Group Epoch.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">For each group, the Group Prefix is constant over time and is uniquely defined in the set of all the groups associated with the same Group Manager. The choice of the Group Prefix for a given group's Security Context is application specific. The size of the Group Prefix directly impact on the maximum number of distinct groups under the same Group Manager.<a href="#appendix-C-2" class="pilcrow">¶</a></p>
<p id="appendix-C-3">The Group Epoch is set to 0 upon the group's initialization, and is incremented by 1 each time new keying material, together with a new Gid, is distributed to the group in order to establish a new Security Context (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>).<a href="#appendix-C-3" class="pilcrow">¶</a></p>
<p id="appendix-C-4">As an example, a 3-byte Gid can be composed of: i) a 1-byte Group Prefix '0xb1' interpreted as a raw byte string; and ii) a 2-byte Group Epoch interpreted as an unsigned integer ranging from 0 to 65535. Then, after having established the Common Context 61532 times in the group, its Gid will assume value '0xb1f05c'.<a href="#appendix-C-4" class="pilcrow">¶</a></p>
<p id="appendix-C-5">Using an immutable Group Prefix for a group with a Group Manager that cannot reassign Gid values (see <a href="#sec-group-key-management" class="auto internal xref">Section 3.2</a>) limits the total number of rekeying instances. With a Group Manager that does reassign Gid values, it limits the maximum active number of rekeying instances that a CoAP observation <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span> can persist through. In either case, the group epoch size needs to be chosen depending on the expected rate of rekeying instances.<a href="#appendix-C-5" class="pilcrow">¶</a></p>
<p id="appendix-C-6">As discussed in <a href="#ssec-gid-collision" class="auto internal xref">Section 13.6</a>, if endpoints are deployed in multiple groups managed by different non-synchronized Group Managers, it is possible that Group Identifiers of different groups coincide at some point in time. In this case, a recipient has to handle coinciding Group Identifiers, and has to try using different Security Contexts to process an incoming message, until the right one is found and the message is correctly verified. Therefore, it is favorable that Group Identifiers from different Group Managers have a size that result in a small probability of collision. How small this probability should be is up to system designers.<a href="#appendix-C-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-document-updates">
<section id="appendix-D">
      <h2 id="name-document-updates">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-document-updates" class="section-name selfRef">Document Updates</a>
      </h2>
<p id="appendix-D-1">This section is to be removed before publishing as an RFC.<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<div id="sec-21-22">
<section id="appendix-D.1">
        <h3 id="name-version-21-to-22">
<a href="#appendix-D.1" class="section-number selfRef">D.1. </a><a href="#name-version-21-to-22" class="section-name selfRef">Version -21 to -22</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.1-1.1">
            <p id="appendix-D.1-1.1.1">Removed mentioning of the CBOR encoding of the HKDF Algorithm.<a href="#appendix-D.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.2">
            <p id="appendix-D.1-1.2.1">Rephrased consequences on loss of Recipient Contexts.<a href="#appendix-D.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.3">
            <p id="appendix-D.1-1.3.1">Removed requirement on 0 as initial value of the Key Generation Number.<a href="#appendix-D.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.4">
            <p id="appendix-D.1-1.4.1">Improved handling of responses from a server that changes Sender ID.<a href="#appendix-D.1-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.5">
            <p id="appendix-D.1-1.5.1">Relax constrictions of Block-wise with group communication.<a href="#appendix-D.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.6">
            <p id="appendix-D.1-1.6.1">Removed the concept of synchronization with the Client's Sender Sequence Number.<a href="#appendix-D.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.7">
            <p id="appendix-D.1-1.7.1">Improved content on Challenge-Response based freshness and Replay Window recovery.<a href="#appendix-D.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.8">
            <p id="appendix-D.1-1.8.1">Use the acronym CCSs for CWT Claims Sets.<a href="#appendix-D.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.9">
            <p id="appendix-D.1-1.9.1">Mentioned wrap-around of the Key Generation Number.<a href="#appendix-D.1-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.10">
            <p id="appendix-D.1-1.10.1">Added IANA consideration on the "CoAP Option Numbers" registry.<a href="#appendix-D.1-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.11">
            <p id="appendix-D.1-1.11.1">Updated references.<a href="#appendix-D.1-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.12">
            <p id="appendix-D.1-1.12.1">Editorial improvements.<a href="#appendix-D.1-1.12.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-20-21">
<section id="appendix-D.2">
        <h3 id="name-version-20-to-21">
<a href="#appendix-D.2" class="section-number selfRef">D.2. </a><a href="#name-version-20-to-21" class="section-name selfRef">Version -20 to -21</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.2-1.1">
            <p id="appendix-D.2-1.1.1">Updated author list.<a href="#appendix-D.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.2">
            <p id="appendix-D.2-1.2.1">Terminology: improved definition of "group request".<a href="#appendix-D.2-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.3">
            <p id="appendix-D.2-1.3.1">Editorial: removed quotation marks when using the CBOR simple values true, false, and null.<a href="#appendix-D.2-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.4">
            <p id="appendix-D.2-1.4.1">Editorial: expanded name of the "CoRE Parameters" registry group.<a href="#appendix-D.2-1.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-19-20">
<section id="appendix-D.3">
        <h3 id="name-version-19-to-20">
<a href="#appendix-D.3" class="section-number selfRef">D.3. </a><a href="#name-version-19-to-20" class="section-name selfRef">Version -19 to -20</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.3-1.1">
            <p id="appendix-D.3-1.1.1">Change Controller for the target attribute "gosc" set to "IETF".<a href="#appendix-D.3-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-18-19">
<section id="appendix-D.4">
        <h3 id="name-version-18-to-19">
<a href="#appendix-D.4" class="section-number selfRef">D.4. </a><a href="#name-version-18-to-19" class="section-name selfRef">Version -18 to -19</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.4-1.1">
            <p id="appendix-D.4-1.1.1">Unified presentation of handling of multiple responses.<a href="#appendix-D.4-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.2">
            <p id="appendix-D.4-1.2.1">Added Rikard Höglund as Contributor.<a href="#appendix-D.4-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-17-18">
<section id="appendix-D.5">
        <h3 id="name-version-17-to-18">
<a href="#appendix-D.5" class="section-number selfRef">D.5. </a><a href="#name-version-17-to-18" class="section-name selfRef">Version -17 to -18</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.5-1.1">
            <p id="appendix-D.5-1.1.1">Changed document title.<a href="#appendix-D.5-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.2">
            <p id="appendix-D.5-1.2.1">Possible use with CoAP-mappable HTTP.<a href="#appendix-D.5-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.3">
            <p id="appendix-D.5-1.3.1">Added Common Context parameter "Authentication Credential Format".<a href="#appendix-D.5-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.4">
            <p id="appendix-D.5-1.4.1">Renamed "Group Encryption Key" to "Signature Encryption Key". Consistent fixes in its derivation.<a href="#appendix-D.5-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.5">
            <p id="appendix-D.5-1.5.1">Renamed "Signature Encryption Algorithm" to "Group Encryption Algorithm".<a href="#appendix-D.5-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.6">
            <p id="appendix-D.5-1.6.1">Ensured a single Common IV, also when the two encryption algorithms have different AEAD nonce sizes.<a href="#appendix-D.5-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.7">
            <p id="appendix-D.5-1.7.1">Guidelines on the Pairwise Key Agreement Algorithm and derivation of the Diffie-Hellman secret.<a href="#appendix-D.5-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.8">
            <p id="appendix-D.5-1.8.1">The possible use of a mode follows from the set parameters.<a href="#appendix-D.5-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.9">
            <p id="appendix-D.5-1.9.1">The Group Manager is always present; 'gm_cred' in the external_aad cannot be null anymore.<a href="#appendix-D.5-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.10">
            <p id="appendix-D.5-1.10.1">The authentication credential of the Group Manager can have a different format than that of the group members'.<a href="#appendix-D.5-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.11">
            <p id="appendix-D.5-1.11.1">Set-up of new endpoints moved to document body.<a href="#appendix-D.5-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.12">
            <p id="appendix-D.5-1.12.1">The encrypted countersignature is a result of the header compression, not of COSE.<a href="#appendix-D.5-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.13">
            <p id="appendix-D.5-1.13.1">Revised examples of compressed and non-compressed COSE object.<a href="#appendix-D.5-1.13.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.14">
            <p id="appendix-D.5-1.14.1">Removed excessive requirements on group rekeying scheduling.<a href="#appendix-D.5-1.14.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.15">
            <p id="appendix-D.5-1.15.1">More considerations on the strictness of group key management.<a href="#appendix-D.5-1.15.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.16">
            <p id="appendix-D.5-1.16.1">Clearer alternatives on retaining an old Security Context.<a href="#appendix-D.5-1.16.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.17">
            <p id="appendix-D.5-1.17.1">Revised used of terminology on freshness.<a href="#appendix-D.5-1.17.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.18">
            <p id="appendix-D.5-1.18.1">Clarifications, fixes and editorial improvements.<a href="#appendix-D.5-1.18.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-16-17">
<section id="appendix-D.6">
        <h3 id="name-version-16-to-17">
<a href="#appendix-D.6" class="section-number selfRef">D.6. </a><a href="#name-version-16-to-17" class="section-name selfRef">Version -16 to -17</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.6-1.1">
            <p id="appendix-D.6-1.1.1">Definition and registration of the target attribute "gosc".<a href="#appendix-D.6-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.2">
            <p id="appendix-D.6-1.2.1">Reference update and editorial fixes.<a href="#appendix-D.6-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-15-16">
<section id="appendix-D.7">
        <h3 id="name-version-15-to-16">
<a href="#appendix-D.7" class="section-number selfRef">D.7. </a><a href="#name-version-15-to-16" class="section-name selfRef">Version -15 to -16</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.7-1.1">
            <p id="appendix-D.7-1.1.1">Clients "<span class="bcp14">SHOULD</span>" use the group mode for one-to-many requests.<a href="#appendix-D.7-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.2">
            <p id="appendix-D.7-1.2.1">Handling of multiple non-notification responses.<a href="#appendix-D.7-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.3">
            <p id="appendix-D.7-1.3.1">Revised presentation of security properties.<a href="#appendix-D.7-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.4">
            <p id="appendix-D.7-1.4.1">Improved listing of operations defined for the group mode that are inherited by the pairwise mode.<a href="#appendix-D.7-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.5">
            <p id="appendix-D.7-1.5.1">Editorial improvements.<a href="#appendix-D.7-1.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-14-15">
<section id="appendix-D.8">
        <h3 id="name-version-14-to-15">
<a href="#appendix-D.8" class="section-number selfRef">D.8. </a><a href="#name-version-14-to-15" class="section-name selfRef">Version -14 to -15</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.8-1.1">
            <p id="appendix-D.8-1.1.1">Updated references and editorial fixes.<a href="#appendix-D.8-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-13-14">
<section id="appendix-D.9">
        <h3 id="name-version-13-to-14">
<a href="#appendix-D.9" class="section-number selfRef">D.9. </a><a href="#name-version-13-to-14" class="section-name selfRef">Version -13 to -14</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.9-1.1">
            <p id="appendix-D.9-1.1.1">Replaced "node" with "endpoint" where appropriate.<a href="#appendix-D.9-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.2">
            <p id="appendix-D.9-1.2.1">Replaced "owning" with "storing" (of keying material).<a href="#appendix-D.9-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.3">
            <p id="appendix-D.9-1.3.1">Distinction between "authentication credential" and "public key".<a href="#appendix-D.9-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.4">
            <p id="appendix-D.9-1.4.1">Considerations on storing whole authentication credentials.<a href="#appendix-D.9-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.5">
            <p id="appendix-D.9-1.5.1">Considerations on Denial of Service.<a href="#appendix-D.9-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.6">
            <p id="appendix-D.9-1.6.1">Recycling of Group IDs by tracking the "Birth Gid" of each group
member is now optional to support and use for the Group Manager.<a href="#appendix-D.9-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.7">
            <p id="appendix-D.9-1.7.1">Fine-grained suppression of error responses.<a href="#appendix-D.9-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.8">
            <p id="appendix-D.9-1.8.1">Changed section title "Mandatory-to-Implement Compliance Requirements" to "Implementation Compliance".<a href="#appendix-D.9-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.9">
            <p id="appendix-D.9-1.9.1">"Challenge-Response Synchronization" moved to the document body.<a href="#appendix-D.9-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.10">
            <p id="appendix-D.9-1.10.1">RFC 7641 and draft-ietf-core-echo-request-tag as normative references.<a href="#appendix-D.9-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.11">
            <p id="appendix-D.9-1.11.1">Clarifications and editorial improvements.<a href="#appendix-D.9-1.11.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-12-13">
<section id="appendix-D.10">
        <h3 id="name-version-12-to-13">
<a href="#appendix-D.10" class="section-number selfRef">D.10. </a><a href="#name-version-12-to-13" class="section-name selfRef">Version -12 to -13</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.10-1.1">
            <p id="appendix-D.10-1.1.1">Fixes in the derivation of the Group Encryption Key.<a href="#appendix-D.10-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.10-1.2">
            <p id="appendix-D.10-1.2.1">Added Mandatory-to-Implement compliance requirements.<a href="#appendix-D.10-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.10-1.3">
            <p id="appendix-D.10-1.3.1">Changed UCCS to CCS.<a href="#appendix-D.10-1.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-11-12">
<section id="appendix-D.11">
        <h3 id="name-version-11-to-12">
<a href="#appendix-D.11" class="section-number selfRef">D.11. </a><a href="#name-version-11-to-12" class="section-name selfRef">Version -11 to -12</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.11-1.1">
            <p id="appendix-D.11-1.1.1">No mode of operation is mandatory to support.<a href="#appendix-D.11-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.2">
            <p id="appendix-D.11-1.2.1">Revised parameters of the Security Context, COSE object and external_aad.<a href="#appendix-D.11-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.3">
            <p id="appendix-D.11-1.3.1">Revised management of keying material for the Group Manager.<a href="#appendix-D.11-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.4">
            <p id="appendix-D.11-1.4.1">Informing of former members when rekeying the group.<a href="#appendix-D.11-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.5">
            <p id="appendix-D.11-1.5.1">Admit encryption-only algorithms in group mode.<a href="#appendix-D.11-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.6">
            <p id="appendix-D.11-1.6.1">Encrypted countersignature through a keystream.<a href="#appendix-D.11-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.7">
            <p id="appendix-D.11-1.7.1">Added public key of the Group Manager as key material and protected data.<a href="#appendix-D.11-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.8">
            <p id="appendix-D.11-1.8.1">Clarifications about message processing, especially notifications.<a href="#appendix-D.11-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.9">
            <p id="appendix-D.11-1.9.1">Guidance for message processing of external signature checkers.<a href="#appendix-D.11-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.10">
            <p id="appendix-D.11-1.10.1">Updated derivation of pairwise keys, with more security considerations.<a href="#appendix-D.11-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.11">
            <p id="appendix-D.11-1.11.1">Termination of ongoing observations as client, upon leaving or before re-joining the group.<a href="#appendix-D.11-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.12">
            <p id="appendix-D.11-1.12.1">Recycling Group IDs by tracking the "Birth Gid" of each group member.<a href="#appendix-D.11-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.13">
            <p id="appendix-D.11-1.13.1">Expanded security and privacy considerations about the group mode.<a href="#appendix-D.11-1.13.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.14">
            <p id="appendix-D.11-1.14.1">Removed appendices on skipping signature verification and on COSE capabilities.<a href="#appendix-D.11-1.14.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.15">
            <p id="appendix-D.11-1.15.1">Fixes and editorial improvements.<a href="#appendix-D.11-1.15.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-10-11">
<section id="appendix-D.12">
        <h3 id="name-version-10-to-11">
<a href="#appendix-D.12" class="section-number selfRef">D.12. </a><a href="#name-version-10-to-11" class="section-name selfRef">Version -10 to -11</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.12-1.1">
            <p id="appendix-D.12-1.1.1">Loss of Recipient Contexts due to their overflow.<a href="#appendix-D.12-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.2">
            <p id="appendix-D.12-1.2.1">Added diagram on keying material components and their relation.<a href="#appendix-D.12-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.3">
            <p id="appendix-D.12-1.3.1">Distinction between anti-replay and freshness.<a href="#appendix-D.12-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.4">
            <p id="appendix-D.12-1.4.1">Preservation of Sender IDs over rekeying.<a href="#appendix-D.12-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.5">
            <p id="appendix-D.12-1.5.1">Clearer cause-effect about reset of SSN.<a href="#appendix-D.12-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.6">
            <p id="appendix-D.12-1.6.1">The GM provides public keys of group members with associated Sender IDs.<a href="#appendix-D.12-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.7">
            <p id="appendix-D.12-1.7.1">Removed 'par_countersign_key' from the external_aad.<a href="#appendix-D.12-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.8">
            <p id="appendix-D.12-1.8.1">One single format for the external_aad, both for encryption and signing.<a href="#appendix-D.12-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.9">
            <p id="appendix-D.12-1.9.1">Presence of 'kid' in responses to requests protected in pairwise mode.<a href="#appendix-D.12-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.10">
            <p id="appendix-D.12-1.10.1">Inclusion of 'kid_context' in notifications following a group rekeying.<a href="#appendix-D.12-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.11">
            <p id="appendix-D.12-1.11.1">Pairwise mode presented with OSCORE as baseline.<a href="#appendix-D.12-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.12">
            <p id="appendix-D.12-1.12.1">Revised examples with signature values.<a href="#appendix-D.12-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.13">
            <p id="appendix-D.12-1.13.1">Decoupled growth of clients' Sender Sequence Numbers and loss of synchronization for server.<a href="#appendix-D.12-1.13.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.14">
            <p id="appendix-D.12-1.14.1">Sender IDs not recycled in the group under the same Gid.<a href="#appendix-D.12-1.14.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.15">
            <p id="appendix-D.12-1.15.1">Processing and description of the Group Flag bit in the OSCORE Option.<a href="#appendix-D.12-1.15.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.16">
            <p id="appendix-D.12-1.16.1">Usage of the pairwise mode for multicast requests.<a href="#appendix-D.12-1.16.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.17">
            <p id="appendix-D.12-1.17.1">Clarifications on synchronization using the Echo Option.<a href="#appendix-D.12-1.17.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.18">
            <p id="appendix-D.12-1.18.1">General format of context parameters and external_aad elements, supporting future registered COSE algorithms (new Appendix).<a href="#appendix-D.12-1.18.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.19">
            <p id="appendix-D.12-1.19.1">Fixes and editorial improvements.<a href="#appendix-D.12-1.19.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-09-10">
<section id="appendix-D.13">
        <h3 id="name-version-09-to-10">
<a href="#appendix-D.13" class="section-number selfRef">D.13. </a><a href="#name-version-09-to-10" class="section-name selfRef">Version -09 to -10</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.13-1.1">
            <p id="appendix-D.13-1.1.1">Removed 'Counter Signature Key Parameters' from the Common Context.<a href="#appendix-D.13-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.2">
            <p id="appendix-D.13-1.2.1">New parameters in the Common Context covering the DH secret derivation.<a href="#appendix-D.13-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.3">
            <p id="appendix-D.13-1.3.1">New countersignature header parameter from draft-ietf-cose-countersign.<a href="#appendix-D.13-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.4">
            <p id="appendix-D.13-1.4.1">Stronger policies non non-recycling of Sender IDs and Gid.<a href="#appendix-D.13-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.5">
            <p id="appendix-D.13-1.5.1">The Sender Sequence Number is reset when establishing a new Security Context.<a href="#appendix-D.13-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.6">
            <p id="appendix-D.13-1.6.1">Added 'request_kid_context' in the aad_array.<a href="#appendix-D.13-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.7">
            <p id="appendix-D.13-1.7.1">The server can respond with 5.03 if the client's public key is not available.<a href="#appendix-D.13-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.8">
            <p id="appendix-D.13-1.8.1">The observer client stores an invariant identifier of the group.<a href="#appendix-D.13-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.9">
            <p id="appendix-D.13-1.9.1">Relaxed storing of original 'kid' for observer clients.<a href="#appendix-D.13-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.10">
            <p id="appendix-D.13-1.10.1">Both client and server store the 'kid_context' of the original observation request.<a href="#appendix-D.13-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.11">
            <p id="appendix-D.13-1.11.1">The server uses a fresh PIV if protecting the response with a Security Context different from the one used to protect the request.<a href="#appendix-D.13-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.12">
            <p id="appendix-D.13-1.12.1">Clarifications on MTI algorithms and curves.<a href="#appendix-D.13-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.13">
            <p id="appendix-D.13-1.13.1">Removed optimized requests.<a href="#appendix-D.13-1.13.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.14">
            <p id="appendix-D.13-1.14.1">Overall clarifications and editorial revision.<a href="#appendix-D.13-1.14.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-08-09">
<section id="appendix-D.14">
        <h3 id="name-version-08-to-09">
<a href="#appendix-D.14" class="section-number selfRef">D.14. </a><a href="#name-version-08-to-09" class="section-name selfRef">Version -08 to -09</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.14-1.1">
            <p id="appendix-D.14-1.1.1">Pairwise keys are discarded after group rekeying.<a href="#appendix-D.14-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.2">
            <p id="appendix-D.14-1.2.1">Signature mode renamed to group mode.<a href="#appendix-D.14-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.3">
            <p id="appendix-D.14-1.3.1">The parameters for countersignatures use the updated COSE registries. Newly defined IANA registries have been removed.<a href="#appendix-D.14-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.4">
            <p id="appendix-D.14-1.4.1">Pairwise Flag bit renamed as Group Flag bit, set to 1 in group mode and set to 0 in pairwise mode.<a href="#appendix-D.14-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.5">
            <p id="appendix-D.14-1.5.1">Dedicated section on updating the Security Context.<a href="#appendix-D.14-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.6">
            <p id="appendix-D.14-1.6.1">By default, sender sequence numbers and replay windows are not reset upon group rekeying.<a href="#appendix-D.14-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.7">
            <p id="appendix-D.14-1.7.1">An endpoint implementing only a silent server does not support the pairwise mode.<a href="#appendix-D.14-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.8">
            <p id="appendix-D.14-1.8.1">Separate section on general message reception.<a href="#appendix-D.14-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.9">
            <p id="appendix-D.14-1.9.1">Pairwise mode moved to the document body.<a href="#appendix-D.14-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.10">
            <p id="appendix-D.14-1.10.1">Considerations on using the pairwise mode in non-multicast settings.<a href="#appendix-D.14-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.11">
            <p id="appendix-D.14-1.11.1">Optimized requests are moved as an appendix.<a href="#appendix-D.14-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.12">
            <p id="appendix-D.14-1.12.1">Normative support for the signature and pairwise mode.<a href="#appendix-D.14-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.13">
            <p id="appendix-D.14-1.13.1">Revised methods for synchronization with clients' sender sequence number.<a href="#appendix-D.14-1.13.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.14">
            <p id="appendix-D.14-1.14.1">Appendix with example values of parameters for countersignatures.<a href="#appendix-D.14-1.14.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.14-1.15">
            <p id="appendix-D.14-1.15.1">Clarifications and editorial improvements.<a href="#appendix-D.14-1.15.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-07-08">
<section id="appendix-D.15">
        <h3 id="name-version-07-to-08">
<a href="#appendix-D.15" class="section-number selfRef">D.15. </a><a href="#name-version-07-to-08" class="section-name selfRef">Version -07 to -08</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.15-1.1">
            <p id="appendix-D.15-1.1.1">Clarified relation between pairwise mode and group communication (Section 1).<a href="#appendix-D.15-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.2">
            <p id="appendix-D.15-1.2.1">Improved definition of "silent server" (Section 1.1).<a href="#appendix-D.15-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.3">
            <p id="appendix-D.15-1.3.1">Clarified when a Recipient Context is needed (Section 2).<a href="#appendix-D.15-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.4">
            <p id="appendix-D.15-1.4.1">Signature checkers as entities supported by the Group Manager (Section 2.3).<a href="#appendix-D.15-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.5">
            <p id="appendix-D.15-1.5.1">Clarified that the Group Manager is under exclusive control of Gid and Sender ID values in a group, with Sender ID values under each Gid value (Section 2.3).<a href="#appendix-D.15-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.6">
            <p id="appendix-D.15-1.6.1">Mitigation policies in case of recycled 'kid' values (Section 2.4).<a href="#appendix-D.15-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.7">
            <p id="appendix-D.15-1.7.1">More generic exhaustion (not necessarily wrap-around) of sender sequence numbers (Sections 2.5 and 10.11).<a href="#appendix-D.15-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.8">
            <p id="appendix-D.15-1.8.1">Pairwise key considerations, as to group rekeying and Sender Sequence Numbers (Section 3).<a href="#appendix-D.15-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.9">
            <p id="appendix-D.15-1.9.1">Added reference to static-static Diffie-Hellman shared secret (Section 3).<a href="#appendix-D.15-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.10">
            <p id="appendix-D.15-1.10.1">Note for implementation about the external_aad for signing (Sectino 4.3.2).<a href="#appendix-D.15-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.11">
            <p id="appendix-D.15-1.11.1">Retransmission by the application for group requests over multicast as Non-confirmable (Section 7).<a href="#appendix-D.15-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.12">
            <p id="appendix-D.15-1.12.1">A server <span class="bcp14">MUST</span> use its own Partial IV in a response, if protecting it with a different context than the one used for the request (Section 7.3).<a href="#appendix-D.15-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.13">
            <p id="appendix-D.15-1.13.1">Security considerations: encryption of pairwise mode as alternative to group-level security (Section 10.1).<a href="#appendix-D.15-1.13.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.14">
            <p id="appendix-D.15-1.14.1">Security considerations: added approach to reduce the chance of global collisions of Gid values from different Group Managers (Section 10.5).<a href="#appendix-D.15-1.14.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.15">
            <p id="appendix-D.15-1.15.1">Security considerations: added implications for block-wise transfers when using the signature mode for requests over unicast (Section 10.7).<a href="#appendix-D.15-1.15.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.16">
            <p id="appendix-D.15-1.16.1">Security considerations: (multiple) supported signature algorithms (Section 10.13).<a href="#appendix-D.15-1.16.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.17">
            <p id="appendix-D.15-1.17.1">Security considerations: added privacy considerations on the approach for reducing global collisions of Gid values (Section 10.15).<a href="#appendix-D.15-1.17.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.18">
            <p id="appendix-D.15-1.18.1">Updates to the methods for synchronizing with clients' sequence number (Appendix E).<a href="#appendix-D.15-1.18.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.19">
            <p id="appendix-D.15-1.19.1">Simplified text on discovery services supporting the pairwise mode (Appendix G.1).<a href="#appendix-D.15-1.19.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.15-1.20">
            <p id="appendix-D.15-1.20.1">Editorial improvements.<a href="#appendix-D.15-1.20.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-06-07">
<section id="appendix-D.16">
        <h3 id="name-version-06-to-07">
<a href="#appendix-D.16" class="section-number selfRef">D.16. </a><a href="#name-version-06-to-07" class="section-name selfRef">Version -06 to -07</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.16-1.1">
            <p id="appendix-D.16-1.1.1">Updated abstract and introduction.<a href="#appendix-D.16-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.2">
            <p id="appendix-D.16-1.2.1">Clarifications of what pertains a group rekeying.<a href="#appendix-D.16-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.3">
            <p id="appendix-D.16-1.3.1">Derivation of pairwise keying material.<a href="#appendix-D.16-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.4">
            <p id="appendix-D.16-1.4.1">Content re-organization for COSE Object and OSCORE header compression.<a href="#appendix-D.16-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.5">
            <p id="appendix-D.16-1.5.1">Defined the Pairwise Flag bit for the OSCORE Option.<a href="#appendix-D.16-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.6">
            <p id="appendix-D.16-1.6.1">Supporting CoAP Observe for group requests and responses.<a href="#appendix-D.16-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.7">
            <p id="appendix-D.16-1.7.1">Considerations on message protection across switching to new keying material.<a href="#appendix-D.16-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.8">
            <p id="appendix-D.16-1.8.1">New optimized mode based on pairwise keying material.<a href="#appendix-D.16-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.9">
            <p id="appendix-D.16-1.9.1">More considerations on replay protection and Security Contexts upon key renewal.<a href="#appendix-D.16-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.10">
            <p id="appendix-D.16-1.10.1">Security considerations on Group OSCORE for unicast requests, also as affecting the usage of the Echo Option.<a href="#appendix-D.16-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.11">
            <p id="appendix-D.16-1.11.1">Clarification on different types of groups considered (application/security/CoAP).<a href="#appendix-D.16-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.12">
            <p id="appendix-D.16-1.12.1">New pairwise mode, using pairwise keying material for both requests and responses.<a href="#appendix-D.16-1.12.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-05-06">
<section id="appendix-D.17">
        <h3 id="name-version-05-to-06">
<a href="#appendix-D.17" class="section-number selfRef">D.17. </a><a href="#name-version-05-to-06" class="section-name selfRef">Version -05 to -06</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.17-1.1">
            <p id="appendix-D.17-1.1.1">Group IDs mandated to be unique under the same Group Manager.<a href="#appendix-D.17-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.17-1.2">
            <p id="appendix-D.17-1.2.1">Clarifications on parameter update upon group rekeying.<a href="#appendix-D.17-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.17-1.3">
            <p id="appendix-D.17-1.3.1">Updated external_aad structures.<a href="#appendix-D.17-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.17-1.4">
            <p id="appendix-D.17-1.4.1">Dynamic derivation of Recipient Contexts made optional and application specific.<a href="#appendix-D.17-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.17-1.5">
            <p id="appendix-D.17-1.5.1">Optional 4.00 response for failed signature verification on the server.<a href="#appendix-D.17-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.17-1.6">
            <p id="appendix-D.17-1.6.1">Removed client handling of duplicated responses to multicast requests.<a href="#appendix-D.17-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.17-1.7">
            <p id="appendix-D.17-1.7.1">Additional considerations on public key retrieval and group rekeying.<a href="#appendix-D.17-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.17-1.8">
            <p id="appendix-D.17-1.8.1">Added Group Manager responsibility on validating public keys.<a href="#appendix-D.17-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.17-1.9">
            <p id="appendix-D.17-1.9.1">Updates IANA registries.<a href="#appendix-D.17-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.17-1.10">
            <p id="appendix-D.17-1.10.1">Reference to RFC 8613.<a href="#appendix-D.17-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.17-1.11">
            <p id="appendix-D.17-1.11.1">Editorial improvements.<a href="#appendix-D.17-1.11.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-04-05">
<section id="appendix-D.18">
        <h3 id="name-version-04-to-05">
<a href="#appendix-D.18" class="section-number selfRef">D.18. </a><a href="#name-version-04-to-05" class="section-name selfRef">Version -04 to -05</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.18-1.1">
            <p id="appendix-D.18-1.1.1">Added references to draft-dijk-core-groupcomm-bis.<a href="#appendix-D.18-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.18-1.2">
            <p id="appendix-D.18-1.2.1">New parameter Counter Signature Key Parameters (Section 2).<a href="#appendix-D.18-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.18-1.3">
            <p id="appendix-D.18-1.3.1">Clarification about Recipient Contexts (Section 2).<a href="#appendix-D.18-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.18-1.4">
            <p id="appendix-D.18-1.4.1">Two different external_aad for encrypting and signing (Section 3.1).<a href="#appendix-D.18-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.18-1.5">
            <p id="appendix-D.18-1.5.1">Updated response verification to handle Observe notifications (Section 6.4).<a href="#appendix-D.18-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.18-1.6">
            <p id="appendix-D.18-1.6.1">Extended Security Considerations (Section 8).<a href="#appendix-D.18-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.18-1.7">
            <p id="appendix-D.18-1.7.1">New "Counter Signature Key Parameters" IANA Registry (Section 9.2).<a href="#appendix-D.18-1.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-03-04">
<section id="appendix-D.19">
        <h3 id="name-version-03-to-04">
<a href="#appendix-D.19" class="section-number selfRef">D.19. </a><a href="#name-version-03-to-04" class="section-name selfRef">Version -03 to -04</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.19-1.1">
            <p id="appendix-D.19-1.1.1">Added the new "Counter Signature Parameters" in the Common Context (see Section 2).<a href="#appendix-D.19-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.2">
            <p id="appendix-D.19-1.2.1">Added recommendation on using "deterministic ECDSA" if ECDSA is used as countersignature algorithm (see Section 2).<a href="#appendix-D.19-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.3">
            <p id="appendix-D.19-1.3.1">Clarified possible asynchronous retrieval of keying material from the Group Manager, in order to process incoming messages (see Section 2).<a href="#appendix-D.19-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.4">
            <p id="appendix-D.19-1.4.1">Structured Section 3 into subsections.<a href="#appendix-D.19-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.5">
            <p id="appendix-D.19-1.5.1">Added the new 'par_countersign' to the aad_array of the external_aad (see Section 3.1).<a href="#appendix-D.19-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.6">
            <p id="appendix-D.19-1.6.1">Clarified non reliability of 'kid' as identity identifier for a group member (see Section 2.1).<a href="#appendix-D.19-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.7">
            <p id="appendix-D.19-1.7.1">Described possible provisioning of new Sender ID in case of Partial IV wrap-around (see Section 2.2).<a href="#appendix-D.19-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.8">
            <p id="appendix-D.19-1.8.1">The former signature bit in the Flag Byte of the OSCORE Option value is reverted to reserved (see Section 4.1).<a href="#appendix-D.19-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.9">
            <p id="appendix-D.19-1.9.1">Updated examples of compressed COSE object, now with the sixth less significant bit in the Flag Byte of the OSCORE Option value set to 0 (see Section 4.3).<a href="#appendix-D.19-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.10">
            <p id="appendix-D.19-1.10.1">Relaxed statements on sending error messages (see Section 6).<a href="#appendix-D.19-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.11">
            <p id="appendix-D.19-1.11.1">Added explicit step on computing the countersignature for outgoing messages (see Sections 6.1 and 6.3).<a href="#appendix-D.19-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.12">
            <p id="appendix-D.19-1.12.1">Handling of just created Recipient Contexts in case of unsuccessful message verification (see Sections 6.2 and 6.4).<a href="#appendix-D.19-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.13">
            <p id="appendix-D.19-1.13.1">Handling of replied/repeated responses on the client (see Section 6.4).<a href="#appendix-D.19-1.13.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.14">
            <p id="appendix-D.19-1.14.1">New IANA Registry "Counter Signature Parameters" (see Section 9.1).<a href="#appendix-D.19-1.14.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-02-03">
<section id="appendix-D.20">
        <h3 id="name-version-02-to-03">
<a href="#appendix-D.20" class="section-number selfRef">D.20. </a><a href="#name-version-02-to-03" class="section-name selfRef">Version -02 to -03</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.20-1.1">
            <p id="appendix-D.20-1.1.1">Revised structure and phrasing for improved readability and better alignment with draft-ietf-core-object-security.<a href="#appendix-D.20-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.2">
            <p id="appendix-D.20-1.2.1">Added discussion on wrap-Around of Partial IVs (see Section 2.2).<a href="#appendix-D.20-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.3">
            <p id="appendix-D.20-1.3.1">Separate sections for the COSE Object (Section 3) and the OSCORE Header Compression (Section 4).<a href="#appendix-D.20-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.4">
            <p id="appendix-D.20-1.4.1">The countersignature is now appended to the encrypted payload of the OSCORE message, rather than included in the OSCORE Option (see Section 4).<a href="#appendix-D.20-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.5">
            <p id="appendix-D.20-1.5.1">Extended scope of Section 5, now titled " Message Binding, Sequence Numbers, Freshness and Replay Protection".<a href="#appendix-D.20-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.6">
            <p id="appendix-D.20-1.6.1">Clarifications about Non-confirmable messages in Section 5.1 "Synchronization of Sender Sequence Numbers".<a href="#appendix-D.20-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.7">
            <p id="appendix-D.20-1.7.1">Clarifications about error handling in Section 6 "Message Processing".<a href="#appendix-D.20-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.8">
            <p id="appendix-D.20-1.8.1">Compacted list of responsibilities of the Group Manager in Section 7.<a href="#appendix-D.20-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.9">
            <p id="appendix-D.20-1.9.1">Revised and extended security considerations in Section 8.<a href="#appendix-D.20-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.10">
            <p id="appendix-D.20-1.10.1">Added IANA considerations for the OSCORE Flag Bits Registry in Section 9.<a href="#appendix-D.20-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.11">
            <p id="appendix-D.20-1.11.1">Revised Appendix D, now giving a short high-level description of a new endpoint set-up.<a href="#appendix-D.20-1.11.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-01-02">
<section id="appendix-D.21">
        <h3 id="name-version-01-to-02">
<a href="#appendix-D.21" class="section-number selfRef">D.21. </a><a href="#name-version-01-to-02" class="section-name selfRef">Version -01 to -02</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.21-1.1">
            <p id="appendix-D.21-1.1.1">Terminology has been made more aligned with RFC7252 and draft-ietf-core-object-security: i) "client" and "server" replace the old "multicaster" and "listener", respectively; ii) "silent server" replaces the old "pure listener".<a href="#appendix-D.21-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.21-1.2">
            <p id="appendix-D.21-1.2.1">Section 2 has been updated to have the Group Identifier stored in the 'ID Context' parameter defined in draft-ietf-core-object-security.<a href="#appendix-D.21-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.21-1.3">
            <p id="appendix-D.21-1.3.1">Section 3 has been updated with the new format of the Additional Authenticated Data.<a href="#appendix-D.21-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.21-1.4">
            <p id="appendix-D.21-1.4.1">Major rewriting of Section 4 to better highlight the differences with the message processing in draft-ietf-core-object-security.<a href="#appendix-D.21-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.21-1.5">
            <p id="appendix-D.21-1.5.1">Added Sections 7.2 and 7.3 discussing security considerations about uniqueness of (key, nonce) and collision of group identifiers, respectively.<a href="#appendix-D.21-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.21-1.6">
            <p id="appendix-D.21-1.6.1">Minor updates to Appendix A.1 about assumptions on multicast communication topology and group size.<a href="#appendix-D.21-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.21-1.7">
            <p id="appendix-D.21-1.7.1">Updated Appendix C on format of group identifiers, with practical implications of possible collisions of group identifiers.<a href="#appendix-D.21-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.21-1.8">
            <p id="appendix-D.21-1.8.1">Updated Appendix D.2, adding a pointer to draft-palombini-ace-key-groupcomm about retrieval of nodes' public keys through the Group Manager.<a href="#appendix-D.21-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.21-1.9">
            <p id="appendix-D.21-1.9.1">Minor updates to Appendix E.3 about Challenge-Response synchronization of sequence numbers based on the Echo Option from draft-ietf-core-echo-request-tag.<a href="#appendix-D.21-1.9.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-00-01">
<section id="appendix-D.22">
        <h3 id="name-version-00-to-01">
<a href="#appendix-D.22" class="section-number selfRef">D.22. </a><a href="#name-version-00-to-01" class="section-name selfRef">Version -00 to -01</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.22-1.1">
            <p id="appendix-D.22-1.1.1">Section 1.1 has been updated with the definition of group as "security group".<a href="#appendix-D.22-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.22-1.2">
            <p id="appendix-D.22-1.2.1">Section 2 has been updated with:<a href="#appendix-D.22-1.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-D.22-1.2.2.1">
                <p id="appendix-D.22-1.2.2.1.1">Clarifications on establishment/derivation of Security Contexts.<a href="#appendix-D.22-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-D.22-1.2.2.2">
                <p id="appendix-D.22-1.2.2.2.1">A table summarizing the the additional context elements compared to OSCORE.<a href="#appendix-D.22-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-D.22-1.3">
            <p id="appendix-D.22-1.3.1">Section 3 has been updated with:<a href="#appendix-D.22-1.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-D.22-1.3.2.1">
                <p id="appendix-D.22-1.3.2.1.1">Examples of request and response messages.<a href="#appendix-D.22-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-D.22-1.3.2.2">
                <p id="appendix-D.22-1.3.2.2.1">Use of CounterSignature0 rather than CounterSignature.<a href="#appendix-D.22-1.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-D.22-1.3.2.3">
                <p id="appendix-D.22-1.3.2.3.1">Additional Authenticated Data including also the signature algorithm, while not including the Group Identifier any longer.<a href="#appendix-D.22-1.3.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-D.22-1.4">
            <p id="appendix-D.22-1.4.1">Added Section 6, listing the responsibilities of the Group Manager.<a href="#appendix-D.22-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.22-1.5">
            <p id="appendix-D.22-1.5.1">Added Appendix A (former section), including assumptions and security objectives.<a href="#appendix-D.22-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.22-1.6">
            <p id="appendix-D.22-1.6.1">Appendix B has been updated with more details on the use cases.<a href="#appendix-D.22-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.22-1.7">
            <p id="appendix-D.22-1.7.1">Added Appendix C, providing an example of Group Identifier format.<a href="#appendix-D.22-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.22-1.8">
            <p id="appendix-D.22-1.8.1">Appendix D has been updated to be aligned with draft-palombini-ace-key-groupcomm.<a href="#appendix-D.22-1.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="acknowldegment">
<section id="appendix-E">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-E-1">Jiye Park contributed as a co-author of initial versions of this document.<a href="#appendix-E-1" class="pilcrow">¶</a></p>
<p id="appendix-E-2">The authors sincerely thank <span class="contact-name">Christian Amsüss</span>, <span class="contact-name">Stefan Beck</span>, <span class="contact-name">Rolf Blom</span>, <span class="contact-name">Carsten Bormann</span>, <span class="contact-name">Esko Dijk</span>, <span class="contact-name">Martin Gunnarsson</span>, <span class="contact-name">Klaus Hartke</span>, <span class="contact-name">Richard Kelsey</span>, <span class="contact-name">Dave Robin</span>, <span class="contact-name">Jim Schaad</span>, <span class="contact-name">Ludwig Seitz</span>, <span class="contact-name">Peter van der Stok</span>, and <span class="contact-name">Erik Thormarker</span> for their feedback and comments.<a href="#appendix-E-2" class="pilcrow">¶</a></p>
<p id="appendix-E-3">The work on this document has been partly supported by the Sweden's Innovation Agency VINNOVA and the Celtic-Next projects CRITISEC and CYPRESS; the H2020 projects SIFIS-Home (Grant agreement 952652) and ARCADIAN-IoT (Grant agreement 101020259); the SSF project SEC4Factory under the grant RIT17-0032; and the EIT-Digital High Impact Initiative ACTIVE.<a href="#appendix-E-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-F">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marco Tiloca</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440 Stockholm</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:marco.tiloca@ri.se" class="email">marco.tiloca@ri.se</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Göran Selander</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="street-address">Torshamnsgatan 23</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440 Stockholm</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:goran.selander@ericsson.com" class="email">goran.selander@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Francesca Palombini</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="street-address">Torshamnsgatan 23</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440 Stockholm</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:francesca.palombini@ericsson.com" class="email">francesca.palombini@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Preuß Mattsson</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="street-address">Torshamnsgatan 23</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440 Stockholm</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:john.mattsson@ericsson.com" class="email">john.mattsson@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rikard Höglund</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440 Stockholm</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rikard.hoglund@ri.se" class="email">rikard.hoglund@ri.se</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
